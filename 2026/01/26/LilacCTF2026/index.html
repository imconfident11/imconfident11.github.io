

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/avatar.jpg">
  <link rel="icon" href="/img/avatar.jpg">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Eleven">
  <meta name="keywords" content="">
  
    <meta name="description" content="ezPython 解包 先用 pyinstxtractor 解包，解包后的文件中找到 main.pyc, 用 pylingual 在线反编译 12345678910111213141516171819202122232425262728# Decompiled with PyLingual (https:&#x2F;&#x2F;pylingual.io)# Internal filename: &#x27;m">
<meta property="og:type" content="article">
<meta property="og:title" content="LilacCTF2026 逆向 WP + 复现">
<meta property="og:url" content="http://example.com/2026/01/26/LilacCTF2026/index.html">
<meta property="og:site_name" content="Eleven&#39;s Blog">
<meta property="og:description" content="ezPython 解包 先用 pyinstxtractor 解包，解包后的文件中找到 main.pyc, 用 pylingual 在线反编译 12345678910111213141516171819202122232425262728# Decompiled with PyLingual (https:&#x2F;&#x2F;pylingual.io)# Internal filename: &#x27;m">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2026/01/26/images/LilacCTF2026/dump_S1.png">
<meta property="og:image" content="http://example.com/2026/01/26/images/LilacCTF2026/dump_S2.png">
<meta property="og:image" content="http://example.com/2026/01/26/images/LilacCTF2026/nine1.png">
<meta property="og:image" content="http://example.com/2026/01/26/images/LilacCTF2026/map_list_1.png">
<meta property="og:image" content="http://example.com/2026/01/26/images/LilacCTF2026/map_list_2.png">
<meta property="og:image" content="http://example.com/2026/01/26/images/LilacCTF2026/target_all.png">
<meta property="og:image" content="http://example.com/2026/01/26/images/LilacCTF2026/weight.png">
<meta property="article:published_time" content="2026-01-25T16:00:00.000Z">
<meta property="article:modified_time" content="2026-02-06T09:45:15.198Z">
<meta property="article:author" content="Eleven">
<meta property="article:tag" content="Reverse">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/2026/01/26/images/LilacCTF2026/dump_S1.png">
  
  
  
  <title>LilacCTF2026 逆向 WP + 复现 - Eleven&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Eleven&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/wlop2.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="LilacCTF2026 逆向 WP + 复现"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2026-01-26 00:00" pubdate>
          2026年1月26日 凌晨
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          11k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          89 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">LilacCTF2026 逆向 WP + 复现</h1>
            
            
              <div class="markdown-body">
                
                <h2 id="ezpython">ezPython</h2>
<h3 id="解包">解包</h3>
<p>先用 pyinstxtractor 解包，解包后的文件中找到 main.pyc, 用 pylingual
在线反编译</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment"># Decompiled with PyLingual (https://pylingual.io)</span><br><span class="hljs-comment"># Internal filename: &#x27;main.py&#x27;</span><br><span class="hljs-comment"># Bytecode version: 3.9.0beta5 (3425)</span><br><span class="hljs-comment"># Source timestamp: 1970-01-01 00:00:00 UTC (0)</span><br><br><span class="hljs-keyword">import</span> struct<br><span class="hljs-keyword">from</span> crypto <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> sys <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> myalgo<br>welcome_msg = <span class="hljs-string">&#x27;V2VsYzBtMyBUbyBUaGUgV29ybGQgb2YgTDFsYWMgPDM=&#x27;</span><br>input_msg = <span class="hljs-string">&#x27;:i(G#8T&amp;KiF&lt;F_)F`JToCggs;&#x27;</span><br>right_msg = <span class="hljs-string">&#x27;UmlnaHQsIGNvbmdyYXR1bGF0aW9ucyE=&#x27;</span><br>wrong_msg = <span class="hljs-string">&#x27;V3JvbmcgRmxhZyE=&#x27;</span><br><span class="hljs-built_in">print</span>(b64decode(welcome_msg).decode())<br>flag = <span class="hljs-built_in">input</span>(a85decode(input_msg).decode())<br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> (flag.startswith(<span class="hljs-string">&#x27;LilacCTF&#123;&#x27;</span>) <span class="hljs-keyword">and</span> flag.endswith(<span class="hljs-string">&#x27;&#125;&#x27;</span>) <span class="hljs-keyword">and</span> (<span class="hljs-built_in">len</span>(flag) == <span class="hljs-number">26</span>)):<br>    <span class="hljs-built_in">print</span>(b64decode(wrong_msg).decode())<br><span class="hljs-keyword">else</span>:<br>    flag = flag[<span class="hljs-number">9</span>:<span class="hljs-number">25</span>]<br>    res = [<span class="hljs-number">761104570</span>, <span class="hljs-number">1033127419</span>, <span class="hljs-number">3729026053</span>, <span class="hljs-number">795718415</span>]<br>    key = struct.unpack(<span class="hljs-string">&#x27;&lt;IIII&#x27;</span>, <span class="hljs-string">b&#x27;1111222233334444&#x27;</span>)<br>    <span class="hljs-built_in">input</span> = <span class="hljs-built_in">list</span>(struct.unpack(<span class="hljs-string">&#x27;&lt;IIII&#x27;</span>, flag.encode()))<br>    myalgo.btea(<span class="hljs-built_in">input</span>, <span class="hljs-number">4</span>, key)<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">input</span>[<span class="hljs-number">0</span>] == res[<span class="hljs-number">0</span>] <span class="hljs-keyword">and</span> <span class="hljs-built_in">input</span>[<span class="hljs-number">1</span>] == res[<span class="hljs-number">1</span>] <span class="hljs-keyword">and</span> (<span class="hljs-built_in">input</span>[<span class="hljs-number">2</span>] == res[<span class="hljs-number">2</span>]) <span class="hljs-keyword">and</span> (<span class="hljs-built_in">input</span>[<span class="hljs-number">3</span>] == res[<span class="hljs-number">3</span>]):<br>        <span class="hljs-built_in">print</span>(b64decode(right_msg).decode())<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(b64decode(wrong_msg).decode())<br></code></pre></td></tr></table></figure>
<p>反编译出来的逻辑还是比较清晰的，注意到它还 import 了一个 myalgo
模块，所以再反编译一下 myalgo.py 的内容：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment"># Decompiled with PyLingual (https://pylingual.io)</span><br><span class="hljs-comment"># Internal filename: &#x27;myalgo.py&#x27;</span><br><span class="hljs-comment"># Bytecode version: 3.9.0beta5 (3425)</span><br><span class="hljs-comment"># Source timestamp: 1970-01-01 00:00:00 UTC (0)</span><br><br><span class="hljs-keyword">import</span> dis<br><span class="hljs-keyword">import</span> struct<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">MX</span>(<span class="hljs-params">y, z, <span class="hljs-built_in">sum</span>, k, p, e</span>):<br>    <span class="hljs-keyword">return</span> (z &gt;&gt; <span class="hljs-number">5</span> ^ y &gt;&gt; <span class="hljs-number">2</span>) + (y &lt;&lt; <span class="hljs-number">3</span> ^ z &lt;&lt; <span class="hljs-number">4</span>) ^ (<span class="hljs-built_in">sum</span> ^ y) + (k[p &amp; <span class="hljs-number">3</span> ^ e] ^ z)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">btea</span>(<span class="hljs-params">v, n, k</span>):<br>    u32 = <span class="hljs-keyword">lambda</span> x: x &amp; <span class="hljs-number">4294967295</span><br>    y = v[<span class="hljs-number">0</span>]<br>    <span class="hljs-built_in">sum</span> = <span class="hljs-number">0</span><br>    DELTA = <span class="hljs-number">1163219540</span><br>    <span class="hljs-keyword">if</span> n &gt; <span class="hljs-number">1</span>:<br>        z = v[n - <span class="hljs-number">1</span>]<br>        q = <span class="hljs-number">6</span> + <span class="hljs-number">52</span> // n<br>        <span class="hljs-keyword">while</span> q &gt; <span class="hljs-number">0</span>:<br>            q -= <span class="hljs-number">1</span><br>            <span class="hljs-built_in">sum</span> = u32(<span class="hljs-built_in">sum</span> + DELTA)<br>            e = u32(<span class="hljs-built_in">sum</span> &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span><br>            p = <span class="hljs-number">0</span><br>            <span class="hljs-keyword">while</span> p &lt; n - <span class="hljs-number">1</span>:<br>                y = v[p + <span class="hljs-number">1</span>]<br>                z = v[p] = u32(v[p] + MX(y, z, <span class="hljs-built_in">sum</span>, k, p, e))<br>                p += <span class="hljs-number">1</span><br>            y = v[<span class="hljs-number">0</span>]<br>            z = v[n - <span class="hljs-number">1</span>] = u32(v[n - <span class="hljs-number">1</span>] + MX(y, z, <span class="hljs-built_in">sum</span>, k, p, e))<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;WOW&#x27;</span>)<br></code></pre></td></tr></table></figure>
<h3 id="魔改">魔改</h3>
<p>最开始的时候根据上面的信息解
flag，但是无论怎么解都解不出来，卡了很久，后面才注意到 cypto
库是魔改的</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment"># Decompiled with PyLingual (https://pylingual.io)</span><br><span class="hljs-comment"># Internal filename: &#x27;crypto.py&#x27;</span><br><span class="hljs-comment"># Bytecode version: 3.9.0beta5 (3425)</span><br><span class="hljs-comment"># Source timestamp: 1970-01-01 00:00:00 UTC (0)</span><br><br><span class="hljs-keyword">from</span> types <span class="hljs-keyword">import</span> CodeType<br><span class="hljs-keyword">import</span> dis<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">from</span> myalgo <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> struct<br><span class="hljs-keyword">import</span> binascii<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">RC4</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, key: <span class="hljs-built_in">bytes</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;\n        初始化 RC4 类\n        :param key: 密钥，字节类型\n        &quot;&quot;&quot;</span><br>        <span class="hljs-variable language_">self</span>.key = key<br>        <span class="hljs-variable language_">self</span>.s = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>))<br>        <span class="hljs-variable language_">self</span>._ksa()<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_ksa</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;\n        密钥调度算法 (Key Scheduling Algorithm, KSA)\n        &quot;&quot;&quot;</span><br>        j = <span class="hljs-number">0</span><br>        key_length = <span class="hljs-built_in">len</span>(<span class="hljs-variable language_">self</span>.key)<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>            j = (j + <span class="hljs-variable language_">self</span>.s[i] + <span class="hljs-variable language_">self</span>.key[i % key_length]) % <span class="hljs-number">256</span><br>            <span class="hljs-variable language_">self</span>.s[i], <span class="hljs-variable language_">self</span>.s[j] = (<span class="hljs-variable language_">self</span>.s[j], <span class="hljs-variable language_">self</span>.s[i])<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_prga</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;\n        伪随机数生成算法 (Pseudo-Random Generation Algorithm, PRGA)\n        :yield: 生成的伪随机字节\n        &quot;&quot;&quot;</span><br>        i = j = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            i = (i + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span><br>            j = (j + <span class="hljs-variable language_">self</span>.s[i]) % <span class="hljs-number">256</span><br>            <span class="hljs-variable language_">self</span>.s[i], <span class="hljs-variable language_">self</span>.s[j] = (<span class="hljs-variable language_">self</span>.s[j], <span class="hljs-variable language_">self</span>.s[i])<br>            <span class="hljs-keyword">yield</span> <span class="hljs-variable language_">self</span>.s[(<span class="hljs-variable language_">self</span>.s[i] + <span class="hljs-variable language_">self</span>.s[j]) % <span class="hljs-number">256</span>]<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt</span>(<span class="hljs-params">self, plaintext: <span class="hljs-built_in">bytes</span></span>) -&gt; <span class="hljs-built_in">bytes</span>:<br>        <span class="hljs-string">&quot;&quot;&quot;\n        加密明文\n        :param plaintext: 明文，字节类型\n        :return: 密文，字节类型\n        &quot;&quot;&quot;</span><br>        keystream = <span class="hljs-variable language_">self</span>._prga()<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>([p ^ <span class="hljs-built_in">next</span>(keystream) <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> plaintext])<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt</span>(<span class="hljs-params">self, ciphertext: <span class="hljs-built_in">bytes</span></span>) -&gt; <span class="hljs-built_in">bytes</span>:<br>        <span class="hljs-string">&quot;&quot;&quot;\n        解密密文\n        :param ciphertext: 密文，字节类型\n        :return: 明文，字节类型\n        &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.encrypt(ciphertext)<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ArrangeSimpleDES</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-variable language_">self</span>.ip = [<span class="hljs-number">58</span>, <span class="hljs-number">50</span>, <span class="hljs-number">42</span>, <span class="hljs-number">34</span>, <span class="hljs-number">26</span>, <span class="hljs-number">18</span>, <span class="hljs-number">10</span>, <span class="hljs-number">2</span>, <span class="hljs-number">60</span>, <span class="hljs-number">52</span>, <span class="hljs-number">44</span>, <span class="hljs-number">36</span>, <span class="hljs-number">28</span>, <span class="hljs-number">20</span>, <span class="hljs-number">12</span>, <span class="hljs-number">4</span>, <span class="hljs-number">62</span>, <span class="hljs-number">54</span>, <span class="hljs-number">46</span>, <span class="hljs-number">38</span>, <span class="hljs-number">30</span>, <span class="hljs-number">22</span>, <span class="hljs-number">14</span>, <span class="hljs-number">6</span>, <span class="hljs-number">64</span>, <span class="hljs-number">56</span>, <span class="hljs-number">48</span>, <span class="hljs-number">40</span>, <span class="hljs-number">32</span>, <span class="hljs-number">24</span>, <span class="hljs-number">16</span>, <span class="hljs-number">8</span>, <span class="hljs-number">57</span>, <span class="hljs-number">49</span>, <span class="hljs-number">41</span>, <span class="hljs-number">33</span>, <span class="hljs-number">25</span>, <span class="hljs-number">17</span>, <span class="hljs-number">9</span>, <span class="hljs-number">1</span>, <span class="hljs-number">59</span>, <span class="hljs-number">51</span>, <span class="hljs-number">43</span>, <span class="hljs-number">35</span>, <span class="hljs-number">27</span>, <span class="hljs-number">19</span>, <span class="hljs-number">11</span>, <span class="hljs-number">3</span>, <span class="hljs-number">61</span>, <span class="hljs-number">53</span>, <span class="hljs-number">45</span>, <span class="hljs-number">37</span>, <span class="hljs-number">29</span>, <span class="hljs-number">21</span>, <span class="hljs-number">13</span>, <span class="hljs-number">5</span>, <span class="hljs-number">63</span>, <span class="hljs-number">55</span>, <span class="hljs-number">47</span>, <span class="hljs-number">39</span>, <span class="hljs-number">31</span>, <span class="hljs-number">23</span>, <span class="hljs-number">15</span>, <span class="hljs-number">7</span>]<br>        <span class="hljs-variable language_">self</span>.ip1 = [<span class="hljs-number">40</span>, <span class="hljs-number">8</span>, <span class="hljs-number">48</span>, <span class="hljs-number">16</span>, <span class="hljs-number">56</span>, <span class="hljs-number">24</span>, <span class="hljs-number">64</span>, <span class="hljs-number">32</span>, <span class="hljs-number">39</span>, <span class="hljs-number">7</span>, <span class="hljs-number">47</span>, <span class="hljs-number">15</span>, <span class="hljs-number">55</span>, <span class="hljs-number">23</span>, <span class="hljs-number">63</span>, <span class="hljs-number">31</span>, <span class="hljs-number">38</span>, <span class="hljs-number">6</span>, <span class="hljs-number">46</span>, <span class="hljs-number">14</span>, <span class="hljs-number">54</span>, <span class="hljs-number">22</span>, <span class="hljs-number">62</span>, <span class="hljs-number">30</span>, <span class="hljs-number">37</span>, <span class="hljs-number">5</span>, <span class="hljs-number">45</span>, <span class="hljs-number">13</span>, <span class="hljs-number">53</span>, <span class="hljs-number">21</span>, <span class="hljs-number">61</span>, <span class="hljs-number">29</span>, <span class="hljs-number">36</span>, <span class="hljs-number">4</span>, <span class="hljs-number">44</span>, <span class="hljs-number">12</span>, <span class="hljs-number">52</span>, <span class="hljs-number">20</span>, <span class="hljs-number">60</span>, <span class="hljs-number">28</span>, <span class="hljs-number">35</span>, <span class="hljs-number">3</span>, <span class="hljs-number">43</span>, <span class="hljs-number">11</span>, <span class="hljs-number">51</span>, <span class="hljs-number">19</span>, <span class="hljs-number">59</span>, <span class="hljs-number">27</span>, <span class="hljs-number">34</span>, <span class="hljs-number">2</span>, <span class="hljs-number">42</span>, <span class="hljs-number">10</span>, <span class="hljs-number">50</span>, <span class="hljs-number">18</span>, <span class="hljs-number">58</span>, <span class="hljs-number">26</span>, <span class="hljs-number">33</span>, <span class="hljs-number">1</span>, <span class="hljs-number">41</span>, <span class="hljs-number">9</span>, <span class="hljs-number">49</span>, <span class="hljs-number">17</span>, <span class="hljs-number">57</span>, <span class="hljs-number">25</span>]<br>        <span class="hljs-variable language_">self</span>.E = [<span class="hljs-number">32</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span>, <span class="hljs-number">13</span>, <span class="hljs-number">12</span>, <span class="hljs-number">13</span>, <span class="hljs-number">14</span>, <span class="hljs-number">15</span>, <span class="hljs-number">16</span>, <span class="hljs-number">17</span>, <span class="hljs-number">16</span>, <span class="hljs-number">17</span>, <span class="hljs-number">18</span>, <span class="hljs-number">19</span>, <span class="hljs-number">20</span>, <span class="hljs-number">21</span>, <span class="hljs-number">20</span>, <span class="hljs-number">21</span>, <span class="hljs-number">22</span>, <span class="hljs-number">23</span>, <span class="hljs-number">24</span>, <span class="hljs-number">25</span>, <span class="hljs-number">24</span>, <span class="hljs-number">25</span>, <span class="hljs-number">26</span>, <span class="hljs-number">27</span>, <span class="hljs-number">28</span>, <span class="hljs-number">29</span>, <span class="hljs-number">28</span>, <span class="hljs-number">29</span>, <span class="hljs-number">30</span>, <span class="hljs-number">31</span>, <span class="hljs-number">32</span>, <span class="hljs-number">1</span>]<br>        <span class="hljs-variable language_">self</span>.P = [<span class="hljs-number">16</span>, <span class="hljs-number">7</span>, <span class="hljs-number">20</span>, <span class="hljs-number">21</span>, <span class="hljs-number">29</span>, <span class="hljs-number">12</span>, <span class="hljs-number">28</span>, <span class="hljs-number">17</span>, <span class="hljs-number">1</span>, <span class="hljs-number">15</span>, <span class="hljs-number">23</span>, <span class="hljs-number">26</span>, <span class="hljs-number">5</span>, <span class="hljs-number">18</span>, <span class="hljs-number">31</span>, <span class="hljs-number">10</span>, <span class="hljs-number">2</span>, <span class="hljs-number">8</span>, <span class="hljs-number">24</span>, <span class="hljs-number">14</span>, <span class="hljs-number">32</span>, <span class="hljs-number">27</span>, <span class="hljs-number">3</span>, <span class="hljs-number">9</span>, <span class="hljs-number">19</span>, <span class="hljs-number">13</span>, <span class="hljs-number">30</span>, <span class="hljs-number">6</span>, <span class="hljs-number">22</span>, <span class="hljs-number">11</span>, <span class="hljs-number">4</span>, <span class="hljs-number">25</span>]<br>        <span class="hljs-variable language_">self</span>.K = <span class="hljs-string">&#x27;0111010001101000011010010111001101101001011100110110100101110110&#x27;</span><br>        <span class="hljs-variable language_">self</span>.k1 = [<span class="hljs-number">57</span>, <span class="hljs-number">49</span>, <span class="hljs-number">41</span>, <span class="hljs-number">33</span>, <span class="hljs-number">25</span>, <span class="hljs-number">17</span>, <span class="hljs-number">9</span>, <span class="hljs-number">1</span>, <span class="hljs-number">58</span>, <span class="hljs-number">50</span>, <span class="hljs-number">42</span>, <span class="hljs-number">34</span>, <span class="hljs-number">26</span>, <span class="hljs-number">18</span>, <span class="hljs-number">10</span>, <span class="hljs-number">2</span>, <span class="hljs-number">59</span>, <span class="hljs-number">51</span>, <span class="hljs-number">43</span>, <span class="hljs-number">35</span>, <span class="hljs-number">27</span>, <span class="hljs-number">19</span>, <span class="hljs-number">11</span>, <span class="hljs-number">3</span>, <span class="hljs-number">60</span>, <span class="hljs-number">52</span>, <span class="hljs-number">44</span>, <span class="hljs-number">36</span>, <span class="hljs-number">63</span>, <span class="hljs-number">55</span>, <span class="hljs-number">47</span>, <span class="hljs-number">39</span>, <span class="hljs-number">31</span>, <span class="hljs-number">23</span>, <span class="hljs-number">15</span>, <span class="hljs-number">7</span>, <span class="hljs-number">62</span>, <span class="hljs-number">54</span>, <span class="hljs-number">46</span>, <span class="hljs-number">38</span>, <span class="hljs-number">30</span>, <span class="hljs-number">22</span>, <span class="hljs-number">14</span>, <span class="hljs-number">6</span>, <span class="hljs-number">61</span>, <span class="hljs-number">53</span>, <span class="hljs-number">45</span>, <span class="hljs-number">37</span>, <span class="hljs-number">29</span>, <span class="hljs-number">21</span>, <span class="hljs-number">13</span>, <span class="hljs-number">5</span>, <span class="hljs-number">28</span>, <span class="hljs-number">20</span>, <span class="hljs-number">12</span>, <span class="hljs-number">4</span>]<br>        <span class="hljs-variable language_">self</span>.k2 = [<span class="hljs-number">14</span>, <span class="hljs-number">17</span>, <span class="hljs-number">11</span>, <span class="hljs-number">24</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">28</span>, <span class="hljs-number">15</span>, <span class="hljs-number">6</span>, <span class="hljs-number">21</span>, <span class="hljs-number">10</span>, <span class="hljs-number">23</span>, <span class="hljs-number">19</span>, <span class="hljs-number">12</span>, <span class="hljs-number">4</span>, <span class="hljs-number">26</span>, <span class="hljs-number">8</span>, <span class="hljs-number">16</span>, <span class="hljs-number">7</span>, <span class="hljs-number">27</span>, <span class="hljs-number">20</span>, <span class="hljs-number">13</span>, <span class="hljs-number">2</span>, <span class="hljs-number">41</span>, <span class="hljs-number">52</span>, <span class="hljs-number">31</span>, <span class="hljs-number">37</span>, <span class="hljs-number">47</span>, <span class="hljs-number">55</span>, <span class="hljs-number">30</span>, <span class="hljs-number">40</span>, <span class="hljs-number">51</span>, <span class="hljs-number">45</span>, <span class="hljs-number">33</span>, <span class="hljs-number">48</span>, <span class="hljs-number">44</span>, <span class="hljs-number">49</span>, <span class="hljs-number">39</span>, <span class="hljs-number">56</span>, <span class="hljs-number">34</span>, <span class="hljs-number">53</span>, <span class="hljs-number">46</span>, <span class="hljs-number">42</span>, <span class="hljs-number">50</span>, <span class="hljs-number">36</span>, <span class="hljs-number">29</span>, <span class="hljs-number">32</span>]<br>        <span class="hljs-variable language_">self</span>.k0 = [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>]<br>        <span class="hljs-variable language_">self</span>.S = [[<span class="hljs-number">14</span>, <span class="hljs-number">4</span>, <span class="hljs-number">13</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">15</span>, <span class="hljs-number">11</span>, <span class="hljs-number">8</span>, <span class="hljs-number">3</span>, <span class="hljs-number">10</span>, <span class="hljs-number">6</span>, <span class="hljs-number">12</span>, <span class="hljs-number">5</span>, <span class="hljs-number">9</span>, <span class="hljs-number">0</span>, <span class="hljs-number">7</span>, <span class="hljs-number">0</span>, <span class="hljs-number">15</span>, <span class="hljs-number">7</span>, <span class="hljs-number">4</span>, <span class="hljs-number">14</span>, <span class="hljs-number">2</span>, <span class="hljs-number">13</span>, <span class="hljs-number">1</span>, <span class="hljs-number">10</span>, <span class="hljs-number">6</span>, <span class="hljs-number">12</span>, <span class="hljs-number">11</span>, <span class="hljs-number">9</span>, <span class="hljs-number">4</span>, <span class="hljs-number">1</span>, <span class="hljs-number">14</span>, <span class="hljs-number">8</span>, <span class="hljs-number">3</span>, <span class="hljs-number">10</span>, <span class="hljs-number">5</span>, <span class="hljs-number">0</span>, <span class="hljs-number">15</span>, <span class="hljs-number">12</span>, <span class="hljs-number">8</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">9</span>, <span class="hljs-number">14</span>, <span class="hljs-number">12</span>, <span class="hljs-number">5</span>, <span class="hljs-number">0</span>, <span class="hljs-number">14</span>, <span class="hljs-number">10</span>, <span class="hljs-number">6</span>, <span class="hljs-number">6</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">10</span>, <span class="hljs-number">6</span>, <span class="hljs-number">3</span>, <span class="hljs-number">11</span>, <span class="hljs-number">5</span>, <span class="hljs-number">1</span>, <span class="hljs-number">10</span>, <span class="hljs-number">14</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">13</span>, <span class="hljs-number">1</span>, <span class="hljs-number">10</span>, <span class="hljs-number">6</span>, <span class="hljs-number">3</span>, <span class="hljs-number">11</span>, <span class="hljs-number">6</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">13</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">10</span>, <span class="hljs-number">6</span>, <span class="hljs-number">1</span>, <span class="hljs-number">11</span>,<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__substitution</span>(<span class="hljs-params">self, table: <span class="hljs-built_in">str</span>, self_table: <span class="hljs-built_in">list</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>        <span class="hljs-string">&quot;&quot;&quot;\n        :param table: 需要进行置换的列表,是一个01字符串\n        :param self_table: 置换表，在__init__中初始化了\n        :return: 返回置换后的01字符串\n        &quot;&quot;&quot;</span><br>        sub_result = <span class="hljs-string">&#x27;&#x27;</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> self_table:<br>            sub_result += table[i - <span class="hljs-number">1</span>]<br>        <span class="hljs-keyword">return</span> sub_result<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">str2bin</span>(<span class="hljs-params">self, string: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>        <span class="hljs-string">&quot;&quot;&quot;\n        将明文转为二进制字符串:\n        :param string: 任意字符串\n        :return:二进制字符串\n        &quot;&quot;&quot;</span><br>        plaintext_list = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">bytes</span>(string, <span class="hljs-string">&#x27;utf8&#x27;</span>))<br>        result = []<br>        <span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> plaintext_list:<br>            result.append(<span class="hljs-built_in">bin</span>(num)[<span class="hljs-number">2</span>:].zfill(<span class="hljs-number">8</span>))<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join(result)<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">bin2str</span>(<span class="hljs-params">self, binary: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>        <span class="hljs-string">&quot;&quot;&quot;\n        二进制字符串转成字符串\n        :param binary:\n        :return:\n        &quot;&quot;&quot;</span><br>        list_bin = [binary[i:i + <span class="hljs-number">8</span>] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(binary), <span class="hljs-number">8</span>)]<br>        list_int = []<br>        <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> list_bin:<br>            list_int.append(<span class="hljs-built_in">int</span>(b, <span class="hljs-number">2</span>))<br>        result = <span class="hljs-built_in">bytes</span>(list_int).decode()<br>        <span class="hljs-keyword">return</span> result<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__bin2int</span>(<span class="hljs-params">self, binary: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">list</span>:<br>        <span class="hljs-string">&quot;&quot;&quot;\n        由于加密之后的二进制无法直接转成字符，有不可见字符在，utf8可能无法解码，所以需要将二进制字符串每8位转成int型号列表，用于转成bytes再转hex\n        :param binary: 二进制字符串\n        :return: int型列表\n        &quot;&quot;&quot;</span><br>        list_bin = [binary[i:i + <span class="hljs-number">8</span>] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(binary), <span class="hljs-number">8</span>)]<br>        list_int = []<br>        <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> list_bin:<br>            list_int.append(<span class="hljs-built_in">int</span>(b, <span class="hljs-number">2</span>))<br>        <span class="hljs-keyword">return</span> list_int<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__int2bin</span>(<span class="hljs-params">self, list_int: <span class="hljs-built_in">list</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>        result = []<br>        <span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> list_int:<br>            result.append(<span class="hljs-built_in">bin</span>(num)[<span class="hljs-number">2</span>:].zfill(<span class="hljs-number">8</span>))<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join(result)<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__get_block_list</span>(<span class="hljs-params">self, binary: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">list</span>:<br>        <span class="hljs-string">&quot;&quot;&quot;\n        对明文二进制串进行切分，每64位为一块，DES加密以64位为一组进行加密的\n        :type binary: 二进制串\n        &quot;&quot;&quot;</span><br>        len_binary = <span class="hljs-built_in">len</span>(binary)<br>        <span class="hljs-keyword">if</span> len_binary % <span class="hljs-number">64</span>!= <span class="hljs-number">0</span>:<br>            binary_block = binary + <span class="hljs-string">&#x27;0&#x27;</span> * (<span class="hljs-number">64</span> - len_binary % <span class="hljs-number">64</span>)<br>            <span class="hljs-keyword">return</span> [binary_block[i:i + <span class="hljs-number">64</span>] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(binary_block), <span class="hljs-number">64</span>)]<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> [binary[j:j + <span class="hljs-number">64</span>] <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(binary), <span class="hljs-number">64</span>)]<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">modify_secretkey</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;\n        修改默认密钥函数\n        :return: None\n        &quot;&quot;&quot;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;当前二进制形式密钥为:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-variable language_">self</span>.K))<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;当前字符串形式密钥为：&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-variable language_">self</span>.bin2str(<span class="hljs-variable language_">self</span>.K)))<br>        newkey = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;输入新的密钥（长度为8）：&#x27;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(newkey)!= <span class="hljs-number">8</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;密钥长度不符合，请重新输入：&#x27;</span>)<br>            <span class="hljs-variable language_">self</span>.modify_secretkey()<br>        <span class="hljs-keyword">else</span>:<br>            bin_key = <span class="hljs-variable language_">self</span>.str2bin(newkey)<br>            <span class="hljs-variable language_">self</span>.K = bin_key<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;当前二进制形式密钥为:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-variable language_">self</span>.K))<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__f_funtion</span>(<span class="hljs-params">self, right: <span class="hljs-built_in">str</span>, key: <span class="hljs-built_in">str</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;\n        :param right: 明文二进制的字符串加密过程的右半段\n        :param key: 当前轮数的密钥\n        :return: 进行E扩展，与key异或操作，S盒操作后返回32位01字符串\n        &quot;&quot;&quot;</span><br>        e_result = <span class="hljs-variable language_">self</span>.__substitution(right, <span class="hljs-variable language_">self</span>.E)<br>        xor_result = <span class="hljs-variable language_">self</span>.__xor_function(e_result, key)<br>        s_result = <span class="hljs-variable language_">self</span>.__s_box(xor_result)<br>        p_result = <span class="hljs-variable language_">self</span>.__substitution(s_result, <span class="hljs-variable language_">self</span>.P)<br>        <span class="hljs-keyword">return</span> p_result<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__get_key_list</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;\n        :return: 返回加密过程中16轮的子密钥\n        &quot;&quot;&quot;</span><br>        key = <span class="hljs-variable language_">self</span>.__substitution(<span class="hljs-variable language_">self</span>.K, <span class="hljs-variable language_">self</span>.k1)<br>        left_key = key[<span class="hljs-number">0</span>:<span class="hljs-number">28</span>]<br>        right_key = key[<span class="hljs-number">28</span>:<span class="hljs-number">56</span>]<br>        keys = []<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">17</span>):<br>            move = <span class="hljs-variable language_">self</span>.k0[i - <span class="hljs-number">1</span>]<br>            move_left = left_key[move:<span class="hljs-number">28</span>] + left_key[<span class="hljs-number">0</span>:move]<br>            move_right = right_key[move:<span class="hljs-number">28</span>] + right_key[<span class="hljs-number">0</span>:move]<br>            left_key = move_left<br>            right_key = move_right<br>            move_key = left_key + right_key<br>            ki = <span class="hljs-variable language_">self</span>.__substitution(move_key, <span class="hljs-variable language_">self</span>.k2)<br>            keys.append(ki)<br>        <span class="hljs-keyword">return</span> keys<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__xor_function</span>(<span class="hljs-params">self, xor1: <span class="hljs-built_in">str</span>, xor2: <span class="hljs-built_in">str</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;\n        :param xor1: 01字符串\n        :param xor2: 01字符串\n        :return: 异或操作返回的结果\n        &quot;&quot;&quot;</span><br>        size = <span class="hljs-built_in">len</span>(xor1)<br>        result = <span class="hljs-string">&#x27;&#x27;</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, size):<br>            result += <span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">if</span> xor1[i] == xor2[i] <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;1&#x27;</span><br>        <span class="hljs-keyword">return</span> result<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__s_box</span>(<span class="hljs-params">self, xor_result: <span class="hljs-built_in">str</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;\n        :param xor_result: 48位01字符串\n        :return: 返回32位01字符串\n        &quot;&quot;&quot;</span><br>        result = <span class="hljs-string">&#x27;&#x27;</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">8</span>):<br>            block = xor_result[i * <span class="hljs-number">6</span>:(i + <span class="hljs-number">1</span>) * <span class="hljs-number">6</span>]<br>            line = <span class="hljs-built_in">int</span>(block[<span class="hljs-number">0</span>] + block[<span class="hljs-number">5</span>], <span class="hljs-number">2</span>)<br>            colmn = <span class="hljs-built_in">int</span>(block[<span class="hljs-number">1</span>:<span class="hljs-number">5</span>], <span class="hljs-number">2</span>)<br>            res = <span class="hljs-built_in">bin</span>(<span class="hljs-variable language_">self</span>.S[i][line * <span class="hljs-number">16</span> + colmn])[<span class="hljs-number">2</span>:]<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(res) &lt; <span class="hljs-number">4</span>:<br>                res = <span class="hljs-string">&#x27;0&#x27;</span> * (<span class="hljs-number">4</span> - <span class="hljs-built_in">len</span>(res)) + res<br>            result += res<br>        <span class="hljs-keyword">return</span> result<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__iteration</span>(<span class="hljs-params">self, bin_plaintext: <span class="hljs-built_in">str</span>, key_list: <span class="hljs-built_in">list</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;\n        :param bin_plaintext: 01字符串，64位\n        :param key_list: 密钥列表，共16个\n        :return: 进行F函数以及和left异或操作之后的字符串\n        &quot;&quot;&quot;</span><br>        left = bin_plaintext[<span class="hljs-number">0</span>:<span class="hljs-number">32</span>]<br>        right = bin_plaintext[<span class="hljs-number">32</span>:<span class="hljs-number">64</span>]<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">16</span>):<br>            next_lift = right<br>            f_result = <span class="hljs-variable language_">self</span>.__f_funtion(right, key_list[i])<br>            next_right = <span class="hljs-variable language_">self</span>.__xor_function(left, f_result)<br>            left = next_lift<br>            right = next_right<br>        bin_plaintext_result = left + right<br>        <span class="hljs-keyword">return</span> bin_plaintext_result[<span class="hljs-number">32</span>:] + bin_plaintext_result[:<span class="hljs-number">32</span>]<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encode</span>(<span class="hljs-params">self, plaintext</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;\n        :param plaintext: 明文字符串\n        :return: 密文字符串\n        &quot;&quot;&quot;</span><br>        bin_plaintext = <span class="hljs-variable language_">self</span>.str2bin(plaintext)<br>        bin_plaintext_block = <span class="hljs-variable language_">self</span>.__get_block_list(bin_plaintext)<br>        ciphertext_bin_list = []<br>        key_list = <span class="hljs-variable language_">self</span>.__get_key_list()<br>        <span class="hljs-keyword">for</span> block <span class="hljs-keyword">in</span> bin_plaintext_block:<br>            sub_ip = <span class="hljs-variable language_">self</span>.__substitution(block, <span class="hljs-variable language_">self</span>.ip)<br>            ite_result = <span class="hljs-variable language_">self</span>.__iteration(sub_ip, key_list)<br>            sub_ip1 = <span class="hljs-variable language_">self</span>.__substitution(ite_result, <span class="hljs-variable language_">self</span>.ip1)<br>            ciphertext_bin_list.append(sub_ip1)<br>        ciphertext_bin = <span class="hljs-string">&#x27;&#x27;</span>.join(ciphertext_bin_list)<br>        result = <span class="hljs-variable language_">self</span>.__bin2int(ciphertext_bin)<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(result).<span class="hljs-built_in">hex</span>().upper()<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">decode</span>(<span class="hljs-params">self, ciphertext</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;\n        :param ciphertext: 密文字符串\n        :return: 明文字符串\n        &quot;&quot;&quot;</span><br>        b_ciphertext = binascii.a2b_hex(ciphertext)<br>        bin_ciphertext = <span class="hljs-variable language_">self</span>.__int2bin(<span class="hljs-built_in">list</span>(b_ciphertext))<br>        bin_plaintext_list = []<br>        key_list = <span class="hljs-variable language_">self</span>.__get_key_list()<br>        key_list = key_list[::(-<span class="hljs-number">1</span>)]<br>        bin_ciphertext_block = [bin_ciphertext[i:i + <span class="hljs-number">64</span>] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(bin_ciphertext), <span class="hljs-number">64</span>)]<br>        <span class="hljs-keyword">for</span> block <span class="hljs-keyword">in</span> bin_ciphertext_block:<br>            sub_ip = <span class="hljs-variable language_">self</span>.__substitution(block, <span class="hljs-variable language_">self</span>.ip)<br>            ite = <span class="hljs-variable language_">self</span>.__iteration(sub_ip, key_list)<br>            sub_ip1 = <span class="hljs-variable language_">self</span>.__substitution(ite, <span class="hljs-variable language_">self</span>.ip1)<br>            bin_plaintext_list.append(sub_ip1)<br>        bin_plaintext = <span class="hljs-string">&#x27;&#x27;</span>.join(bin_plaintext_list).replace(<span class="hljs-string">&#x27;00000000&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.bin2str(bin_plaintext)<br>_a85chars = <span class="hljs-literal">None</span><br>_a85chars2 = <span class="hljs-literal">None</span><br>_A85START = <span class="hljs-string">b&#x27;&lt;~&#x27;</span><br>_A85END = <span class="hljs-string">b&#x27;~&gt;&#x27;</span><br>bytes_types = (<span class="hljs-built_in">bytes</span>, <span class="hljs-built_in">bytearray</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">_bytes_from_decode_data</span>(<span class="hljs-params">s</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(s, <span class="hljs-built_in">str</span>):<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-keyword">return</span> s.encode(<span class="hljs-string">&#x27;ascii&#x27;</span>)<br>        <span class="hljs-keyword">except</span> UnicodeEncodeError:<br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&#x27;string argument should contain only ASCII characters&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(s, bytes_types):<br>            <span class="hljs-keyword">return</span> s<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">try</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-built_in">memoryview</span>(s).tobytes()<br>            <span class="hljs-keyword">except</span> TypeError:<br>                <span class="hljs-keyword">raise</span> TypeError(<span class="hljs-string">&#x27;argument should be a bytes-like object or ASCII string, not %r&#x27;</span> % s.__class__.__name__) <span class="hljs-keyword">from</span> <span class="hljs-literal">None</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">b64decode</span>(<span class="hljs-params">s, altchars=<span class="hljs-literal">None</span>, validate=<span class="hljs-literal">False</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Decode the Base64 encoded bytes-like object or ASCII string s.\n\n    Optional altchars must be a bytes-like object or ASCII string of length 2\n    which specifies the alternative alphabet used instead of the \&#x27;+\&#x27; and \&#x27;/\&#x27;\n    characters.\n\n    The result is returned as a bytes object.  A binascii.Error is raised if\n    s is incorrectly padded.\n\n    If validate is False (the default), characters that are neither in the\n    normal base-64 alphabet nor the alternative alphabet are discarded prior\n    to the padding check.  If validate is True, these non-alphabet characters\n    in the input result in a binascii.Error.\n    &quot;&quot;&quot;</span><br>    s = _bytes_from_decode_data(s)<br>    <span class="hljs-keyword">if</span> altchars <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>        altchars = _bytes_from_decode_data(altchars)<br>        <span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(altchars) == <span class="hljs-number">2</span>, <span class="hljs-built_in">repr</span>(altchars)<br>        s = s.translate(<span class="hljs-built_in">bytes</span>.maketrans(altchars, <span class="hljs-string">b&#x27;+/&#x27;</span>))<br>    <span class="hljs-keyword">if</span> validate <span class="hljs-keyword">and</span> (<span class="hljs-keyword">not</span> re.fullmatch(<span class="hljs-string">b&#x27;[A-Za-z0-9+/]*=&#123;0,2&#125;&#x27;</span>, s)):<br>        <span class="hljs-keyword">raise</span> binascii.Error(<span class="hljs-string">&#x27;Non-base64 digit found&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> binascii.a2b_base64(s)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">a85decode</span>(<span class="hljs-params">b, *, foldspaces=<span class="hljs-literal">False</span>, adobe=<span class="hljs-literal">False</span>, ignorechars=<span class="hljs-string">b&#x27; \t\n\r\x0b&#x27;</span></span>):<br>    <span class="hljs-comment"># irreducible cflow, using cdg fallback</span><br>    <span class="hljs-string">&quot;&quot;&quot;\n    &quot;&quot;&quot;</span><br>    b = _bytes_from_decode_data(b)<br>    <span class="hljs-keyword">if</span> adobe:<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> b.endswith(_A85END):<br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&#x27;Ascii85 encoded byte sequences must end with &#123;!r&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(_A85END))<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">if</span> b.startswith(_A85START):<br>                b = b[<span class="hljs-number">2</span>:(-<span class="hljs-number">2</span>)]<br>            <span class="hljs-keyword">else</span>:<br>                b = b[:(-<span class="hljs-number">2</span>)]<br>    packI = struct.Struct(<span class="hljs-string">&#x27;!I&#x27;</span>).pack<br>    decoded = []<br>    decoded_append = decoded.append<br>    curr = []<br>    curr_append = curr.append<br>    curr_clear = curr.clear<br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> b + <span class="hljs-string">b&#x27;uuuu&#x27;</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-number">33</span> &lt;= x &lt;= <span class="hljs-number">117</span>:<br>                curr_append(x)<br>                <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(curr) == <span class="hljs-number">5</span>:<br>                    acc = <span class="hljs-number">0</span><br>                    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> curr:<br>                        acc = <span class="hljs-number">85</span> * acc + (x - <span class="hljs-number">33</span>)<br>                    <span class="hljs-keyword">try</span>:<br>                        decoded_append(packI(acc))<br>                    <span class="hljs-keyword">except</span> struct.error:<br>                        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&#x27;Ascii85 overflow&#x27;</span>) <span class="hljs-keyword">from</span> <span class="hljs-literal">None</span><br>                    curr_clear()<br>                <span class="hljs-keyword">if</span> x == <span class="hljs-number">122</span>:<br>                    <span class="hljs-keyword">if</span> curr:<br>                        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&#x27;z inside Ascii85 5-tuple&#x27;</span>)<br>                    <span class="hljs-keyword">else</span>:<br>                        decoded_append(<span class="hljs-string">b&#x27;\x00\x00\x00\x00&#x27;</span>)<br>                <span class="hljs-keyword">else</span>:<br>                    <span class="hljs-keyword">if</span> foldspaces <span class="hljs-keyword">and</span> x == <span class="hljs-number">121</span>:<br>                        <span class="hljs-keyword">if</span> curr:<br>                            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&#x27;y inside Ascii85 5-tuple&#x27;</span>)<br>                        <span class="hljs-keyword">else</span>:<br>                            decoded_append(<span class="hljs-string">b&#x27;    &#x27;</span>)<br>                    <span class="hljs-keyword">else</span>:<br>                        <span class="hljs-keyword">if</span> x <span class="hljs-keyword">in</span> ignorechars:<br>                            <span class="hljs-keyword">continue</span><br>                        <span class="hljs-keyword">else</span>:<br>                            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&#x27;Non-Ascii85 digit found: %c&#x27;</span> % x)<br>    payload = MX.__code__.co_code<br>    magic_code1 = <span class="hljs-string">b&#x27;?&#x27;</span><br>    magic_code2 = <span class="hljs-string">b&#x27;&gt;&#x27;</span><br>    payload = payload[:<span class="hljs-number">4</span>] + magic_code2 + payload[<span class="hljs-number">5</span>:<span class="hljs-number">10</span>] + magic_code1 + payload[<span class="hljs-number">11</span>:<span class="hljs-number">18</span>] + magic_code2 + payload[<span class="hljs-number">19</span>:<span class="hljs-number">24</span>] + magic_code1 + payload[<span class="hljs-number">25</span>:]<br>    payload = payload[:<span class="hljs-number">3</span>] + <span class="hljs-string">b&#x27;\x03&#x27;</span> + payload[<span class="hljs-number">4</span>:<span class="hljs-number">9</span>] + <span class="hljs-string">b&#x27;\x01&#x27;</span> + payload[<span class="hljs-number">10</span>:<span class="hljs-number">17</span>] + <span class="hljs-string">b&#x27;\x04&#x27;</span> + payload[<span class="hljs-number">18</span>:<span class="hljs-number">23</span>] + <span class="hljs-string">b&#x27;\x02&#x27;</span> + payload[<span class="hljs-number">24</span>:]<br>    fn_code = MX.__code__<br>    MX.__code__ = CodeType(<span class="hljs-built_in">int</span>(fn_code.co_argcount), <span class="hljs-built_in">int</span>(fn_code.co_posonlyargcount), <span class="hljs-built_in">int</span>(fn_code.co_kwonlyargcount), <span class="hljs-built_in">int</span>(fn_code.co_nlocals), <span class="hljs-built_in">int</span>(fn_code.co_stacksize), payload, fn_code.co_consts, fn_code.co_names, fn_code.co_varnames, fn_code.co_filename, fn_code.co_name, <span class="hljs-built_in">int</span>(fn_code.co_firstlineno), fn_code.co_lnotab, fn_code.co_freevars, fn_code.co_cellvars)<br>    result = <span class="hljs-string">b&#x27;&#x27;</span>.join(decoded)<br>    padding = <span class="hljs-number">4</span> - <span class="hljs-built_in">len</span>(curr)<br>    <span class="hljs-keyword">if</span> padding:<br>        result = result[:-padding]<br>    <span class="hljs-keyword">return</span> result<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">chacha20_decrypt</span>(<span class="hljs-params">key, counter, nonce, ciphertext</span>):<br>    <span class="hljs-keyword">return</span> chacha20_encrypt(key, counter, nonce, ciphertext)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">chacha20_encrypt</span>(<span class="hljs-params">key, counter, nonce, plaintext</span>):<br>    byte_length = <span class="hljs-built_in">len</span>(plaintext)<br>    full_blocks = byte_length // <span class="hljs-number">64</span><br>    remainder_bytes = byte_length % <span class="hljs-number">64</span><br>    encrypted_message = <span class="hljs-string">b&#x27;&#x27;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(full_blocks):<br>        key_stream = serialize(chacha20_block(key, counter + i, nonce))<br>        plaintext_block = plaintext[i * <span class="hljs-number">64</span>:i * <span class="hljs-number">64</span> + <span class="hljs-number">64</span>]<br>        encrypted_block = [plaintext_block[j] ^ key_stream[j] <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">64</span>)]<br>        encrypted_message += <span class="hljs-built_in">bytes</span>(encrypted_block)<br>    <span class="hljs-keyword">if</span> remainder_bytes!= <span class="hljs-number">0</span>:<br>        key_stream = serialize(chacha20_block(key, counter + full_blocks, nonce))<br>        plaintext_block = plaintext[full_blocks * <span class="hljs-number">64</span>:byte_length]<br>        encrypted_block = [plaintext_block[j] ^ key_stream[j] <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(remainder_bytes)]<br>        encrypted_message += <span class="hljs-built_in">bytes</span>(encrypted_block)<br>    <span class="hljs-keyword">return</span> encrypted_message<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">chacha20_block</span>(<span class="hljs-params">key, counter, nonce</span>):<br>    BLOCK_CONSTANTS = [<span class="hljs-number">1634760805</span>, <span class="hljs-number">857760878</span>, <span class="hljs-number">2036477234</span>, <span class="hljs-number">1797285236</span>]<br>    init_state = BLOCK_CONSTANTS + key + [counter] + nonce<br>    current_state = init_state[:]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>        inner_block(current_state)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">16</span>):<br>        current_state[i] = add_32(current_state[i], init_state[i])<br>    <span class="hljs-keyword">return</span> current_state<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">inner_block</span>(<span class="hljs-params">state</span>):<br>    quarterround(state, <span class="hljs-number">0</span>, <span class="hljs-number">4</span>, <span class="hljs-number">8</span>, <span class="hljs-number">12</span>)<br>    quarterround(state, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">9</span>, <span class="hljs-number">13</span>)<br>    quarterround(state, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>, <span class="hljs-number">10</span>, <span class="hljs-number">14</span>)<br>    quarterround(state, <span class="hljs-number">3</span>, <span class="hljs-number">7</span>, <span class="hljs-number">11</span>, <span class="hljs-number">15</span>)<br>    quarterround(state, <span class="hljs-number">0</span>, <span class="hljs-number">5</span>, <span class="hljs-number">10</span>, <span class="hljs-number">15</span>)<br>    quarterround(state, <span class="hljs-number">1</span>, <span class="hljs-number">6</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span>)<br>    quarterround(state, <span class="hljs-number">2</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">13</span>)<br>    quarterround(state, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">9</span>, <span class="hljs-number">14</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">xor_32</span>(<span class="hljs-params">x, y</span>):<br>    <span class="hljs-keyword">return</span> (x ^ y) &amp; <span class="hljs-number">4294967295</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add_32</span>(<span class="hljs-params">x, y</span>):<br>    <span class="hljs-keyword">return</span> x + y &amp; <span class="hljs-number">4294967295</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rot_l32</span>(<span class="hljs-params">x, n</span>):<br>    <span class="hljs-keyword">return</span> (x &lt;&lt; n | x &gt;&gt; <span class="hljs-number">32</span> - n) &amp; <span class="hljs-number">4294967295</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">quarterround</span>(<span class="hljs-params">state, i1, i2, i3, i4</span>):<br>    a = state[i1]<br>    b = state[i2]<br>    c = state[i3]<br>    d = state[i4]<br>    a = add_32(a, b)<br>    d = xor_32(d, a)<br>    d = rot_l32(d, <span class="hljs-number">16</span>)<br>    c = add_32(c, d)<br>    b = xor_32(b, c)<br>    b = rot_l32(b, <span class="hljs-number">12</span>)<br>    a = add_32(a, b)<br>    d = xor_32(d, a)<br>    d = rot_l32(d, <span class="hljs-number">8</span>)<br>    c = add_32(c, d)<br>    b = xor_32(b, c)<br>    b = rot_l32(b, <span class="hljs-number">7</span>)<br>    state[i1] = a<br>    state[i2] = b<br>    state[i3] = c<br>    state[i4] = d<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">serialize</span>(<span class="hljs-params">block</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">b&#x27;&#x27;</span>.join([word.to_bytes(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;little&#x27;</span>) <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> block])<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt</span>(<span class="hljs-params">v, k</span>):<br>    v0 = v[<span class="hljs-number">0</span>]<br>    v1 = v[<span class="hljs-number">1</span>]<br>    key0, key1, key2, key3 = (k[<span class="hljs-number">0</span>], k[<span class="hljs-number">1</span>], k[<span class="hljs-number">2</span>], k[<span class="hljs-number">3</span>])<br>    <span class="hljs-built_in">sum</span> = <span class="hljs-number">0</span><br>    delta = <span class="hljs-number">2654435769</span><br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>):<br>        <span class="hljs-built_in">sum</span> = <span class="hljs-built_in">sum</span> + delta &amp; <span class="hljs-number">4294967295</span><br>        v0 = v0 + ((v1 &lt;&lt; <span class="hljs-number">3</span>) + key0 ^ v1 + <span class="hljs-built_in">sum</span> ^ (v1 &gt;&gt; <span class="hljs-number">4</span>) + key1 ^ <span class="hljs-number">596</span>) &amp; <span class="hljs-number">4294967295</span><br>        v1 = v1 + ((v0 &lt;&lt; <span class="hljs-number">3</span>) + key2 ^ v0 + <span class="hljs-built_in">sum</span> ^ (v0 &gt;&gt; <span class="hljs-number">4</span>) + key3 ^ <span class="hljs-number">2310</span>) &amp; <span class="hljs-number">4294967295</span><br>    <span class="hljs-keyword">return</span> (v0, v1)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt</span>(<span class="hljs-params">v, k</span>):<br>    v0 = v[<span class="hljs-number">0</span>]<br>    v1 = v[<span class="hljs-number">1</span>]<br>    key0, key1, key2, key3 = (k[<span class="hljs-number">0</span>], k[<span class="hljs-number">1</span>], k[<span class="hljs-number">2</span>], k[<span class="hljs-number">3</span>])<br>    <span class="hljs-built_in">sum</span> = <span class="hljs-number">3337565984</span><br>    delta = <span class="hljs-number">2654435769</span><br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>):<br>        v1 = v1 - ((v0 &lt;&lt; <span class="hljs-number">3</span>) + key2 ^ v0 + <span class="hljs-built_in">sum</span> ^ (v0 &gt;&gt; <span class="hljs-number">4</span>) + key3 ^ <span class="hljs-number">2310</span>) &amp; <span class="hljs-number">4294967295</span><br>        v0 = v0 - ((v1 &lt;&lt; <span class="hljs-number">3</span>) + key0 ^ v1 + <span class="hljs-built_in">sum</span> ^ (v1 &gt;&gt; <span class="hljs-number">4</span>) + key1 ^ <span class="hljs-number">596</span>) &amp; <span class="hljs-number">4294967295</span><br>        <span class="hljs-built_in">sum</span> = <span class="hljs-built_in">sum</span> - delta &amp; <span class="hljs-number">4294967295</span><br>    <span class="hljs-keyword">return</span> (v0, v1)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt_all</span>(<span class="hljs-params">v, k</span>):<br>    encrypted = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(v), <span class="hljs-number">2</span>):<br>        encrypted.extend(encrypt(v[i:i + <span class="hljs-number">2</span>], k))<br>    <span class="hljs-keyword">return</span> encrypted<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt_all</span>(<span class="hljs-params">v, k</span>):<br>    decrypted = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(v), <span class="hljs-number">2</span>):<br>        decrypted.extend(decrypt(v[i:i + <span class="hljs-number">2</span>], k))<br>    <span class="hljs-keyword">return</span> decrypted<br></code></pre></td></tr></table></figure>
<p>真实的逻辑是，在 main.py 调用 <code>a85decode</code>
时，该函数内部通过 python 反射修改了 <code>myalgo.MX</code>
函数的字节码</p>
<p>原本的 <code>z &gt;&gt; 5</code> 变为 <code>z &lt;&lt; 3</code></p>
<p>原本的 <code>y &gt;&gt; 2</code> 变为 <code>y &gt;&gt; 5</code></p>
<p>原本的 <code>y &lt;&lt; 3</code> 变为 <code>y &lt;&lt; 4</code></p>
<p>原本的 <code>z &lt;&lt; 4</code> 变为 <code>z &gt;&gt; 2</code></p>
<p>所以篡改后的
<code>MX_new = ((z &lt;&lt; 3 ^ y &gt;&gt; 5) + (y &lt;&lt; 4 ^ z &gt;&gt; 2)) ^ ((sum ^ y) + (k[(p &amp; 3) ^ e] ^ z))</code></p>
<h3 id="exp">Exp</h3>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> struct<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">MX</span>(<span class="hljs-params">y, z, sum_val, k, p, e</span>):<br>    part1 = ((z &lt;&lt; <span class="hljs-number">3</span>) ^ (y &gt;&gt; <span class="hljs-number">5</span>)) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>    part2 = ((y &lt;&lt; <span class="hljs-number">4</span>) ^ (z &gt;&gt; <span class="hljs-number">2</span>)) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>    part3 = (sum_val ^ y) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>    part4 = (k[(p &amp; <span class="hljs-number">3</span>) ^ e] ^ z) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>    <span class="hljs-keyword">return</span> ((part1 + part2) &amp; <span class="hljs-number">0xFFFFFFFF</span>) ^ ((part3 + part4) &amp; <span class="hljs-number">0xFFFFFFFF</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt</span>():<br>    v = [<span class="hljs-number">761104570</span>, <span class="hljs-number">1033127419</span>, <span class="hljs-number">3729026053</span>, <span class="hljs-number">795718415</span>]<br>    key = struct.unpack(<span class="hljs-string">&#x27;&lt;IIII&#x27;</span>, <span class="hljs-string">b&#x27;1111222233334444&#x27;</span>)<br>    DELTA = <span class="hljs-number">1163219540</span><br>    n = <span class="hljs-number">4</span><br>    q = <span class="hljs-number">6</span> + <span class="hljs-number">52</span> // n<br>    sum_val = (DELTA * q) &amp; <span class="hljs-number">0xFFFFFFFF</span><br><br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(q):<br>        e = (sum_val &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span><br>        v[<span class="hljs-number">3</span>] = (v[<span class="hljs-number">3</span>] - MX(v[<span class="hljs-number">0</span>], v[<span class="hljs-number">2</span>], sum_val, key, <span class="hljs-number">3</span>, e)) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>        v[<span class="hljs-number">2</span>] = (v[<span class="hljs-number">2</span>] - MX(v[<span class="hljs-number">3</span>], v[<span class="hljs-number">1</span>], sum_val, key, <span class="hljs-number">2</span>, e)) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>        v[<span class="hljs-number">1</span>] = (v[<span class="hljs-number">1</span>] - MX(v[<span class="hljs-number">2</span>], v[<span class="hljs-number">0</span>], sum_val, key, <span class="hljs-number">1</span>, e)) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>        v[<span class="hljs-number">0</span>] = (v[<span class="hljs-number">0</span>] - MX(v[<span class="hljs-number">1</span>], v[<span class="hljs-number">3</span>], sum_val, key, <span class="hljs-number">0</span>, e)) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>        sum_val = (sum_val - DELTA) &amp; <span class="hljs-number">0xFFFFFFFF</span><br><br>    <span class="hljs-keyword">return</span> struct.pack(<span class="hljs-string">&#x27;&lt;IIII&#x27;</span>, *v).decode()<br><br>inner_flag = decrypt()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;LilacCTF&#123;&#123;<span class="hljs-subst">&#123;inner_flag&#125;</span>&#125;&#125;&quot;</span>)<br></code></pre></td></tr></table></figure>
<p>得到 flag 为 <code>LilacCTF&#123;e@sy_Pyth0n_SMC!&#125;</code></p>
<h2 id="justrom">JustROM</h2>
<h3 id="反编译">反编译</h3>
<p>题目附件只给了个 <code>rom.bin</code>,开始啥没头绪，后面拷打 ai
确定架构，push ai 试了好久好久…最后得知是 <code>SPARC</code>,扔进 Ghidra
反编译</p>
<h4 id="fun_00004238"><code>FUN_00004238</code></h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br></pre></td><td class="code"><pre><code class="hljs c">undefined8 <span class="hljs-title function_">FUN_00004238</span><span class="hljs-params">(<span class="hljs-type">int</span> param_1,<span class="hljs-type">int</span> param_2)</span><br><br>&#123;<br>  uint uVar1;<br>  uint uVar2;<br>  uint local_44 [<span class="hljs-number">4</span>];<br>  uint local_34;<br>  uint local_30;<br>  uint local_2c;<br>  uint local_28;<br>  uint local_24;<br>  uint local_20;<br>  uint local_1c;<br>  uint local_18;<br>  uint local_14;<br>  uint local_10;<br>  uint local_c;<br>  uint local_8;<br>  <span class="hljs-type">int</span> local_4;<br>  <br>  <span class="hljs-keyword">for</span> (local_4 = <span class="hljs-number">0</span>; local_4 &lt; <span class="hljs-number">0x10</span>; local_4 = local_4 + <span class="hljs-number">1</span>) &#123;<br>    local_44[local_4] = *(uint *)(param_2 + local_4 * <span class="hljs-number">4</span>);<br>  &#125;<br>  <span class="hljs-keyword">for</span> (local_4 = <span class="hljs-number">0</span>; local_4 &lt; <span class="hljs-number">8</span>; local_4 = local_4 + <span class="hljs-number">2</span>) &#123;<br>    local_44[<span class="hljs-number">0</span>] = local_44[<span class="hljs-number">0</span>] + local_34;<br>    uVar1 = local_14 ^ local_44[<span class="hljs-number">0</span>];<br>    local_14 = uVar1;<br>    FUN_00004060(uVar1,<span class="hljs-number">0x10</span>);<br>    local_24 = local_24 + uVar1;<br>    uVar2 = local_34 ^ local_24;<br>    local_34 = uVar2;<br>    local_14 = uVar1;<br>    FUN_00004060(uVar2,<span class="hljs-number">0xc</span>);<br>    local_44[<span class="hljs-number">0</span>] = local_44[<span class="hljs-number">0</span>] + uVar2;<br>    uVar1 = local_14 ^ local_44[<span class="hljs-number">0</span>];<br>    local_34 = uVar2;<br>    local_14 = uVar1;<br>    FUN_00004060(uVar1,<span class="hljs-number">8</span>);<br>    local_24 = local_24 + uVar1;<br>    uVar2 = local_34 ^ local_24;<br>    local_34 = uVar2;<br>    local_14 = uVar1;<br>    FUN_00004060(uVar2,<span class="hljs-number">7</span>);<br>    local_44[<span class="hljs-number">1</span>] = local_44[<span class="hljs-number">1</span>] + local_30;<br>    uVar1 = local_10 ^ local_44[<span class="hljs-number">1</span>];<br>    local_34 = uVar2;<br>    local_10 = uVar1;<br>    FUN_00004060(uVar1,<span class="hljs-number">0x10</span>);<br>    local_20 = local_20 + uVar1;<br>    uVar2 = local_30 ^ local_20;<br>    local_30 = uVar2;<br>    local_10 = uVar1;<br>    FUN_00004060(uVar2,<span class="hljs-number">0xc</span>);<br>    local_44[<span class="hljs-number">1</span>] = local_44[<span class="hljs-number">1</span>] + uVar2;<br>    uVar1 = local_10 ^ local_44[<span class="hljs-number">1</span>];<br>    local_30 = uVar2;<br>    local_10 = uVar1;<br>    FUN_00004060(uVar1,<span class="hljs-number">8</span>);<br>    local_20 = local_20 + uVar1;<br>    uVar2 = local_30 ^ local_20;<br>    local_30 = uVar2;<br>    local_10 = uVar1;<br>    FUN_00004060(uVar2,<span class="hljs-number">7</span>);<br>    local_44[<span class="hljs-number">2</span>] = local_44[<span class="hljs-number">2</span>] + local_2c;<br>    uVar1 = local_c ^ local_44[<span class="hljs-number">2</span>];<br>    local_30 = uVar2;<br>    local_c = uVar1;<br>    FUN_00004060(uVar1,<span class="hljs-number">0x10</span>);<br>    local_1c = local_1c + uVar1;<br>    uVar2 = local_2c ^ local_1c;<br>    local_2c = uVar2;<br>    local_c = uVar1;<br>    FUN_00004060(uVar2,<span class="hljs-number">0xc</span>);<br>    local_44[<span class="hljs-number">2</span>] = local_44[<span class="hljs-number">2</span>] + uVar2;<br>    uVar1 = local_c ^ local_44[<span class="hljs-number">2</span>];<br>    local_2c = uVar2;<br>    local_c = uVar1;<br>    FUN_00004060(uVar1,<span class="hljs-number">8</span>);<br>    local_1c = local_1c + uVar1;<br>    uVar2 = local_2c ^ local_1c;<br>    local_2c = uVar2;<br>    local_c = uVar1;<br>    FUN_00004060(uVar2,<span class="hljs-number">7</span>);<br>    local_44[<span class="hljs-number">3</span>] = local_44[<span class="hljs-number">3</span>] + local_28;<br>    uVar1 = local_8 ^ local_44[<span class="hljs-number">3</span>];<br>    local_2c = uVar2;<br>    local_8 = uVar1;<br>    FUN_00004060(uVar1,<span class="hljs-number">0x10</span>);<br>    local_18 = local_18 + uVar1;<br>    uVar2 = local_28 ^ local_18;<br>    local_28 = uVar2;<br>    local_8 = uVar1;<br>    FUN_00004060(uVar2,<span class="hljs-number">0xc</span>);<br>    local_44[<span class="hljs-number">3</span>] = local_44[<span class="hljs-number">3</span>] + uVar2;<br>    uVar1 = local_8 ^ local_44[<span class="hljs-number">3</span>];<br>    local_28 = uVar2;<br>    local_8 = uVar1;<br>    FUN_00004060(uVar1,<span class="hljs-number">8</span>);<br>    local_18 = local_18 + uVar1;<br>    uVar2 = local_28 ^ local_18;<br>    local_28 = uVar2;<br>    local_8 = uVar1;<br>    FUN_00004060(uVar2,<span class="hljs-number">7</span>);<br>    local_44[<span class="hljs-number">0</span>] = local_44[<span class="hljs-number">0</span>] + local_30;<br>    uVar1 = local_8 ^ local_44[<span class="hljs-number">0</span>];<br>    local_28 = uVar2;<br>    local_8 = uVar1;<br>    FUN_00004060(uVar1,<span class="hljs-number">0x10</span>);<br>    local_1c = local_1c + uVar1;<br>    uVar2 = local_30 ^ local_1c;<br>    local_30 = uVar2;<br>    local_8 = uVar1;<br>    FUN_00004060(uVar2,<span class="hljs-number">0xc</span>);<br>    local_44[<span class="hljs-number">0</span>] = local_44[<span class="hljs-number">0</span>] + uVar2;<br>    uVar1 = local_8 ^ local_44[<span class="hljs-number">0</span>];<br>    local_30 = uVar2;<br>    local_8 = uVar1;<br>    FUN_00004060(uVar1,<span class="hljs-number">8</span>);<br>    local_1c = local_1c + uVar1;<br>    uVar2 = local_30 ^ local_1c;<br>    local_30 = uVar2;<br>    local_8 = uVar1;<br>    FUN_00004060(uVar2,<span class="hljs-number">7</span>);<br>    local_44[<span class="hljs-number">1</span>] = local_44[<span class="hljs-number">1</span>] + local_2c;<br>    uVar1 = local_14 ^ local_44[<span class="hljs-number">1</span>];<br>    local_30 = uVar2;<br>    local_14 = uVar1;<br>    FUN_00004060(uVar1,<span class="hljs-number">0x10</span>);<br>    local_18 = local_18 + uVar1;<br>    uVar2 = local_2c ^ local_18;<br>    local_2c = uVar2;<br>    local_14 = uVar1;<br>    FUN_00004060(uVar2,<span class="hljs-number">0xc</span>);<br>    local_44[<span class="hljs-number">1</span>] = local_44[<span class="hljs-number">1</span>] + uVar2;<br>    uVar1 = local_14 ^ local_44[<span class="hljs-number">1</span>];<br>    local_2c = uVar2;<br>    local_14 = uVar1;<br>    FUN_00004060(uVar1,<span class="hljs-number">8</span>);<br>    local_18 = local_18 + uVar1;<br>    uVar2 = local_2c ^ local_18;<br>    local_2c = uVar2;<br>    local_14 = uVar1;<br>    FUN_00004060(uVar2,<span class="hljs-number">7</span>);<br>    local_44[<span class="hljs-number">2</span>] = local_44[<span class="hljs-number">2</span>] + local_28;<br>    uVar1 = local_10 ^ local_44[<span class="hljs-number">2</span>];<br>    local_2c = uVar2;<br>    local_10 = uVar1;<br>    FUN_00004060(uVar1,<span class="hljs-number">0x10</span>);<br>    local_24 = local_24 + uVar1;<br>    uVar2 = local_28 ^ local_24;<br>    local_28 = uVar2;<br>    local_10 = uVar1;<br>    FUN_00004060(uVar2,<span class="hljs-number">0xc</span>);<br>    local_44[<span class="hljs-number">2</span>] = local_44[<span class="hljs-number">2</span>] + uVar2;<br>    uVar1 = local_10 ^ local_44[<span class="hljs-number">2</span>];<br>    local_28 = uVar2;<br>    local_10 = uVar1;<br>    FUN_00004060(uVar1,<span class="hljs-number">8</span>);<br>    local_24 = local_24 + uVar1;<br>    uVar2 = local_28 ^ local_24;<br>    local_28 = uVar2;<br>    local_10 = uVar1;<br>    FUN_00004060(uVar2,<span class="hljs-number">7</span>);<br>    local_44[<span class="hljs-number">3</span>] = local_44[<span class="hljs-number">3</span>] + local_34;<br>    uVar1 = local_c ^ local_44[<span class="hljs-number">3</span>];<br>    local_28 = uVar2;<br>    local_c = uVar1;<br>    FUN_00004060(uVar1,<span class="hljs-number">0x10</span>);<br>    local_20 = local_20 + uVar1;<br>    uVar2 = local_34 ^ local_20;<br>    local_34 = uVar2;<br>    local_c = uVar1;<br>    FUN_00004060(uVar2,<span class="hljs-number">0xc</span>);<br>    local_44[<span class="hljs-number">3</span>] = local_44[<span class="hljs-number">3</span>] + uVar2;<br>    uVar1 = local_c ^ local_44[<span class="hljs-number">3</span>];<br>    local_34 = uVar2;<br>    local_c = uVar1;<br>    FUN_00004060(uVar1,<span class="hljs-number">8</span>);<br>    local_20 = local_20 + uVar1;<br>    uVar2 = local_34 ^ local_20;<br>    local_34 = uVar2;<br>    local_c = uVar1;<br>    FUN_00004060(uVar2,<span class="hljs-number">7</span>);<br>    local_34 = uVar2;<br>  &#125;<br>  <span class="hljs-keyword">for</span> (local_4 = <span class="hljs-number">0</span>; local_4 &lt; <span class="hljs-number">0x10</span>; local_4 = local_4 + <span class="hljs-number">1</span>) &#123;<br>    *(uint *)(param_1 + local_4 * <span class="hljs-number">4</span>) = local_44[local_4] + *(<span class="hljs-type">int</span> *)(param_2 + local_4 * <span class="hljs-number">4</span>);<br>  &#125;<br>  <span class="hljs-keyword">return</span> CONCAT44(param_2,param_1);<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="fun_00004060"><code>FUN_00004060</code></h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs c">undefined8 <span class="hljs-title function_">FUN_00004060</span><span class="hljs-params">(uint param_1,undefined4 param_2)</span><br><br>&#123;<br>  <span class="hljs-keyword">return</span> CONCAT44(param_2,param_1 &gt;&gt; (-(byte)param_2 &amp; <span class="hljs-number">0x1f</span>) | param_1 &lt;&lt; ((byte)param_2 &amp; <span class="hljs-number">0x1f</span>)) ;<br>&#125;<br><br>FUN_0000409c<br>undefined8 <span class="hljs-title function_">FUN_0000409c</span><span class="hljs-params">(undefined4 *param_1,undefined4 param_2)</span><br><br>&#123;<br>  undefined4 uVar1;<br>  <br>  uVar1 = <span class="hljs-number">0x40008018</span>;<br>  FUN_00004028();<br>  *param_1 = uVar1;<br>  uVar1 = <span class="hljs-number">0x4000801c</span>;<br>  FUN_00004028();<br>  param_1[<span class="hljs-number">1</span>] = uVar1;<br>  uVar1 = <span class="hljs-number">0x40008020</span>;<br>  FUN_00004028();<br>  param_1[<span class="hljs-number">2</span>] = uVar1;<br>  uVar1 = <span class="hljs-number">0x40008024</span>;<br>  FUN_00004028();<br>  param_1[<span class="hljs-number">3</span>] = uVar1;<br>  param_1[<span class="hljs-number">4</span>] = _DAT_40010000;<br>  param_1[<span class="hljs-number">5</span>] = _DAT_40010004;<br>  param_1[<span class="hljs-number">6</span>] = _DAT_40010008;<br>  param_1[<span class="hljs-number">7</span>] = _DAT_4001000c;<br>  param_1[<span class="hljs-number">8</span>] = _DAT_40010010;<br>  param_1[<span class="hljs-number">9</span>] = _DAT_40010014;<br>  param_1[<span class="hljs-number">10</span>] = _DAT_40010018;<br>  param_1[<span class="hljs-number">0xb</span>] = _DAT_4001001c;<br>  param_1[<span class="hljs-number">0xc</span>] = <span class="hljs-number">1</span>;<br>  param_1[<span class="hljs-number">0xd</span>] = <span class="hljs-number">0x41414141</span>;<br>  param_1[<span class="hljs-number">0xe</span>] = <span class="hljs-number">0x42424242</span>;<br>  param_1[<span class="hljs-number">0xf</span>] = <span class="hljs-number">0x43434343</span>;<br>  <span class="hljs-keyword">return</span> CONCAT44(param_2,param_1);<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>FUN_00004060</code>
是一个循环左移操作,<code>FUN_00004238</code> 实现了
<strong>ChaCha20</strong> 的轮函数,<code>FUN_0000409c</code> 初始化了
ChaCha 的初始状态</p>
<p>这里从 <code>DAT_40010000</code> 开始到 <code>DAT_4001001c</code>
有部分数据在 Ghidra 中没找到</p>
<p>在 010 中搜索内存找到了</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">11</span> <span class="hljs-number">22</span> <span class="hljs-number">33</span> <span class="hljs-number">44</span> <span class="hljs-number">55</span> <span class="hljs-number">66</span> <span class="hljs-number">77</span> <span class="hljs-number">88</span> <span class="hljs-number">99</span> AA BB CC DD EE FF <span class="hljs-number">00</span><br><span class="hljs-attribute">DE</span> AD BE EF CA FE BA BE <span class="hljs-number">0</span>B AD F0 <span class="hljs-number">0</span>D <span class="hljs-number">13</span> <span class="hljs-number">37</span> <span class="hljs-number">13</span> <span class="hljs-number">37</span><br><span class="hljs-attribute">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">42</span> <span class="hljs-number">42</span> <span class="hljs-number">42</span> <span class="hljs-number">42</span> <span class="hljs-number">43</span> <span class="hljs-number">43</span> <span class="hljs-number">43</span> <span class="hljs-number">43</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br></code></pre></td></tr></table></figure>
<h3 id="关键函数">关键函数</h3>
<p><code>FUN_00004ab0</code> 是关键函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs c">undefined8 <span class="hljs-title function_">FUN_00004ab0</span><span class="hljs-params">(undefined4 param_1,undefined4 param_2)</span><br><br>&#123;<br>  byte local_c8 [<span class="hljs-number">128</span>];<br>  undefined auStack_48 [<span class="hljs-number">68</span>];<br>  <span class="hljs-type">int</span> local_4;<br>  <br>  local_c8[<span class="hljs-number">0x20</span>] = <span class="hljs-number">0x54</span>;<br>  local_c8[<span class="hljs-number">0x21</span>] = <span class="hljs-number">0x68</span>;<br>  local_c8[<span class="hljs-number">0x22</span>] = <span class="hljs-number">0x65</span>;<br>  local_c8[<span class="hljs-number">0x23</span>] = <span class="hljs-number">0x72</span>;<br>  local_c8[<span class="hljs-number">0x24</span>] = <span class="hljs-number">0x65</span>;<br>  local_c8[<span class="hljs-number">0x25</span>] = <span class="hljs-number">0x5f</span>;<br>  local_c8[<span class="hljs-number">0x26</span>] = <span class="hljs-number">0x69</span>;<br>  local_c8[<span class="hljs-number">0x27</span>] = <span class="hljs-number">0x73</span>;<br>  local_c8[<span class="hljs-number">0x28</span>] = <span class="hljs-number">0x5f</span>;<br>  local_c8[<span class="hljs-number">0x29</span>] = <span class="hljs-number">0x6e</span>;<br>  local_c8[<span class="hljs-number">0x2a</span>] = <span class="hljs-number">0x6f</span>;<br>  local_c8[<span class="hljs-number">0x2b</span>] = <span class="hljs-number">0x74</span>;<br>  local_c8[<span class="hljs-number">0x2c</span>] = <span class="hljs-number">0x68</span>;<br>  local_c8[<span class="hljs-number">0x2d</span>] = <span class="hljs-number">0x69</span>;<br>  local_c8[<span class="hljs-number">0x2e</span>] = <span class="hljs-number">0x6e</span>;<br>  local_c8[<span class="hljs-number">0x2f</span>] = <span class="hljs-number">0x67</span>;<br>  local_c8[<span class="hljs-number">0x30</span>] = <span class="hljs-number">0x5f</span>;<br>  local_c8[<span class="hljs-number">0x31</span>] = <span class="hljs-number">0x79</span>;<br>  local_c8[<span class="hljs-number">0x32</span>] = <span class="hljs-number">0x6f</span>;<br>  local_c8[<span class="hljs-number">0x33</span>] = <span class="hljs-number">0x75</span>;<br>  local_c8[<span class="hljs-number">0x34</span>] = <span class="hljs-number">0x5f</span>;<br>  local_c8[<span class="hljs-number">0x35</span>] = <span class="hljs-number">0x77</span>;<br>  local_c8[<span class="hljs-number">0x36</span>] = <span class="hljs-number">0x61</span>;<br>  local_c8[<span class="hljs-number">0x37</span>] = <span class="hljs-number">0x6e</span>;<br>  local_c8[<span class="hljs-number">0x38</span>] = <span class="hljs-number">0x6e</span>;<br>  local_c8[<span class="hljs-number">0x39</span>] = <span class="hljs-number">0x61</span>;<br>  local_c8[<span class="hljs-number">0x3a</span>] = <span class="hljs-number">0x5f</span>;<br>  local_c8[<span class="hljs-number">0x3b</span>] = <span class="hljs-number">0x67</span>;<br>  local_c8[<span class="hljs-number">0x3c</span>] = <span class="hljs-number">0x65</span>;<br>  local_c8[<span class="hljs-number">0x3d</span>] = <span class="hljs-number">0x74</span>;<br>  local_c8[<span class="hljs-number">0x3e</span>] = <span class="hljs-number">0x2e</span>;<br>  local_c8[<span class="hljs-number">0x3f</span>] = <span class="hljs-number">0x2e</span>;<br>  local_c8[<span class="hljs-number">0</span>] = <span class="hljs-number">0x37</span>;<br>  local_c8[<span class="hljs-number">1</span>] = <span class="hljs-number">0x32</span>;<br>  local_c8[<span class="hljs-number">2</span>] = <span class="hljs-number">0x9b</span>;<br>  local_c8[<span class="hljs-number">3</span>] = <span class="hljs-number">0xf6</span>;<br>  local_c8[<span class="hljs-number">4</span>] = <span class="hljs-number">0x36</span>;<br>  local_c8[<span class="hljs-number">5</span>] = <span class="hljs-number">0xa9</span>;<br>  local_c8[<span class="hljs-number">6</span>] = <span class="hljs-number">0x18</span>;<br>  local_c8[<span class="hljs-number">7</span>] = <span class="hljs-number">0xfc</span>;<br>  local_c8[<span class="hljs-number">8</span>] = <span class="hljs-number">0xf2</span>;<br>  local_c8[<span class="hljs-number">9</span>] = <span class="hljs-number">0xe7</span>;<br>  local_c8[<span class="hljs-number">10</span>] = <span class="hljs-number">0x49</span>;<br>  local_c8[<span class="hljs-number">0xb</span>] = <span class="hljs-number">0x73</span>;<br>  local_c8[<span class="hljs-number">0xc</span>] = <span class="hljs-number">0x61</span>;<br>  local_c8[<span class="hljs-number">0xd</span>] = <span class="hljs-number">0x49</span>;<br>  local_c8[<span class="hljs-number">0xe</span>] = <span class="hljs-number">0xf8</span>;<br>  local_c8[<span class="hljs-number">0xf</span>] = <span class="hljs-number">0xd4</span>;<br>  local_c8[<span class="hljs-number">0x10</span>] = <span class="hljs-number">0x4c</span>;<br>  local_c8[<span class="hljs-number">0x11</span>] = <span class="hljs-number">0xf2</span>;<br>  local_c8[<span class="hljs-number">0x12</span>] = <span class="hljs-number">0x6a</span>;<br>  local_c8[<span class="hljs-number">0x13</span>] = <span class="hljs-number">0xc9</span>;<br>  local_c8[<span class="hljs-number">0x14</span>] = <span class="hljs-number">0x3c</span>;<br>  local_c8[<span class="hljs-number">0x15</span>] = <span class="hljs-number">0x4c</span>;<br>  local_c8[<span class="hljs-number">0x16</span>] = <span class="hljs-number">0x62</span>;<br>  local_c8[<span class="hljs-number">0x17</span>] = <span class="hljs-number">0x83</span>;<br>  local_c8[<span class="hljs-number">0x18</span>] = <span class="hljs-number">0x78</span>;<br>  local_c8[<span class="hljs-number">0x19</span>] = <span class="hljs-number">0x12</span>;<br>  local_c8[<span class="hljs-number">0x1a</span>] = <span class="hljs-number">0x5c</span>;<br>  local_c8[<span class="hljs-number">0x1b</span>] = <span class="hljs-number">5</span>;<br>  local_c8[<span class="hljs-number">0x1c</span>] = <span class="hljs-number">0x5f</span>;<br>  local_c8[<span class="hljs-number">0x1d</span>] = <span class="hljs-number">0x30</span>;<br>  local_c8[<span class="hljs-number">0x1e</span>] = <span class="hljs-number">0x95</span>;<br>  local_c8[<span class="hljs-number">0x1f</span>] = <span class="hljs-number">0x9d</span>;<br>  FUN_0000409c(auStack_48);<br>  <span class="hljs-keyword">for</span> (local_4 = <span class="hljs-number">0</span>; local_4 &lt; <span class="hljs-number">0x20</span>; local_4 = local_4 + <span class="hljs-number">1</span>) &#123;<br>    local_c8[local_4 + <span class="hljs-number">0x20</span>] = local_c8[local_4 + <span class="hljs-number">0x20</span>] ^ local_c8[local_4];<br>  &#125;<br>  FUN_00004238(local_c8 + <span class="hljs-number">0x40</span>,auStack_48);<br>  <span class="hljs-keyword">for</span> (local_4 = <span class="hljs-number">0</span>; local_4 &lt; <span class="hljs-number">0x20</span>; local_4 = local_4 + <span class="hljs-number">1</span>) &#123;<br>    *(byte *)(local_4 + <span class="hljs-number">0x42000000</span>) = *(byte *)(local_4 + <span class="hljs-number">0x42000000</span>) ^ local_c8[local_4 + <span class="hljs-number">0x40</span>];<br>  &#125;<br>  <span class="hljs-keyword">for</span> (local_4 = <span class="hljs-number">0</span>; local_4 &lt; <span class="hljs-number">0x20</span>; local_4 = local_4 + <span class="hljs-number">1</span>) &#123;<br>    <span class="hljs-keyword">if</span> ((<span class="hljs-type">int</span>)*(<span class="hljs-type">char</span> *)(local_4 + <span class="hljs-number">0x42000000</span>) != (uint)local_c8[local_4 + <span class="hljs-number">0x20</span>])<br>    <span class="hljs-keyword">goto</span> code_r0x00004d14;<br>  &#125;<br>  DAT_42000100 = <span class="hljs-number">0x57</span>;<br>  DAT_42000101 = <span class="hljs-number">0x69</span>;<br>  DAT_42000102 = <span class="hljs-number">0x6e</span>;<br>  <span class="hljs-keyword">for</span> (local_4 = <span class="hljs-number">0</span>; local_4 &lt; <span class="hljs-number">0xffff</span>; local_4 = local_4 + <span class="hljs-number">1</span>) &#123;<br>  &#125;<br>code_r0x00004d14:<br>  <span class="hljs-keyword">return</span> CONCAT44(param_2,param_1);<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>S</code> (0x20-0x3F):
<code>"There_is_nothing_you_wanna_get.."</code></p>
<p><code>K</code> (0x00-0x1F):
<code>37 32 9b f6 36 a9 18 fc f2 e7 49 73 61 49 f8 d4 4c f2 6a c9 3c 4c 62 83 78 12 5c 05 5f 30 95 9d</code></p>
<p>将 <code>S</code> 与 <code>K</code>
进行按位异或：<code>Target[i] = S[i] ^ K[i]</code>，调用 FUN_00004238
生成 ChaCha 密钥流，最终对比推导出
<code>Input[i] = Target[i] ^ Stream[i]</code></p>
<h3 id="exp-1">Exp</h3>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> struct<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rotate_left</span>(<span class="hljs-params">x, n</span>):<br>    <span class="hljs-keyword">return</span> ((x &lt;&lt; n) &amp; <span class="hljs-number">0xFFFFFFFF</span>) | (x &gt;&gt; (<span class="hljs-number">32</span> - n))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">chacha_qr</span>(<span class="hljs-params">x, a, b, c, d</span>):<br>    x[a] = (x[a] + x[b]) &amp; <span class="hljs-number">0xFFFFFFFF</span>; x[d] = rotate_left(x[d] ^ x[a], <span class="hljs-number">16</span>)<br>    x[c] = (x[c] + x[d]) &amp; <span class="hljs-number">0xFFFFFFFF</span>; x[b] = rotate_left(x[b] ^ x[c], <span class="hljs-number">12</span>)<br>    x[a] = (x[a] + x[b]) &amp; <span class="hljs-number">0xFFFFFFFF</span>; x[d] = rotate_left(x[d] ^ x[a], <span class="hljs-number">8</span>)<br>    x[c] = (x[c] + x[d]) &amp; <span class="hljs-number">0xFFFFFFFF</span>; x[b] = rotate_left(x[b] ^ x[c], <span class="hljs-number">7</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">chacha8_block</span>(<span class="hljs-params">state</span>):<br>    working_state = <span class="hljs-built_in">list</span>(state)<br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>        <span class="hljs-comment"># 列混合</span><br>        chacha_qr(working_state, <span class="hljs-number">0</span>, <span class="hljs-number">4</span>, <span class="hljs-number">8</span>, <span class="hljs-number">12</span>)<br>        chacha_qr(working_state, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">9</span>, <span class="hljs-number">13</span>)<br>        chacha_qr(working_state, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>, <span class="hljs-number">10</span>, <span class="hljs-number">14</span>)<br>        chacha_qr(working_state, <span class="hljs-number">3</span>, <span class="hljs-number">7</span>, <span class="hljs-number">11</span>, <span class="hljs-number">15</span>)<br>        <span class="hljs-comment"># 对角线混合</span><br>        chacha_qr(working_state, <span class="hljs-number">0</span>, <span class="hljs-number">5</span>, <span class="hljs-number">10</span>, <span class="hljs-number">15</span>)<br>        chacha_qr(working_state, <span class="hljs-number">1</span>, <span class="hljs-number">6</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span>)<br>        chacha_qr(working_state, <span class="hljs-number">2</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">13</span>)<br>        chacha_qr(working_state, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">9</span>, <span class="hljs-number">14</span>)<br>    <span class="hljs-keyword">return</span> [(working_state[i] + state[i]) &amp; <span class="hljs-number">0xFFFFFFFF</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">16</span>)]<br><br><span class="hljs-comment"># 由 local_c8[0x20] ^ local_c8[0x00] 得到</span><br>k_bytes = [<span class="hljs-number">0x37</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0x9b</span>, <span class="hljs-number">0xf6</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0xa9</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0xfc</span>, <span class="hljs-number">0xf2</span>, <span class="hljs-number">0xe7</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0xf8</span>, <span class="hljs-number">0xd4</span>, <br>           <span class="hljs-number">0x4c</span>, <span class="hljs-number">0xf2</span>, <span class="hljs-number">0x6a</span>, <span class="hljs-number">0xc9</span>, <span class="hljs-number">0x3c</span>, <span class="hljs-number">0x4c</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0x83</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0x5c</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0x5f</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0x9d</span>]<br>s_string = <span class="hljs-string">b&quot;There_is_nothing_you_wanna_get..&quot;</span><br>target = <span class="hljs-built_in">bytes</span>([k_bytes[i] ^ s_string[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>)])<br><br><span class="hljs-comment"># &quot;expand 32-byte k&quot;</span><br>constants = [<span class="hljs-number">0x61707865</span>, <span class="hljs-number">0x3320646e</span>, <span class="hljs-number">0x79622d32</span>, <span class="hljs-number">0x6b206574</span>]<br><br>key_hex = <span class="hljs-string">&quot;112233445566778899AABBCCDD00EEFFDEADBEEFCAFEBABEB0ADF00D13371337&quot;</span> <span class="hljs-comment"># 修正了你的部分输入</span><br><br>key_bytes = <span class="hljs-built_in">bytes</span>.fromhex(<span class="hljs-string">&quot;11 22 33 44 55 66 77 88 99 AA BB CC DD EE FF 00 DE AD BE EF CA FE BA BE 0B AD F0 0D 13 37 13 37&quot;</span>)<br>key_words = <span class="hljs-built_in">list</span>(struct.unpack(<span class="hljs-string">&quot;&gt;8I&quot;</span>, key_bytes))<br><br>counter = [<span class="hljs-number">1</span>]<br>nonce = [<span class="hljs-number">0x41414141</span>, <span class="hljs-number">0x42424242</span>, <span class="hljs-number">0x43434343</span>]<br><br>state = constants + key_words + counter + nonce<br><br>stream_words = chacha8_block(state)<br><br>stream = struct.pack(<span class="hljs-string">&quot;&lt;16I&quot;</span>, *stream_words)<br><br>flag = <span class="hljs-built_in">bytes</span>([target[i] ^ stream[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>)])<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Flag: <span class="hljs-subst">&#123;flag&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure>
<p>Flag 为 <code>LilacCTF&#123;d0ntl@@kl1kechch4atall&#125;</code></p>
<h2 id="c">C++++</h2>
<h3 id="反编译-1">反编译</h3>
<p>直接 ida 反编译，从 main 函数开始，动调找逻辑</p>
<p><code>sub_7FF72E7EFC30</code>-&gt;<code>sub_7FF72E6FC6C0</code></p>
<p>主要逻辑在 <code>sub_7FF72E6FC6C0</code></p>
<h4 id="sub_7ff72e6fc6c0"><code>sub_7FF72E6FC6C0</code></h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64 <span class="hljs-title function_">sub_7FF646B1C6C0</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-comment">// [COLLAPSED LOCAL DECLARATIONS. PRESS NUMPAD &quot;+&quot; TO EXPAND]</span><br><br>  sub_7FF646BE4AB0(&amp;off_7FF646D517A0);<br>  sub_7FF646BE4FF0(<span class="hljs-number">10LL</span>);<br>  <span class="hljs-built_in">printf</span>(off_7FF646D47600);<br>  <span class="hljs-built_in">printf</span>(off_7FF646D461E0);<br>  <span class="hljs-built_in">printf</span>(off_7FF646D47600);<br>  printf_0(off_7FF646D46020);<br>  v0 = (<span class="hljs-type">char</span> **)sub_7FF646BE4AF0();             <span class="hljs-comment">// input</span><br>  <span class="hljs-keyword">if</span> ( !v0 )<br>    v0 = &amp;off_7FF646D46008;<br>  result = sub_7FF646B27650((__int64)v0, <span class="hljs-number">3</span>);    <span class="hljs-comment">// 格式化清理</span><br>  v2 = result;<br>  <span class="hljs-keyword">if</span> ( result &amp;&amp; *(_DWORD *)(result + <span class="hljs-number">8</span>) )<br>  &#123;<br>    v3 = sub_7FF646AA3B40(qword_7FF646CE9950, <span class="hljs-number">0x10u</span>LL);<span class="hljs-comment">// new</span><br>    *(_OWORD *)(v3 + <span class="hljs-number">16</span>) = xmmword_7FF646C99460;<br>    v4 = (<span class="hljs-type">unsigned</span> __int16 **)sub_7FF646B1C850((<span class="hljs-type">unsigned</span> __int16 **)v3, <span class="hljs-number">0x41</span>);<span class="hljs-comment">// xor 0x41 -&gt; &quot;WONDERFUL&amp;&amp;PEACE&quot;</span><br>    v5 = sub_7FF646AA3B40(qword_7FF646CE9950, <span class="hljs-number">0x10u</span>LL);<span class="hljs-comment">// memalloc</span><br>    *(_OWORD *)(v5 + <span class="hljs-number">16</span>) = xmmword_7FF646C99450;<br>    v6 = (<span class="hljs-type">unsigned</span> __int16 **)sub_7FF646B1C850((<span class="hljs-type">unsigned</span> __int16 **)v5, <span class="hljs-number">0x31</span>);<span class="hljs-comment">// xor 0x31 -&gt; &quot;somedanctoforget&quot;</span><br>    v7 = sub_7FF646AA3A20(&amp;byte_7FF646CA9038);<br>    sub_7FF646B1C490(v7, v4, v6);               <span class="hljs-comment">// string_opt</span><br>    v8 = (_QWORD **)sub_7FF646AA1A9E();<br>    v9 = (*(__int64 (__fastcall **)(_QWORD *, __int64))(*v8[<span class="hljs-number">1</span>] + <span class="hljs-number">112LL</span>))(v8[<span class="hljs-number">1</span>], v2);<br>    sub_7FF646B1C4E0(v7, v9);<br>    v11 = sub_7FF646B2DD10(v10);<br>    string_replace(v11, (__int64)&amp;off_7FF646D46DE8, (__int64 **)&amp;off_7FF646D46008);<br>    <span class="hljs-keyword">if</span> ( (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)sub_7FF646B240D0(v12, (__int64)&amp;off_7FF646D47738) )<br>    &#123;<br>      sub_7FF646BE4FF0(<span class="hljs-number">11LL</span>);<br>      <span class="hljs-built_in">printf</span>(off_7FF646D460E0);                 <span class="hljs-comment">// WELCOME</span><br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      sub_7FF646BE4FF0(<span class="hljs-number">12LL</span>);<br>      <span class="hljs-built_in">printf</span>(off_7FF646D46068);                 <span class="hljs-comment">// DENIED</span><br>    &#125;<br>    <span class="hljs-keyword">return</span> sub_7FF646BE5060();<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="sub_7ff646b1c4e0"><code>sub_7FF646B1C4E0</code></h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> __fastcall <span class="hljs-title function_">sub_7FF646B1C4E0</span><span class="hljs-params">(__int64 a1, <span class="hljs-type">char</span> *a2)</span><br>&#123;<br>  <span class="hljs-comment">// [COLLAPSED LOCAL DECLARATIONS. PRESS NUMPAD &quot;+&quot; TO EXPAND]</span><br><br>  v14[<span class="hljs-number">0</span>] = <span class="hljs-number">0LL</span>;<br>  v2 = <span class="hljs-number">0xFFFFFFFFFFFFFF4L</span>L;<br>  <span class="hljs-keyword">do</span><br>  &#123;<br>    v18[v2] = <span class="hljs-number">0LL</span>;<br>    v18[v2 + <span class="hljs-number">1</span>] = <span class="hljs-number">0LL</span>;<br>    v18[v2 + <span class="hljs-number">2</span>] = <span class="hljs-number">0LL</span>;<br>    v2 += <span class="hljs-number">3LL</span>;<br>  &#125;<br>  <span class="hljs-keyword">while</span> ( v2 * <span class="hljs-number">16</span> );<br>  v5 = *((_DWORD *)a2 + <span class="hljs-number">2</span>);<br>  v6 = <span class="hljs-number">16</span> * ((v5 + <span class="hljs-number">15</span>) / <span class="hljs-number">16</span>);<br>  v7 = sub_7FF646AA3B40(byte_7FF646CE9950, v6);<br>  v8 = (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *)sub_7FF646AA3B40(byte_7FF646CE9950, v6);<br>  sub_7FF646B203E0((<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *)a2, <span class="hljs-number">0</span>, v8, <span class="hljs-number">0</span>, v5);<br>  v17 = v8;<br>  <span class="hljs-keyword">if</span> ( v8[<span class="hljs-number">2</span>] )<br>    v9 = v17 + <span class="hljs-number">4</span>;<br>  <span class="hljs-keyword">else</span><br>    v9 = <span class="hljs-number">0LL</span>;<br>  v16 = v7;<br>  <span class="hljs-keyword">if</span> ( *(_DWORD *)(v7 + <span class="hljs-number">8</span>) )<br>    v10 = v16 + <span class="hljs-number">16</span>;<br>  <span class="hljs-keyword">else</span><br>    v10 = <span class="hljs-number">0LL</span>;<br>  v11 = *(_QWORD *)(a1 + <span class="hljs-number">8</span>);<br>  v15 = v11;<br>  <span class="hljs-keyword">if</span> ( v11 &amp;&amp; *(_DWORD *)(v15 + <span class="hljs-number">8</span>) )<br>    v12 = v15 + <span class="hljs-number">16</span>;<br>  <span class="hljs-keyword">else</span><br>    v12 = <span class="hljs-number">0LL</span>;<br>  sub_7FF646B1C890(v14, v12, *(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *)(v11 + <span class="hljs-number">8</span>)); <span class="hljs-comment">// 密钥扩展</span><br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; v6; i += <span class="hljs-number">16</span> )<br>    sub_7FF646B1CA40(v14, &amp;v9[i / <span class="hljs-number">4u</span>], v10 + i); <span class="hljs-comment">// 分组加密</span><br>  v17 = <span class="hljs-number">0LL</span>;<br>  v16 = <span class="hljs-number">0LL</span>;<br>  v15 = <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">if</span> ( *(_QWORD *)&amp;v18[<span class="hljs-number">0</span>] != _security_cookie )<br>    cexit_0();<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="sub_7ff646b1ca40"><code>sub_7FF646B1CA40</code></h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> __fastcall <span class="hljs-title function_">sub_7FF646B1CA40</span><span class="hljs-params">(__int64 a1, __int64 a2, __int64 a3)</span><br>&#123;<br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// ecx</span><br>  <span class="hljs-type">int</span> j; <span class="hljs-comment">// ebp</span><br>  <span class="hljs-type">int</span> v7; <span class="hljs-comment">// r12d</span><br>  <span class="hljs-type">int</span> v8; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v9; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v10; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> k; <span class="hljs-comment">// eax</span><br>  __int64 v12; <span class="hljs-comment">// [rsp+28h] [rbp-50h]</span><br>  __int64 v13; <span class="hljs-comment">// [rsp+30h] [rbp-48h]</span><br>  __int64 v14; <span class="hljs-comment">// [rsp+38h] [rbp-40h]</span><br><br>  v12 = <span class="hljs-number">0LL</span>;<br>  v13 = <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; ++i )<br>    *((_DWORD *)&amp;v12 + i) = *(_DWORD *)(a1 + <span class="hljs-number">4LL</span> * i + <span class="hljs-number">16</span>) ^ *(_DWORD *)(a2 + <span class="hljs-number">4LL</span> * i);<br>  <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">16</span>; ++j )<br>  &#123;<br>    v7 = sub_7FF646B1CC20(a1, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v12, <span class="hljs-number">0LL</span>); <span class="hljs-comment">// sub_7FF646B1CC20 进行 S 盒变换</span><br>    v8 = sub_7FF646B1CC20(a1, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)__ROL4__(HIDWORD(v12), <span class="hljs-number">8</span>), <span class="hljs-number">0LL</span>);<br>    HIDWORD(v13) = __ROL4__(HIDWORD(v13), <span class="hljs-number">5</span>);<br>    LODWORD(v13) = (*(_DWORD *)(a1 + <span class="hljs-number">4LL</span> * (<span class="hljs-number">2</span> * j + <span class="hljs-number">8</span>) + <span class="hljs-number">16</span>) + v7 + v8) ^ v13;<br>    HIDWORD(v13) ^= *(_DWORD *)(a1 + <span class="hljs-number">4LL</span> * (<span class="hljs-number">2</span> * j + <span class="hljs-number">9</span>) + <span class="hljs-number">16</span>) + v7 + <span class="hljs-number">2</span> * v8;<br>    LODWORD(v13) = __ROL4__(v13, <span class="hljs-number">27</span>);<br>    <span class="hljs-keyword">if</span> ( j &lt; <span class="hljs-number">15</span> )<br>    &#123;<br>      v9 = v12;<br>      LODWORD(v12) = v13;<br>      LODWORD(v13) = v9;<br>      v10 = HIDWORD(v12);<br>      HIDWORD(v12) = HIDWORD(v13);<br>      HIDWORD(v13) = v10;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">for</span> ( k = <span class="hljs-number">0</span>; k &lt; <span class="hljs-number">4</span>; ++k )<br>    *(_DWORD *)(a3 + <span class="hljs-number">4LL</span> * k) = *(_DWORD *)(a1 + <span class="hljs-number">4LL</span> * (k + <span class="hljs-number">4</span>) + <span class="hljs-number">16</span>) ^ *((_DWORD *)&amp;v12 + k);<br>  <span class="hljs-keyword">if</span> ( v14 != _security_cookie )<br>    cexit_0();<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="分析">分析</h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; ++i )<br>  *((_DWORD *)&amp;v12 + i) = *(_DWORD *)(a1 + <span class="hljs-number">4LL</span> * i + <span class="hljs-number">16</span>) ^ *(_DWORD *)(a2 + <span class="hljs-number">4LL</span> * i);<br></code></pre></td></tr></table></figure>
<p>在进入主循环前，输入的数据块与轮密钥的前 4 个 DWORD 进行异或</p>
<p>进入 16 轮主循环后：</p>
<p><code>v7</code> 和 <code>v8</code> 是通过 S
盒变换((sub_7FF646B1CC20))得到的值,然后使用
<code>__ROL4__</code>循环左移,注意 <code>HIDWORD(v13)</code> 左移 5
位，最后整个 <code>v13</code> 左移 27 位,每一轮都会从 <code>a1</code>
中提取两个不同的轮密钥：<code>*(_DWORD *)(a1 + 4LL * (2 * j + 8) + 16)</code>
和 <code>*(_DWORD *)(a1 + 4LL * (2 * j + 9) + 16)</code>,
在每一轮结束时（除了最后一轮），<code>v12</code> 和 <code>v13</code>
交换</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">for</span> ( k = <span class="hljs-number">0</span>; k &lt; <span class="hljs-number">4</span>; ++k )<br>  *(_DWORD *)(a3 + <span class="hljs-number">4LL</span> * k) = *(_DWORD *)(a1 + <span class="hljs-number">4LL</span> * (k + <span class="hljs-number">4</span>) + <span class="hljs-number">16</span>) ^ *((_DWORD *)&amp;v12 + k);<br></code></pre></td></tr></table></figure>
<p>最后再次与一组轮密钥进行异或</p>
<h4 id="sub_7ff646b1cc20"><code>sub_7FF646B1CC20</code></h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64 __fastcall <span class="hljs-title function_">sub_7FF646B1CC20</span><span class="hljs-params">(<span class="hljs-type">int</span> *a1, <span class="hljs-type">int</span> a2, __int64 a3)</span><br>&#123;<br>  <span class="hljs-comment">// [COLLAPSED LOCAL DECLARATIONS. PRESS NUMPAD &quot;+&quot; TO EXPAND]</span><br><br>  v5 = (<span class="hljs-type">unsigned</span> __int8)a2;<br>  v6 = BYTE1(a2);<br>  v7 = BYTE2(a2);<br>  v8 = HIBYTE(a2);<br>  <span class="hljs-keyword">if</span> ( a3 )<br>  &#123;<br>    v9 = *(_DWORD *)(a3 + <span class="hljs-number">8</span>);<br>    <span class="hljs-keyword">if</span> ( v9 &gt;= <span class="hljs-number">4</span> )<br>    &#123;<br>      v10 = *(_DWORD **)(sub_7FF646AA1557() + <span class="hljs-number">8</span>);<br>      v11 = v10[<span class="hljs-number">6</span>];<br>      v12 = <span class="hljs-number">1</span> - v11;<br>      v13 = v10[<span class="hljs-number">4</span>];<br>      <span class="hljs-keyword">if</span> ( <span class="hljs-number">1</span> - v11 &gt;= v13 )<br>        <span class="hljs-keyword">goto</span> LABEL_71;<br>      v14 = v10[<span class="hljs-number">5</span>];<br>      v15 = v10[<span class="hljs-number">7</span>];<br>      v16 = v5 - v15;<br>      <span class="hljs-keyword">if</span> ( v16 &gt;= v14 )<br>        <span class="hljs-keyword">goto</span> LABEL_71;<br>      v5 = *(<span class="hljs-type">unsigned</span> __int8 *)(a3 + <span class="hljs-number">28</span>) ^ *((<span class="hljs-type">unsigned</span> __int8 *)v10 + v16 + v14 * v12 + <span class="hljs-number">32</span>);<br>      v17 = v6 - v15;<br>      <span class="hljs-keyword">if</span> ( v17 &gt;= v14 )<br>        <span class="hljs-keyword">goto</span> LABEL_71;<br>      v89 = *(_DWORD *)(a3 + <span class="hljs-number">28</span>);<br>      v6 = (<span class="hljs-type">unsigned</span> __int8)(BYTE1(v89) ^ *((_BYTE *)v10 + v17 + v14 * v12 + <span class="hljs-number">32</span>));<br>      <span class="hljs-keyword">if</span> ( -v11 &gt;= v13 )<br>        <span class="hljs-keyword">goto</span> LABEL_71;<br>      v18 = v7 - v15;<br>      <span class="hljs-keyword">if</span> ( v18 &gt;= v14 )<br>        <span class="hljs-keyword">goto</span> LABEL_71;<br>      v7 = (<span class="hljs-type">unsigned</span> __int8)(BYTE2(v89) ^ *((_BYTE *)v10 + v18 + v14 * -v11 + <span class="hljs-number">32</span>));<br>      v19 = v14 * v12;<br>      v20 = v8 - v15;<br>      <span class="hljs-keyword">if</span> ( v20 &gt;= v14 )<br>        <span class="hljs-keyword">goto</span> LABEL_71;<br>      v8 = (<span class="hljs-type">unsigned</span> __int8)(HIBYTE(v89) ^ *((_BYTE *)v10 + v20 + v19 + <span class="hljs-number">32</span>));<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( v9 &lt; <span class="hljs-number">3</span> )<br>    &#123;<br>      v95 = v8;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      v21 = *(_DWORD **)(sub_7FF646AA1557() + <span class="hljs-number">8</span>);<br>      v22 = v21[<span class="hljs-number">6</span>];<br>      v23 = <span class="hljs-number">1</span> - v22;<br>      v24 = v21[<span class="hljs-number">4</span>];<br>      <span class="hljs-keyword">if</span> ( <span class="hljs-number">1</span> - v22 &gt;= v24 )<br>        <span class="hljs-keyword">goto</span> LABEL_71;<br>      v25 = v21[<span class="hljs-number">5</span>];<br>      v26 = v21[<span class="hljs-number">7</span>];<br>      v27 = v5 - v26;<br>      <span class="hljs-keyword">if</span> ( v27 &gt;= v25 )<br>        <span class="hljs-keyword">goto</span> LABEL_71;<br>      v5 = *(<span class="hljs-type">unsigned</span> __int8 *)(a3 + <span class="hljs-number">24</span>) ^ *((<span class="hljs-type">unsigned</span> __int8 *)v21 + v27 + v25 * v23 + <span class="hljs-number">32</span>);<br>      v28 = v6 - v26;<br>      <span class="hljs-keyword">if</span> ( v28 &gt;= v25 )<br>        <span class="hljs-keyword">goto</span> LABEL_71;<br>      v29 = *(_DWORD *)(a3 + <span class="hljs-number">24</span>);<br>      v6 = (<span class="hljs-type">unsigned</span> __int8)(BYTE1(v29) ^ *((_BYTE *)v21 + v28 + v25 * v23 + <span class="hljs-number">32</span>));<br>      <span class="hljs-keyword">if</span> ( -v22 &gt;= v24 )<br>        <span class="hljs-keyword">goto</span> LABEL_71;<br>      v30 = v7 - v26;<br>      <span class="hljs-keyword">if</span> ( v30 &gt;= v25 )<br>        <span class="hljs-keyword">goto</span> LABEL_71;<br>      v7 = (<span class="hljs-type">unsigned</span> __int8)(BYTE2(v29) ^ *((_BYTE *)v21 + v30 + v25 * -v22 + <span class="hljs-number">32</span>));<br>      v31 = v8 - v26;<br>      <span class="hljs-keyword">if</span> ( v31 &gt;= v25 )<br>        <span class="hljs-keyword">goto</span> LABEL_71;<br>      v95 = (<span class="hljs-type">unsigned</span> __int8)(HIBYTE(v29) ^ *((_BYTE *)v21 + v31 + v25 * v23 + <span class="hljs-number">32</span>));<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    v95 = HIBYTE(a2);<br>  &#125;<br>  v32 = *(_DWORD **)(sub_7FF646AA1577() + <span class="hljs-number">8</span>);<br>  v33 = *(_DWORD **)(sub_7FF646AA1557() + <span class="hljs-number">8</span>);<br>  v34 = v33[<span class="hljs-number">6</span>];<br>  v35 = v33[<span class="hljs-number">4</span>];<br>  <span class="hljs-keyword">if</span> ( -v34 &gt;= v35 )<br>    <span class="hljs-keyword">goto</span> LABEL_71;<br>  v36 = -v34;<br>  v37 = v33[<span class="hljs-number">5</span>];<br>  v38 = v33[<span class="hljs-number">7</span>];<br>  v39 = v5 - v38;<br>  <span class="hljs-keyword">if</span> ( v39 &gt;= v37 )<br>    <span class="hljs-keyword">goto</span> LABEL_71;<br>  v40 = *((_BYTE *)v33 + v39 + v37 * v36 + <span class="hljs-number">32</span>);<br>  <span class="hljs-keyword">if</span> ( a3 )<br>  &#123;<br>    v41 = v32;<br>    v42 = v33;<br>    v94 = v40;<br>    <span class="hljs-keyword">if</span> ( *(_DWORD *)(a3 + <span class="hljs-number">8</span>) &lt;= <span class="hljs-number">1u</span> )<br>      <span class="hljs-keyword">goto</span> LABEL_71;<br>    v43 = *(_DWORD *)(a3 + <span class="hljs-number">20</span>);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    v41 = v32;<br>    v42 = v33;<br>    v94 = v40;<br>    v43 = a1[<span class="hljs-number">1</span>];<br>  &#125;<br>  v88 = v41;<br>  v44 = <span class="hljs-number">1</span> - v34;<br>  <span class="hljs-keyword">if</span> ( v44 &gt;= v35 )<br>    <span class="hljs-keyword">goto</span> LABEL_71;<br>  v45 = (<span class="hljs-type">unsigned</span> __int8)(v94 ^ v43) - v38;<br>  <span class="hljs-keyword">if</span> ( v45 &gt;= v37 )<br>    <span class="hljs-keyword">goto</span> LABEL_71;<br>  v46 = *((_BYTE *)v42 + v45 + v37 * v44 + <span class="hljs-number">32</span>);<br>  <span class="hljs-keyword">if</span> ( a3 )<br>  &#123;<br>    v47 = v88;<br>    <span class="hljs-keyword">if</span> ( !*(_DWORD *)(a3 + <span class="hljs-number">8</span>) )<br>      <span class="hljs-keyword">goto</span> LABEL_71;<br>    v93 = *(_DWORD *)(a3 + <span class="hljs-number">16</span>);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    v47 = v88;<br>    v93 = *a1;<br>  &#125;<br>  v48 = -v47[<span class="hljs-number">6</span>];<br>  <span class="hljs-keyword">if</span> ( v48 &gt;= v47[<span class="hljs-number">4</span>] )<br>    <span class="hljs-keyword">goto</span> LABEL_71;<br>  v49 = v47[<span class="hljs-number">5</span>];<br>  v50 = v49 * v48;<br>  v51 = (<span class="hljs-type">unsigned</span> __int8)(v93 ^ v46) - v47[<span class="hljs-number">7</span>];<br>  <span class="hljs-keyword">if</span> ( v51 &gt;= v49 )<br>    <span class="hljs-keyword">goto</span> LABEL_71;<br>  v52 = v47[v51 + <span class="hljs-number">8</span> + v50];<br>  v53 = v6 - v38;<br>  <span class="hljs-keyword">if</span> ( v53 &gt;= v37 )<br>    <span class="hljs-keyword">goto</span> LABEL_71;<br>  v54 = *((_BYTE *)v33 + v53 + v37 * v44 + <span class="hljs-number">32</span>);<br>  <span class="hljs-keyword">if</span> ( a3 )<br>  &#123;<br>    v55 = v32;<br>    v56 = v33;<br>    v92 = v54;<br>    <span class="hljs-keyword">if</span> ( *(_DWORD *)(a3 + <span class="hljs-number">8</span>) &lt;= <span class="hljs-number">1u</span> )<br>      <span class="hljs-keyword">goto</span> LABEL_71;<br>    v57 = *(_DWORD *)(a3 + <span class="hljs-number">20</span>) &gt;&gt; <span class="hljs-number">8</span>;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    v55 = v32;<br>    v56 = v33;<br>    v92 = v54;<br>    v57 = (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)a1[<span class="hljs-number">1</span>] &gt;&gt; <span class="hljs-number">8</span>;<br>  &#125;<br>  v91 = v52;<br>  v58 = (<span class="hljs-type">unsigned</span> __int8)(v57 ^ v92) - v38;<br>  <span class="hljs-keyword">if</span> ( v58 &gt;= v37 )<br>    <span class="hljs-keyword">goto</span> LABEL_71;<br>  v59 = *((_BYTE *)v56 + v58 + v37 * v44 + <span class="hljs-number">32</span>);<br>  <span class="hljs-keyword">if</span> ( a3 )<br>  &#123;<br>    v90 = v91;<br>    <span class="hljs-keyword">if</span> ( !*(_DWORD *)(a3 + <span class="hljs-number">8</span>) )<br>      <span class="hljs-keyword">goto</span> LABEL_71;<br>    v60 = *(_DWORD *)(a3 + <span class="hljs-number">16</span>) &gt;&gt; <span class="hljs-number">8</span>;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    v60 = (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)*a1 &gt;&gt; <span class="hljs-number">8</span>;<br>    v90 = v91;<br>  &#125;<br>  v61 = <span class="hljs-number">1</span> - v55[<span class="hljs-number">6</span>];<br>  <span class="hljs-keyword">if</span> ( v61 &gt;= v55[<span class="hljs-number">4</span>] )<br>    <span class="hljs-keyword">goto</span> LABEL_71;<br>  v62 = v49 * v61;<br>  v63 = (<span class="hljs-type">unsigned</span> __int8)(v60 ^ v59) - v55[<span class="hljs-number">7</span>];<br>  <span class="hljs-keyword">if</span> ( v63 &gt;= v49 )<br>    <span class="hljs-keyword">goto</span> LABEL_71;<br>  v64 = v55[v63 + <span class="hljs-number">8</span> + v62] ^ v90;<br>  v65 = v7 - v38;<br>  <span class="hljs-keyword">if</span> ( v65 &gt;= v37 )<br>    <span class="hljs-keyword">goto</span> LABEL_71;<br>  v66 = *((_BYTE *)v33 + v65 + v37 * v36 + <span class="hljs-number">32</span>);<br>  <span class="hljs-keyword">if</span> ( a3 )<br>  &#123;<br>    v67 = v33;<br>    <span class="hljs-keyword">if</span> ( *(_DWORD *)(a3 + <span class="hljs-number">8</span>) &lt;= <span class="hljs-number">1u</span> )<br>      <span class="hljs-keyword">goto</span> LABEL_71;<br>    v68 = HIWORD(*(_DWORD *)(a3 + <span class="hljs-number">20</span>));<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    v67 = v33;<br>    v68 = HIWORD(a1[<span class="hljs-number">1</span>]);<br>  &#125;<br>  v69 = (<span class="hljs-type">unsigned</span> __int8)(v68 ^ v66) - v38;<br>  <span class="hljs-keyword">if</span> ( v69 &gt;= v37 )<br>    <span class="hljs-keyword">goto</span> LABEL_71;<br>  v70 = *((_BYTE *)v67 + v69 + v37 * v36 + <span class="hljs-number">32</span>);<br>  <span class="hljs-keyword">if</span> ( a3 )<br>  &#123;<br>    v71 = v32;<br>    <span class="hljs-keyword">if</span> ( !*(_DWORD *)(a3 + <span class="hljs-number">8</span>) )<br>      <span class="hljs-keyword">goto</span> LABEL_71;<br>    v72 = HIWORD(*(_DWORD *)(a3 + <span class="hljs-number">16</span>));<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    v71 = v32;<br>    v72 = HIWORD(*a1);<br>  &#125;<br>  v73 = <span class="hljs-number">2</span> - v71[<span class="hljs-number">6</span>];<br>  <span class="hljs-keyword">if</span> ( v73 &gt;= v71[<span class="hljs-number">4</span>] )<br>    <span class="hljs-keyword">goto</span> LABEL_71;<br>  v74 = v49 * v73;<br>  v75 = (<span class="hljs-type">unsigned</span> __int8)(v72 ^ v70) - v71[<span class="hljs-number">7</span>];<br>  <span class="hljs-keyword">if</span> ( v75 &gt;= v49 )<br>    <span class="hljs-keyword">goto</span> LABEL_71;<br>  v76 = v71[v75 + <span class="hljs-number">8</span> + v74] ^ v64;<br>  v77 = v33;<br>  v78 = v37 * v44;<br>  <span class="hljs-keyword">if</span> ( v95 - v38 &gt;= v37 )<br>    <span class="hljs-keyword">goto</span> LABEL_71;<br>  v79 = *((_BYTE *)v33 + (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)(v95 - v38 + v78) + <span class="hljs-number">32</span>);<br>  <span class="hljs-keyword">if</span> ( a3 )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( *(_DWORD *)(a3 + <span class="hljs-number">8</span>) &lt;= <span class="hljs-number">1u</span> )<br>      <span class="hljs-keyword">goto</span> LABEL_71;<br>    v80 = HIBYTE(*(_DWORD *)(a3 + <span class="hljs-number">20</span>));<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    v80 = HIBYTE(a1[<span class="hljs-number">1</span>]);<br>  &#125;<br>  v81 = v37 * v36;<br>  v82 = (<span class="hljs-type">unsigned</span> __int8)(v80 ^ v79) - v38;<br>  <span class="hljs-keyword">if</span> ( v82 &gt;= v37 )<br>    <span class="hljs-keyword">goto</span> LABEL_71;<br>  v83 = *((_BYTE *)v77 + v82 + v81 + <span class="hljs-number">32</span>);<br>  <span class="hljs-keyword">if</span> ( a3 )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( !*(_DWORD *)(a3 + <span class="hljs-number">8</span>) )<br>      <span class="hljs-keyword">goto</span> LABEL_71;<br>    v84 = HIBYTE(*(_DWORD *)(a3 + <span class="hljs-number">16</span>));<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    v84 = HIBYTE(*a1);<br>  &#125;<br>  v85 = <span class="hljs-number">3</span> - v32[<span class="hljs-number">6</span>];<br>  <span class="hljs-keyword">if</span> ( v85 &gt;= v32[<span class="hljs-number">4</span>] || (v86 = (<span class="hljs-type">unsigned</span> __int8)(v84 ^ v83) - v32[<span class="hljs-number">7</span>], v86 &gt;= v49) )<br>LABEL_71:<br>    sub_7FF646BAEC50();<br>  <span class="hljs-keyword">return</span> v32[v86 + <span class="hljs-number">8</span> + v49 * v85] ^ (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v76;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="关键函数分析">关键函数分析</h3>
<p>结合 ai 分析出这是 <strong>Twofish</strong> 加密算法中核心函数
<code>g</code> 函数（或称 <code>h</code> 函数）的 <code>T-Table</code>
优化版实现，它负责处理 32 位数据，将其拆分为 4 个字节，通过 S
盒变换、密钥异或，最后通过 MDS 矩阵（这里被优化成了 4 个 T-Table
查询）</p>
<p>详细的逻辑分析：</p>
<h4 id="输入参数">输入参数</h4>
<p><code>a1</code>: 指向一个整数数组（可能是子密钥数组的一部分，用于非
a3 模式）</p>
<p><code>a2</code>: 输入的 32 位数据（即 X）</p>
<p><code>a3</code>: 指向加密上下文结构体（Context）</p>
<ul>
<li><code>*(a3 + 8)</code>: 可能代表密钥长度或 S 盒的层数（Twofish 的 S
盒根据密钥长度有 2, 3, 4 层变换）</li>
<li><code>*(a3 + 16)</code>: 对应 k_sbox[0]</li>
<li><code>*(a3 + 20)</code>: 对应 k_sbox[1]</li>
<li><code>*(a3 + 24)</code> / <code>*(a3 + 28)</code>: 对应更高级别的 S
盒密钥（如果密钥长度更长）</li>
</ul>
<h4 id="字节预处理s-盒前置变换">字节预处理（S 盒前置变换）</h4>
<p>代码开头将 <code>a2</code> 拆分为四个字节 <code>v5</code>,
<code>v6</code>, <code>v7</code>, <code>v8</code>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c">v5 = (<span class="hljs-type">unsigned</span> __int8)a2; <span class="hljs-comment">// Byte 0</span><br>v6 = BYTE1(a2);           <span class="hljs-comment">// Byte 1</span><br>v7 = BYTE2(a2);           <span class="hljs-comment">// Byte 2</span><br>v8 = HIBYTE(a2);          <span class="hljs-comment">// Byte 3</span><br></code></pre></td></tr></table></figure>
<p>随后根据 <code>*(a3 + 8)</code> 的值，对这些字节进行了多层变换，在
Twofish 中，如果密钥是 256 位，S 盒会有 4 层；192 位是 3 层；128 位是 2
层</p>
<p>如果 <code>v9 &gt;= 4</code>，字节会先异或 <code>*(a3 + 28)</code>
然后查一次 S 盒</p>
<p>如果 <code>v9 &gt;= 3</code>，字节会异或 <code>*(a3 + 24)</code>
再查一次 S 盒</p>
<p>这对应了 Twofish 规范中 h 函数根据密钥长度进行的迭代</p>
<h4 id="核心-t-table-查找">核心 T-Table 查找</h4>
<p>通过 <code>sub_7FF646AA1557()</code> 获取 S 盒表，通过
<code>sub_7FF646AA1577()</code> 获取 MDS 组合表（T-Table）</p>
<p>对于每一个字节，它执行了以下逻辑（以第一个字节 v5 为例）：</p>
<p>第一次 S 盒变换: <code>v40 = Sbox[v5]</code></p>
<p>异或密钥: <code>v40 ^ key1</code> (即 *(a3 + 20) 的对应字节)</p>
<p>第二次 S 盒变换: <code>v46 = Sbox[v40 ^ key1]</code></p>
<p>异或密钥: <code>v46 ^ key0</code> (即 *(a3 + 16) 的对应字节)</p>
<p>T-Table 最终查询: <code>v52 = T_Table_0[v46 ^ key0]</code></p>
<h4 id="结果合并">结果合并</h4>
<p>代码最后将四个字节的 T-Table 查询结果进行异或合并：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// 伪代码逻辑</span><br><span class="hljs-keyword">return</span> T0[idx0] ^ T1[idx1] ^ T2[idx2] ^ T3[idx3];<br></code></pre></td></tr></table></figure>
<p>这是 Twofish 的 MDS 矩阵相乘的 T-Table 表现形式</p>
<h4 id="与-twofish-算法的对应关系">与 Twofish 算法的对应关系</h4>
<table>

<thead>
<tr>
<th>反汇编代码位置</th>
<th>Twofish 算法组件</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>a3 + 16</code></td>
<td>S-word 0</td>
<td>密钥生成的 S 盒相关密钥</td>
</tr>
<tr>
<td><code>a3 + 20</code></td>
<td>S-word 1</td>
<td>密钥生成的 S 盒相关密钥</td>
</tr>
<tr>
<td><code>v32 (from ...1577)</code></td>
<td>T-Tables</td>
<td>预计算好的 MDS 矩阵与 S 盒组合表</td>
</tr>
<tr>
<td><code>v33 (from ...1557)</code></td>
<td>S-Boxes</td>
<td>基础 S 盒（RS 矩阵生成的固定 S 盒）</td>
</tr>
<tr>
<td><code>sub_7FF646BAEC50()</code></td>
<td>Panic/Error</td>
<td>数组越界或完整性检查失败时的报错函数</td>
</tr>
</tbody>
</table>
<h4 id="s-盒提取">S 盒提取</h4>
<p><code>sub_7FF646B1CC20</code> 中进行 S 盒变换，动调找到两个 256
字节的 S 盒和逆 S 盒</p>
<p><img src="/images/LilacCTF2026/dump_S1.png" srcset="/img/loading.gif" lazyload /></p>
<p><img src="/images/LilacCTF2026/dump_S2.png" srcset="/img/loading.gif" lazyload /></p>
<h3 id="exp-2">Exp</h3>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> struct<br>SBOX = [<br>     <span class="hljs-number">0x63</span>, <span class="hljs-number">0x7C</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0x7B</span>, <span class="hljs-number">0xF2</span>, <span class="hljs-number">0x6B</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0xC5</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x01</span>, <br>  <span class="hljs-number">0x67</span>, <span class="hljs-number">0x2B</span>, <span class="hljs-number">0xFE</span>, <span class="hljs-number">0xD7</span>, <span class="hljs-number">0xAB</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0xCA</span>, <span class="hljs-number">0x82</span>, <span class="hljs-number">0xC9</span>, <span class="hljs-number">0x7D</span>, <br>  <span class="hljs-number">0xFA</span>, <span class="hljs-number">0x59</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0xF0</span>, <span class="hljs-number">0xAD</span>, <span class="hljs-number">0xD4</span>, <span class="hljs-number">0xA2</span>, <span class="hljs-number">0xAF</span>, <span class="hljs-number">0x9C</span>, <span class="hljs-number">0xA4</span>, <br>  <span class="hljs-number">0x72</span>, <span class="hljs-number">0xC0</span>, <span class="hljs-number">0xB7</span>, <span class="hljs-number">0xFD</span>, <span class="hljs-number">0x93</span>, <span class="hljs-number">0x26</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x3F</span>, <span class="hljs-number">0xF7</span>, <span class="hljs-number">0xCC</span>, <br>  <span class="hljs-number">0x34</span>, <span class="hljs-number">0xA5</span>, <span class="hljs-number">0xE5</span>, <span class="hljs-number">0xF1</span>, <span class="hljs-number">0x71</span>, <span class="hljs-number">0xD8</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x15</span>, <span class="hljs-number">0x04</span>, <span class="hljs-number">0xC7</span>, <br>  <span class="hljs-number">0x23</span>, <span class="hljs-number">0xC3</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0x96</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0x9A</span>, <span class="hljs-number">0x07</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0xE2</span>, <br>  <span class="hljs-number">0xEB</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0xB2</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0x09</span>, <span class="hljs-number">0x83</span>, <span class="hljs-number">0x2C</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0x1B</span>, <span class="hljs-number">0x6E</span>, <br>  <span class="hljs-number">0x5A</span>, <span class="hljs-number">0xA0</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0x3B</span>, <span class="hljs-number">0xD6</span>, <span class="hljs-number">0xB3</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0xE3</span>, <span class="hljs-number">0x2F</span>, <span class="hljs-number">0x84</span>, <br>  <span class="hljs-number">0x53</span>, <span class="hljs-number">0xD1</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0xED</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0xFC</span>, <span class="hljs-number">0xB1</span>, <span class="hljs-number">0x5B</span>, <span class="hljs-number">0x6A</span>, <span class="hljs-number">0xCB</span>, <br>  <span class="hljs-number">0xBE</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x4A</span>, <span class="hljs-number">0x4C</span>, <span class="hljs-number">0x58</span>, <span class="hljs-number">0xCF</span>, <span class="hljs-number">0xD0</span>, <span class="hljs-number">0xEF</span>, <span class="hljs-number">0xAA</span>, <span class="hljs-number">0xFB</span>, <br>  <span class="hljs-number">0x43</span>, <span class="hljs-number">0x4D</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x85</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0xF9</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x7F</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x3C</span>, <br>  <span class="hljs-number">0x9F</span>, <span class="hljs-number">0xA8</span>, <span class="hljs-number">0x51</span>, <span class="hljs-number">0xA3</span>, <span class="hljs-number">0x40</span>, <span class="hljs-number">0x8F</span>, <span class="hljs-number">0x92</span>, <span class="hljs-number">0x9D</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0xF5</span>, <br>  <span class="hljs-number">0xBC</span>, <span class="hljs-number">0xB6</span>, <span class="hljs-number">0xDA</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0xF3</span>, <span class="hljs-number">0xD2</span>, <span class="hljs-number">0xCD</span>, <span class="hljs-number">0x0C</span>, <br>  <span class="hljs-number">0x13</span>, <span class="hljs-number">0xEC</span>, <span class="hljs-number">0x5F</span>, <span class="hljs-number">0x97</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0xC4</span>, <span class="hljs-number">0xA7</span>, <span class="hljs-number">0x7E</span>, <span class="hljs-number">0x3D</span>, <br>  <span class="hljs-number">0x64</span>, <span class="hljs-number">0x5D</span>, <span class="hljs-number">0x19</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0x60</span>, <span class="hljs-number">0x81</span>, <span class="hljs-number">0x4F</span>, <span class="hljs-number">0xDC</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0x2A</span>, <br>  <span class="hljs-number">0x90</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0xEE</span>, <span class="hljs-number">0xB8</span>, <span class="hljs-number">0x14</span>, <span class="hljs-number">0xDE</span>, <span class="hljs-number">0x5E</span>, <span class="hljs-number">0x0B</span>, <span class="hljs-number">0xDB</span>, <br>  <span class="hljs-number">0xE0</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0x3A</span>, <span class="hljs-number">0x0A</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0x5C</span>, <span class="hljs-number">0xC2</span>, <span class="hljs-number">0xD3</span>, <br>  <span class="hljs-number">0xAC</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0xE4</span>, <span class="hljs-number">0x79</span>, <span class="hljs-number">0xE7</span>, <span class="hljs-number">0xC8</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0x6D</span>, <br>  <span class="hljs-number">0x8D</span>, <span class="hljs-number">0xD5</span>, <span class="hljs-number">0x4E</span>, <span class="hljs-number">0xA9</span>, <span class="hljs-number">0x6C</span>, <span class="hljs-number">0x56</span>, <span class="hljs-number">0xF4</span>, <span class="hljs-number">0xEA</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x7A</span>, <br>  <span class="hljs-number">0xAE</span>, <span class="hljs-number">0x08</span>, <span class="hljs-number">0xBA</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x25</span>, <span class="hljs-number">0x2E</span>, <span class="hljs-number">0x1C</span>, <span class="hljs-number">0xA6</span>, <span class="hljs-number">0xB4</span>, <span class="hljs-number">0xC6</span>, <br>  <span class="hljs-number">0xE8</span>, <span class="hljs-number">0xDD</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x1F</span>, <span class="hljs-number">0x4B</span>, <span class="hljs-number">0xBD</span>, <span class="hljs-number">0x8B</span>, <span class="hljs-number">0x8A</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0x3E</span>, <br>  <span class="hljs-number">0xB5</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0xF6</span>, <span class="hljs-number">0x0E</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0xB9</span>, <br>  <span class="hljs-number">0x86</span>, <span class="hljs-number">0xC1</span>, <span class="hljs-number">0x1D</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0xE1</span>, <span class="hljs-number">0xF8</span>, <span class="hljs-number">0x98</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0xD9</span>, <br>  <span class="hljs-number">0x8E</span>, <span class="hljs-number">0x94</span>, <span class="hljs-number">0x9B</span>, <span class="hljs-number">0x1E</span>, <span class="hljs-number">0x87</span>, <span class="hljs-number">0xE9</span>, <span class="hljs-number">0xCE</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0x28</span>, <span class="hljs-number">0xDF</span>, <br>  <span class="hljs-number">0x8C</span>, <span class="hljs-number">0xA1</span>, <span class="hljs-number">0x89</span>, <span class="hljs-number">0x0D</span>, <span class="hljs-number">0xBF</span>, <span class="hljs-number">0xE6</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x68</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x99</span>, <br>  <span class="hljs-number">0x2D</span>, <span class="hljs-number">0x0F</span>, <span class="hljs-number">0xB0</span>, <span class="hljs-number">0x54</span>, <span class="hljs-number">0xBB</span>, <span class="hljs-number">0x16</span><br>]<br>INV_SBOX = [<br>  <span class="hljs-number">0x52</span>, <span class="hljs-number">0x09</span>, <span class="hljs-number">0x6A</span>, <span class="hljs-number">0xD5</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0xA5</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0xBF</span>, <span class="hljs-number">0x40</span>, <br>  <span class="hljs-number">0xA3</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0x81</span>, <span class="hljs-number">0xF3</span>, <span class="hljs-number">0xD7</span>, <span class="hljs-number">0xFB</span>, <span class="hljs-number">0x7C</span>, <span class="hljs-number">0xE3</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x82</span>, <br>  <span class="hljs-number">0x9B</span>, <span class="hljs-number">0x2F</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0x87</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x8E</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0xC4</span>, <span class="hljs-number">0xDE</span>, <br>  <span class="hljs-number">0xE9</span>, <span class="hljs-number">0xCB</span>, <span class="hljs-number">0x54</span>, <span class="hljs-number">0x7B</span>, <span class="hljs-number">0x94</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0xA6</span>, <span class="hljs-number">0xC2</span>, <span class="hljs-number">0x23</span>, <span class="hljs-number">0x3D</span>, <br>  <span class="hljs-number">0xEE</span>, <span class="hljs-number">0x4C</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0x0B</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0xFA</span>, <span class="hljs-number">0xC3</span>, <span class="hljs-number">0x4E</span>, <span class="hljs-number">0x08</span>, <span class="hljs-number">0x2E</span>, <br>  <span class="hljs-number">0xA1</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0x28</span>, <span class="hljs-number">0xD9</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0xB2</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0x5B</span>, <span class="hljs-number">0xA2</span>, <span class="hljs-number">0x49</span>, <br>  <span class="hljs-number">0x6D</span>, <span class="hljs-number">0x8B</span>, <span class="hljs-number">0xD1</span>, <span class="hljs-number">0x25</span>, <span class="hljs-number">0x72</span>, <span class="hljs-number">0xF8</span>, <span class="hljs-number">0xF6</span>, <span class="hljs-number">0x64</span>, <span class="hljs-number">0x86</span>, <span class="hljs-number">0x68</span>, <br>  <span class="hljs-number">0x98</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0xD4</span>, <span class="hljs-number">0xA4</span>, <span class="hljs-number">0x5C</span>, <span class="hljs-number">0xCC</span>, <span class="hljs-number">0x5D</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0xB6</span>, <span class="hljs-number">0x92</span>, <br>  <span class="hljs-number">0x6C</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0xFD</span>, <span class="hljs-number">0xED</span>, <span class="hljs-number">0xB9</span>, <span class="hljs-number">0xDA</span>, <span class="hljs-number">0x5E</span>, <span class="hljs-number">0x15</span>, <br>  <span class="hljs-number">0x46</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0xA7</span>, <span class="hljs-number">0x8D</span>, <span class="hljs-number">0x9D</span>, <span class="hljs-number">0x84</span>, <span class="hljs-number">0x90</span>, <span class="hljs-number">0xD8</span>, <span class="hljs-number">0xAB</span>, <span class="hljs-number">0x00</span>, <br>  <span class="hljs-number">0x8C</span>, <span class="hljs-number">0xBC</span>, <span class="hljs-number">0xD3</span>, <span class="hljs-number">0x0A</span>, <span class="hljs-number">0xF7</span>, <span class="hljs-number">0xE4</span>, <span class="hljs-number">0x58</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0xB8</span>, <span class="hljs-number">0xB3</span>, <br>  <span class="hljs-number">0x45</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0xD0</span>, <span class="hljs-number">0x2C</span>, <span class="hljs-number">0x1E</span>, <span class="hljs-number">0x8F</span>, <span class="hljs-number">0xCA</span>, <span class="hljs-number">0x3F</span>, <span class="hljs-number">0x0F</span>, <span class="hljs-number">0x02</span>, <br>  <span class="hljs-number">0xC1</span>, <span class="hljs-number">0xAF</span>, <span class="hljs-number">0xBD</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0x13</span>, <span class="hljs-number">0x8A</span>, <span class="hljs-number">0x6B</span>, <span class="hljs-number">0x3A</span>, <span class="hljs-number">0x91</span>, <br>  <span class="hljs-number">0x11</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x4F</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0xDC</span>, <span class="hljs-number">0xEA</span>, <span class="hljs-number">0x97</span>, <span class="hljs-number">0xF2</span>, <span class="hljs-number">0xCF</span>, <span class="hljs-number">0xCE</span>, <br>  <span class="hljs-number">0xF0</span>, <span class="hljs-number">0xB4</span>, <span class="hljs-number">0xE6</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0x96</span>, <span class="hljs-number">0xAC</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0xE7</span>, <span class="hljs-number">0xAD</span>, <br>  <span class="hljs-number">0x35</span>, <span class="hljs-number">0x85</span>, <span class="hljs-number">0xE2</span>, <span class="hljs-number">0xF9</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0xE8</span>, <span class="hljs-number">0x1C</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0xDF</span>, <span class="hljs-number">0x6E</span>, <br>  <span class="hljs-number">0x47</span>, <span class="hljs-number">0xF1</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0x71</span>, <span class="hljs-number">0x1D</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0xC5</span>, <span class="hljs-number">0x89</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0xB7</span>, <br>  <span class="hljs-number">0x62</span>, <span class="hljs-number">0x0E</span>, <span class="hljs-number">0xAA</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0xBE</span>, <span class="hljs-number">0x1B</span>, <span class="hljs-number">0xFC</span>, <span class="hljs-number">0x56</span>, <span class="hljs-number">0x3E</span>, <span class="hljs-number">0x4B</span>, <br>  <span class="hljs-number">0xC6</span>, <span class="hljs-number">0xD2</span>, <span class="hljs-number">0x79</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x9A</span>, <span class="hljs-number">0xDB</span>, <span class="hljs-number">0xC0</span>, <span class="hljs-number">0xFE</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0xCD</span>, <br>  <span class="hljs-number">0x5A</span>, <span class="hljs-number">0xF4</span>, <span class="hljs-number">0x1F</span>, <span class="hljs-number">0xDD</span>, <span class="hljs-number">0xA8</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0x07</span>, <span class="hljs-number">0xC7</span>, <span class="hljs-number">0x31</span>, <br>  <span class="hljs-number">0xB1</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0x59</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0xEC</span>, <span class="hljs-number">0x5F</span>, <span class="hljs-number">0x60</span>, <span class="hljs-number">0x51</span>, <br>  <span class="hljs-number">0x7F</span>, <span class="hljs-number">0xA9</span>, <span class="hljs-number">0x19</span>, <span class="hljs-number">0xB5</span>, <span class="hljs-number">0x4A</span>, <span class="hljs-number">0x0D</span>, <span class="hljs-number">0x2D</span>, <span class="hljs-number">0xE5</span>, <span class="hljs-number">0x7A</span>, <span class="hljs-number">0x9F</span>, <br>  <span class="hljs-number">0x93</span>, <span class="hljs-number">0xC9</span>, <span class="hljs-number">0x9C</span>, <span class="hljs-number">0xEF</span>, <span class="hljs-number">0xA0</span>, <span class="hljs-number">0xE0</span>, <span class="hljs-number">0x3B</span>, <span class="hljs-number">0x4D</span>, <span class="hljs-number">0xAE</span>, <span class="hljs-number">0x2A</span>, <br>  <span class="hljs-number">0xF5</span>, <span class="hljs-number">0xB0</span>, <span class="hljs-number">0xC8</span>, <span class="hljs-number">0xEB</span>, <span class="hljs-number">0xBB</span>, <span class="hljs-number">0x3C</span>, <span class="hljs-number">0x83</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x99</span>, <span class="hljs-number">0x61</span>, <br>  <span class="hljs-number">0x17</span>, <span class="hljs-number">0x2B</span>, <span class="hljs-number">0x04</span>, <span class="hljs-number">0x7E</span>, <span class="hljs-number">0xBA</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0xD6</span>, <span class="hljs-number">0x26</span>, <span class="hljs-number">0xE1</span>, <span class="hljs-number">0x69</span>, <br>  <span class="hljs-number">0x14</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0x0C</span>, <span class="hljs-number">0x7D</span><br>]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rot_left32</span>(<span class="hljs-params">x, n</span>):<br>    <span class="hljs-keyword">return</span> ((x &lt;&lt; n) &amp; <span class="hljs-number">0xFFFFFFFF</span>) | (x &gt;&gt; (<span class="hljs-number">32</span> - n))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rot_right32</span>(<span class="hljs-params">x, n</span>):<br>    <span class="hljs-keyword">return</span> (x &gt;&gt; n) | ((x &lt;&lt; (<span class="hljs-number">32</span> - n)) &amp; <span class="hljs-number">0xFFFFFFFF</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">gf_derive_step</span>(<span class="hljs-params">val, poly=<span class="hljs-number">0x11B</span></span>):<br>    val &amp;= <span class="hljs-number">0xFF</span><br>    v_high = (poly &gt;&gt; <span class="hljs-number">1</span>) <span class="hljs-keyword">if</span> (val &amp; <span class="hljs-number">2</span>) <span class="hljs-keyword">else</span> <span class="hljs-number">0</span><br>    v_mid = v_high ^ (val &gt;&gt; <span class="hljs-number">2</span>)<br>    v_low = (poly &gt;&gt; <span class="hljs-number">2</span>) <span class="hljs-keyword">if</span> (val &amp; <span class="hljs-number">1</span>) <span class="hljs-keyword">else</span> <span class="hljs-number">0</span><br>    <span class="hljs-keyword">return</span> (v_low ^ v_mid) &amp; <span class="hljs-number">0xFF</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_transformation_tables</span>():<br>    tables = [[<span class="hljs-number">0</span>] * <span class="hljs-number">256</span> <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>)]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>        s_val = SBOX[i]<br>        t_val = gf_derive_step(s_val, <span class="hljs-number">0x11B</span>)<br>        mixed_a = s_val ^ t_val<br>        poly_bit = <span class="hljs-number">0x8D</span> <span class="hljs-keyword">if</span> (s_val &amp; <span class="hljs-number">1</span>) <span class="hljs-keyword">else</span> <span class="hljs-number">0</span><br>        mixed_b = (t_val ^ s_val ^ (s_val &gt;&gt; <span class="hljs-number">1</span>) ^ poly_bit) &amp; <span class="hljs-number">0xFF</span><br>        <br>        entry = ((s_val &lt;&lt; <span class="hljs-number">24</span>) | (mixed_b &lt;&lt; <span class="hljs-number">16</span>) | mixed_a | (s_val &lt;&lt; <span class="hljs-number">8</span>)) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>        tables[<span class="hljs-number">0</span>][i] = entry<br>        tables[<span class="hljs-number">1</span>][i] = ((mixed_b &lt;&lt; <span class="hljs-number">24</span>) | (mixed_a &lt;&lt; <span class="hljs-number">16</span>) | s_val | (mixed_b &lt;&lt; <span class="hljs-number">8</span>)) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>        tables[<span class="hljs-number">2</span>][i] = ((mixed_a &lt;&lt; <span class="hljs-number">24</span>) | (s_val &lt;&lt; <span class="hljs-number">16</span>) | mixed_b | (mixed_a &lt;&lt; <span class="hljs-number">8</span>)) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>        tables[<span class="hljs-number">3</span>][i] = entry <br>    <span class="hljs-keyword">return</span> tables<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">custom_whitening_transform</span>(<span class="hljs-params">key_word_a, key_word_b</span>):<br>    state = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>):<br>        input_word = key_word_a <span class="hljs-keyword">if</span> i &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> key_word_b<br>        state ^= input_word<br>        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>            high_byte = (state &gt;&gt; <span class="hljs-number">24</span>) &amp; <span class="hljs-number">0xFF</span><br>            mul_2 = (high_byte * <span class="hljs-number">2</span>) &amp; <span class="hljs-number">0xFF</span><br>            <span class="hljs-keyword">if</span> high_byte &amp; <span class="hljs-number">0x80</span>:<br>                mul_2 ^= <span class="hljs-number">0x11D</span><br>            <br>            mul_2 &amp;= <span class="hljs-number">0xFF</span><br>            div_2 = (high_byte &gt;&gt; <span class="hljs-number">1</span>) &amp; <span class="hljs-number">0x7F</span><br>            <span class="hljs-keyword">if</span> high_byte &amp; <span class="hljs-number">1</span>:<br>                div_2 ^= <span class="hljs-number">0x8E</span><br>            <br>            xor_res = (div_2 ^ mul_2) &amp; <span class="hljs-number">0xFF</span><br>            <br>            b0 = (state ^ xor_res) &amp; <span class="hljs-number">0xFF</span><br>            b1 = ((state &gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xFF</span> ^ mul_2) &amp; <span class="hljs-number">0xFF</span><br>            b2 = ((state &gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xFF</span> ^ xor_res) &amp; <span class="hljs-number">0xFF</span><br>            b3 = high_byte <span class="hljs-comment"># 保留原高位</span><br>            <br>            state = (b2 &lt;&lt; <span class="hljs-number">16</span> | b3 &lt;&lt; <span class="hljs-number">24</span> | b1 &lt;&lt; <span class="hljs-number">8</span> | b0) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>    <span class="hljs-keyword">return</span> state<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">g_transform</span>(<span class="hljs-params">word, k0, k1, t_tables</span>):<br>    bytes_val = [<br>        word &amp; <span class="hljs-number">0xFF</span>,<br>        (word &gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xFF</span>,<br>        (word &gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xFF</span>,<br>        (word &gt;&gt; <span class="hljs-number">24</span>) &amp; <span class="hljs-number">0xFF</span><br>    ]<br>    <br>    k0_bytes = [(k0 &gt;&gt; (i * <span class="hljs-number">8</span>)) &amp; <span class="hljs-number">0xFF</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>)]<br>    k1_bytes = [(k1 &gt;&gt; (i * <span class="hljs-number">8</span>)) &amp; <span class="hljs-number">0xFF</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>)]<br><br>    <span class="hljs-comment"># 字节 0: S -&gt; InvS -&gt; T0</span><br>    idx0 = INV_SBOX[SBOX[bytes_val[<span class="hljs-number">0</span>]] ^ k1_bytes[<span class="hljs-number">0</span>]] ^ k0_bytes[<span class="hljs-number">0</span>]<br>    <span class="hljs-comment"># 字节 1: InvS -&gt; InvS -&gt; T1</span><br>    idx1 = INV_SBOX[INV_SBOX[bytes_val[<span class="hljs-number">1</span>]] ^ k1_bytes[<span class="hljs-number">1</span>]] ^ k0_bytes[<span class="hljs-number">1</span>]<br>    <span class="hljs-comment"># 字节 2: S -&gt; S -&gt; T2</span><br>    idx2 = SBOX[SBOX[bytes_val[<span class="hljs-number">2</span>]] ^ k1_bytes[<span class="hljs-number">2</span>]] ^ k0_bytes[<span class="hljs-number">2</span>]<br>    <span class="hljs-comment"># 字节 3: InvS -&gt; S -&gt; T3</span><br>    idx3 = SBOX[INV_SBOX[bytes_val[<span class="hljs-number">3</span>]] ^ k1_bytes[<span class="hljs-number">3</span>]] ^ k0_bytes[<span class="hljs-number">3</span>]<br><br>    <span class="hljs-keyword">return</span> (t_tables[<span class="hljs-number">0</span>][idx0] ^ t_tables[<span class="hljs-number">1</span>][idx1] ^ t_tables[<span class="hljs-number">2</span>][idx2] ^ t_tables[<span class="hljs-number">3</span>][idx3]) &amp; <span class="hljs-number">0xFFFFFFFF</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">expand_key</span>(<span class="hljs-params">key_bytes, t_tables</span>):<br><br>    words = [<span class="hljs-built_in">int</span>.from_bytes(key_bytes[i:i + <span class="hljs-number">4</span>], <span class="hljs-string">&quot;little&quot;</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">16</span>, <span class="hljs-number">4</span>)]<br>    even_words = [words[<span class="hljs-number">0</span>], words[<span class="hljs-number">2</span>]]<br>    odd_words = [words[<span class="hljs-number">1</span>], words[<span class="hljs-number">3</span>]]<br>    <br>    sbox_keys = [<br>        custom_whitening_transform(even_words[<span class="hljs-number">1</span>], odd_words[<span class="hljs-number">1</span>]),<br>        custom_whitening_transform(even_words[<span class="hljs-number">0</span>], odd_words[<span class="hljs-number">0</span>])<br>    ]<br><br>    subkeys = [<span class="hljs-number">0</span>] * <span class="hljs-number">40</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">20</span>):<br>        val_a = (<span class="hljs-number">0x0A0A0A0A</span> * i) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>        val_b = (val_a + <span class="hljs-number">0x0D0D0D0D</span>) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>        <br>        pk_a = g_transform(val_a, even_words[<span class="hljs-number">0</span>], even_words[<span class="hljs-number">1</span>], t_tables)<br>        pk_b = rot_left32(g_transform(val_b, odd_words[<span class="hljs-number">0</span>], odd_words[<span class="hljs-number">1</span>], t_tables), <span class="hljs-number">8</span>)<br>        <br>        subkeys[<span class="hljs-number">2</span> * i] = (pk_a + pk_b) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>        subkeys[<span class="hljs-number">2</span> * i + <span class="hljs-number">1</span>] = rot_left32((pk_a + <span class="hljs-number">2</span> * pk_b) &amp; <span class="hljs-number">0xFFFFFFFF</span>, <span class="hljs-number">13</span>)<br>        <br>    <span class="hljs-keyword">return</span> sbox_keys, subkeys<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt_block</span>(<span class="hljs-params">cipher_block, sbox_keys, subkeys, t_tables</span>):<br>    data = [<br>        <span class="hljs-built_in">int</span>.from_bytes(cipher_block[<span class="hljs-number">0</span>:<span class="hljs-number">4</span>], <span class="hljs-string">&quot;little&quot;</span>) ^ subkeys[<span class="hljs-number">4</span>],<br>        <span class="hljs-built_in">int</span>.from_bytes(cipher_block[<span class="hljs-number">4</span>:<span class="hljs-number">8</span>], <span class="hljs-string">&quot;little&quot;</span>) ^ subkeys[<span class="hljs-number">5</span>],<br>        <span class="hljs-built_in">int</span>.from_bytes(cipher_block[<span class="hljs-number">8</span>:<span class="hljs-number">12</span>], <span class="hljs-string">&quot;little&quot;</span>) ^ subkeys[<span class="hljs-number">6</span>],<br>        <span class="hljs-built_in">int</span>.from_bytes(cipher_block[<span class="hljs-number">12</span>:<span class="hljs-number">16</span>], <span class="hljs-string">&quot;little&quot;</span>) ^ subkeys[<span class="hljs-number">7</span>]<br>    ]<br><br>    <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">15</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">if</span> r &lt; <span class="hljs-number">15</span>:<br>            data[<span class="hljs-number">0</span>], data[<span class="hljs-number">2</span>] = data[<span class="hljs-number">2</span>], data[<span class="hljs-number">0</span>]<br>            data[<span class="hljs-number">1</span>], data[<span class="hljs-number">3</span>] = data[<span class="hljs-number">3</span>], data[<span class="hljs-number">1</span>]<br>        <br>        data[<span class="hljs-number">2</span>] = rot_right32(data[<span class="hljs-number">2</span>], <span class="hljs-number">27</span>)<br>        <br>        f_a = g_transform(data[<span class="hljs-number">0</span>], sbox_keys[<span class="hljs-number">0</span>], sbox_keys[<span class="hljs-number">1</span>], t_tables)<br>        f_b = g_transform(rot_left32(data[<span class="hljs-number">1</span>], <span class="hljs-number">8</span>), sbox_keys[<span class="hljs-number">0</span>], sbox_keys[<span class="hljs-number">1</span>], t_tables)<br>        <br>        data[<span class="hljs-number">3</span>] ^= (subkeys[<span class="hljs-number">2</span> * r + <span class="hljs-number">9</span>] + f_a + <span class="hljs-number">2</span> * f_b) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>        data[<span class="hljs-number">2</span>] ^= (subkeys[<span class="hljs-number">2</span> * r + <span class="hljs-number">8</span>] + f_a + f_b) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>        <br>        data[<span class="hljs-number">3</span>] = rot_right32(data[<span class="hljs-number">3</span>], <span class="hljs-number">5</span>)<br><br>    out = [<br>        data[<span class="hljs-number">0</span>] ^ subkeys[<span class="hljs-number">0</span>],<br>        data[<span class="hljs-number">1</span>] ^ subkeys[<span class="hljs-number">1</span>],<br>        data[<span class="hljs-number">2</span>] ^ subkeys[<span class="hljs-number">2</span>],<br>        data[<span class="hljs-number">3</span>] ^ subkeys[<span class="hljs-number">3</span>]<br>    ]<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-string">b&quot;&quot;</span>.join(x.to_bytes(<span class="hljs-number">4</span>, <span class="hljs-string">&quot;little&quot;</span>) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> out)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    t_tables = generate_transformation_tables()<br>    <br>    key = <span class="hljs-string">b&quot;WONDERFUL&amp;&amp;PEACE&quot;</span><br>    cipher_hex = <span class="hljs-string">&quot;A20492152735B4F6ECBAA359DB64417BDF277A73B085666034CF38E748D8FBD4&quot;</span><br>    cipher_bytes = <span class="hljs-built_in">bytes</span>.fromhex(cipher_hex)<br><br>    sbox_keys, subkeys = expand_key(key, t_tables)<br><br>    plaintext = <span class="hljs-string">b&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(cipher_bytes), <span class="hljs-number">16</span>):<br>        plaintext += decrypt_block(cipher_bytes[i:i + <span class="hljs-number">16</span>], sbox_keys, subkeys, t_tables)<br><br>    plaintext = plaintext.rstrip(<span class="hljs-string">b&quot;\x00&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Ciphertext Hex: <span class="hljs-subst">&#123;cipher_hex&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Plaintext Hex: <span class="hljs-subst">&#123;plaintext.<span class="hljs-built_in">hex</span>()&#125;</span>&quot;</span>)<br>    <br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Plaintext String: <span class="hljs-subst">&#123;plaintext.decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">except</span> UnicodeDecodeError:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Plaintext contains non-UTF-8 characters.&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br><br><br><span class="hljs-comment"># Key: WONDERFUL&amp;&amp;PEACE</span><br><span class="hljs-comment"># Ciphertext Hex: A20492152735B4F6ECBAA359DB64417BDF277A73B085666034CF38E748D8FBD4</span><br><span class="hljs-comment"># Plaintext Hex: 4c696c61634354467b495f6a7533745f77406e6e415f62335f68617050797d</span><br><span class="hljs-comment"># Plaintext String: LilacCTF&#123;I_ju3t_w@nnA_b3_hapPy&#125;</span><br></code></pre></td></tr></table></figure>
<p>flag 为 <code>LilacCTF&#123;I_ju3t_w@nnA_b3_hapPy&#125;</code></p>
<h2 id="nineapple">NineApple</h2>
<h3 id="初步分析">初步分析</h3>
<p>附件的文件结构如下</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stylus">embedded<span class="hljs-selector-class">.mobileprovision</span><br>Info<span class="hljs-selector-class">.plist</span><br>Nine<br>PkgInfo<br>_CodeSignature<br>  └─CodeResources<br></code></pre></td></tr></table></figure>
<p>查了一下是 iOS 应用程序包的内部结构，主要分析的二进制文件是 Nine</p>
<p>ida 反编译，是个用 swift 写的程序，搜索字符串看到了 Right 和
Wrong，还有其他一些看着像有用信息的字符串，根据命名可以大概猜到这个是跟手势解锁相关的，后续分析也验证了这一点</p>
<p><img src="/images/LilacCTF2026/nine1.png" srcset="/img/loading.gif" lazyload /></p>
<p>根据字符串交叉引用定位到相关函数</p>
<h3 id="相关函数">相关函数</h3>
<h4 id="sub_100006d08"><code>sub_100006D08</code></h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64 <span class="hljs-title function_">sub_100006D08</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-comment">// [COLLAPSED LOCAL DECLARATIONS. PRESS NUMPAD &quot;+&quot; TO EXPAND]</span><br><br>  v3 = v0;<br>  KeyPath = swift_getKeyPath(&amp;unk_100009AA0);<br>  v5 = swift_getKeyPath(&amp;unk_100009AC8);<br>  <span class="hljs-type">static</span> Published.subscript.getter(v79, v3, KeyPath, v5);<br>  swift_release(KeyPath);<br>  swift_release(v5);<br>  v6 = (<span class="hljs-type">char</span> *)v79[<span class="hljs-number">0</span>];<br>  v7 = *(_QWORD *)(v79[<span class="hljs-number">0</span>] + <span class="hljs-number">16LL</span>);<br>  <span class="hljs-keyword">if</span> ( v7 )<br>  &#123;<br>    v79[<span class="hljs-number">0</span>] = &amp;_swiftEmptyArrayStorage;<br>    v8 = v79;<br>    sub_1000081C8(<span class="hljs-number">0</span>, v7, <span class="hljs-number">0</span>);<br>    v9 = <span class="hljs-number">32</span>;<br>    v10 = (_QWORD *)v79[<span class="hljs-number">0</span>];<br>    <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>    &#123;<br>      v11 = *(_QWORD *)&amp;v6[v9];<br>      v12 = __OFADD__(v11, <span class="hljs-number">1</span>);<br>      v13 = v11 + <span class="hljs-number">1</span>;<br>      <span class="hljs-keyword">if</span> ( v12 )<br>        <span class="hljs-keyword">break</span>;<br>      v77 = v13;<br>      v8 = &amp;v77;<br>      v14 = dispatch thunk of CustomStringConvertible.description.getter(<br>              &amp;type metadata <span class="hljs-keyword">for</span> Int,<br>              &amp;protocol witness table <span class="hljs-keyword">for</span> Int);<br>      v79[<span class="hljs-number">0</span>] = v10;<br>      v2 = v10[<span class="hljs-number">2</span>];<br>      v16 = v10[<span class="hljs-number">3</span>];<br>      v1 = (<span class="hljs-type">unsigned</span> __int64 *)(v2 + <span class="hljs-number">1</span>);<br>      <span class="hljs-keyword">if</span> ( v2 &gt;= v16 &gt;&gt; <span class="hljs-number">1</span> )<br>      &#123;<br>        v8 = v79;<br>        v76 = v14;<br>        v18 = v3;<br>        v19 = v15;<br>        sub_1000081C8(v16 &gt; <span class="hljs-number">1</span>, v2 + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);<br>        v15 = v19;<br>        v3 = v18;<br>        v14 = v76;<br>        v10 = (_QWORD *)v79[<span class="hljs-number">0</span>];<br>      &#125;<br>      v10[<span class="hljs-number">2</span>] = v1;<br>      v17 = (<span class="hljs-type">char</span> *)&amp;v10[<span class="hljs-number">2</span> * v2];<br>      *((_QWORD *)v17 + <span class="hljs-number">4</span>) = v14;<br>      *((_QWORD *)v17 + <span class="hljs-number">5</span>) = v15;<br>      v9 += <span class="hljs-number">8</span>;<br>      <span class="hljs-keyword">if</span> ( !--v7 )<br>      &#123;<br>        swift_bridgeObjectRelease(v6);<br>        <span class="hljs-keyword">goto</span> LABEL_9;<br>      &#125;<br>    &#125;<br>    __break(<span class="hljs-number">1u</span>);<br>LABEL_60:<br>    __break(<span class="hljs-number">1u</span>);<br>LABEL_61:<br>    __break(<span class="hljs-number">1u</span>);<br>LABEL_62:<br>    __break(<span class="hljs-number">1u</span>);<br>LABEL_63:<br>    __break(<span class="hljs-number">1u</span>);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    swift_bridgeObjectRelease(v79[<span class="hljs-number">0</span>]);<br>    v10 = &amp;_swiftEmptyArrayStorage;<br>LABEL_9:<br>    v79[<span class="hljs-number">0</span>] = v10;<br>    v20 = sub_1000050C0(&amp;unk_100010E60);<br>    v21 = sub_1000055DC(&amp;unk_100010E68, &amp;unk_100010E60, &amp;protocol conformance descriptor <span class="hljs-keyword">for</span> [A]);<br>    v7 = BidirectionalCollection&lt;&gt;.joined(separator:)(<span class="hljs-number">0</span>, <span class="hljs-number">0xE000000000000000L</span>L, v20, v21);<br>    v6 = v22;<br>    swift_bridgeObjectRelease(v10);<br>    v1 = (<span class="hljs-type">unsigned</span> __int64 *)OBJC_IVAR____TtC4Nine13LockViewModel_current_key;<br>    v9 = *(_QWORD *)(v3 + OBJC_IVAR____TtC4Nine13LockViewModel_current_key);<br>    v2 = OBJC_IVAR____TtC4Nine13LockViewModel_key_all;<br>    v8 = *(<span class="hljs-type">unsigned</span> __int64 **)(v3 + OBJC_IVAR____TtC4Nine13LockViewModel_key_all);<br>    isUniquelyReferenced_nonNull_native = swift_isUniquelyReferenced_nonNull_native(v8);<br>    *(_QWORD *)(v3 + v2) = v8;<br>    <span class="hljs-keyword">if</span> ( (isUniquelyReferenced_nonNull_native &amp; <span class="hljs-number">1</span>) != <span class="hljs-number">0</span> )<br>      <span class="hljs-keyword">goto</span> LABEL_10;<br>  &#125;<br>  v8 = (<span class="hljs-type">unsigned</span> __int64 *)sub_10000852C(<span class="hljs-number">0</span>, v8[<span class="hljs-number">2</span>] + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, v8, &amp;unk_100010E78);<br>  *(_QWORD *)(v3 + v2) = v8;<br>LABEL_10:<br>  v25 = v8[<span class="hljs-number">2</span>];<br>  v24 = v8[<span class="hljs-number">3</span>];<br>  <span class="hljs-keyword">if</span> ( v25 &gt;= v24 &gt;&gt; <span class="hljs-number">1</span> )<br>    v8 = (<span class="hljs-type">unsigned</span> __int64 *)sub_10000852C(v24 &gt; <span class="hljs-number">1</span>, v25 + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, v8, &amp;unk_100010E78);<br>  v8[<span class="hljs-number">2</span>] = v25 + <span class="hljs-number">1</span>;<br>  v8[v25 + <span class="hljs-number">4</span>] = v9;<br>  *(_QWORD *)(v3 + v2) = v8;<br>  v26 = sub_1000050C0(&amp;unk_100010E70);<br>  v27 = swift_allocObject(v26, <span class="hljs-number">64</span>, <span class="hljs-number">7</span>);<br>  *(_OWORD *)(v27 + <span class="hljs-number">16</span>) = xmmword_100009A20;<br>  v9 = OBJC_IVAR____TtC4Nine13LockViewModel_current_idx;<br>  v28 = *(_QWORD *)(v3 + OBJC_IVAR____TtC4Nine13LockViewModel_current_idx);<br>  *(_QWORD *)(v27 + <span class="hljs-number">56</span>) = &amp;type metadata <span class="hljs-keyword">for</span> Int;<br>  *(_QWORD *)(v27 + <span class="hljs-number">32</span>) = v28;<br>  print(_:separator:terminator:)(v27, <span class="hljs-number">32</span>, <span class="hljs-number">0xE100000000000000L</span>L, <span class="hljs-number">10</span>, <span class="hljs-number">0xE100000000000000L</span>L);<br>  swift_bridgeObjectRelease(v27);<br>  v29 = swift_allocObject(v26, <span class="hljs-number">64</span>, <span class="hljs-number">7</span>);<br>  *(_OWORD *)(v29 + <span class="hljs-number">16</span>) = xmmword_100009A20;<br>  v30 = *(<span class="hljs-type">unsigned</span> __int64 *)((<span class="hljs-type">char</span> *)v1 + v3);<br>  *(_QWORD *)(v29 + <span class="hljs-number">56</span>) = &amp;type metadata <span class="hljs-keyword">for</span> UInt64;<br>  *(_QWORD *)(v29 + <span class="hljs-number">32</span>) = v30;<br>  print(_:separator:terminator:)(v29, <span class="hljs-number">32</span>, <span class="hljs-number">0xE100000000000000L</span>L, <span class="hljs-number">10</span>, <span class="hljs-number">0xE100000000000000L</span>L);<br>  swift_bridgeObjectRelease(v29);<br>  v8 = (<span class="hljs-type">unsigned</span> __int64 *)swift_getKeyPath(&amp;unk_100009B30);<br>  v31 = swift_getKeyPath(&amp;unk_100009B58);<br>  v79[<span class="hljs-number">0</span>] = <span class="hljs-number">0x696F47207065654BL</span>L;<br>  v79[<span class="hljs-number">1</span>] = <span class="hljs-number">0xEB0000000021676EL</span>L;<br>  swift_retain(v3);<br>  result = <span class="hljs-type">static</span> Published.subscript.setter(v79, v3, v8, v31);<br>  v33 = *(_QWORD *)(v3 + v9);<br>  v12 = __OFADD__(v33, <span class="hljs-number">1</span>);<br>  v34 = v33 + <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">if</span> ( v12 )<br>  &#123;<br>    __break(<span class="hljs-number">1u</span>);<br>    <span class="hljs-keyword">goto</span> LABEL_66;<br>  &#125;<br>  v73 = v26;<br>  v74 = (<span class="hljs-type">unsigned</span> __int64 *)v9;<br>  v71 = v2;<br>  v72 = (<span class="hljs-type">char</span> *)v1;<br>  *(_QWORD *)(v3 + v9) = v34;<br>  *(<span class="hljs-type">unsigned</span> __int64 *)((<span class="hljs-type">char</span> *)v1 + v3) = <span class="hljs-number">0</span>;<br>  v70 = OBJC_IVAR____TtC4Nine13LockViewModel_weight_idx;<br>  *(_QWORD *)(v3 + OBJC_IVAR____TtC4Nine13LockViewModel_weight_idx) = <span class="hljs-number">0</span>;<br>  v35 = *(_QWORD *)(v3 + OBJC_IVAR____TtC4Nine13LockViewModel_map_list);<br>  v2 = v35 + <span class="hljs-number">64</span>;<br>  v36 = <span class="hljs-number">1LL</span> &lt;&lt; *(_BYTE *)(v35 + <span class="hljs-number">32</span>);<br>  v37 = <span class="hljs-number">-1</span>;<br>  <span class="hljs-keyword">if</span> ( v36 &lt; <span class="hljs-number">64</span> )<br>    v37 = ~(<span class="hljs-number">-1LL</span> &lt;&lt; v36);<br>  v38 = v37 &amp; *(_QWORD *)(v35 + <span class="hljs-number">64</span>);<br>  v75 = v3;<br>  v39 = (<span class="hljs-type">unsigned</span> __int64 *)(v3 + OBJC_IVAR____TtC4Nine13LockViewModel_current_flag);<br>  v3 = (<span class="hljs-type">unsigned</span> __int64)(v36 + <span class="hljs-number">63</span>) &gt;&gt; <span class="hljs-number">6</span>;<br>  swift_bridgeObjectRetain(v35);<br>  v40 = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( v38 )<br>    &#123;<br>      v9 = v40;<br>      <span class="hljs-keyword">goto</span> LABEL_36;<br>    &#125;<br>    v42 = v40 + <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span> ( __OFADD__(v40, <span class="hljs-number">1</span>) )<br>      <span class="hljs-keyword">goto</span> LABEL_60;<br>    <span class="hljs-keyword">if</span> ( v42 &gt;= v3 )<br>      <span class="hljs-keyword">goto</span> LABEL_42;<br>    v38 = *(_QWORD *)(v2 + <span class="hljs-number">8</span> * v42);<br>    v9 = v40 + <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span> ( !v38 )<br>    &#123;<br>      v9 = v40 + <span class="hljs-number">2</span>;<br>      <span class="hljs-keyword">if</span> ( v40 + <span class="hljs-number">2</span> &gt;= v3 )<br>        <span class="hljs-keyword">goto</span> LABEL_42;<br>      v38 = *(_QWORD *)(v2 + <span class="hljs-number">8</span> * v9);<br>      <span class="hljs-keyword">if</span> ( !v38 )<br>      &#123;<br>        v9 = v40 + <span class="hljs-number">3</span>;<br>        <span class="hljs-keyword">if</span> ( v40 + <span class="hljs-number">3</span> &gt;= v3 )<br>          <span class="hljs-keyword">goto</span> LABEL_42;<br>        v38 = *(_QWORD *)(v2 + <span class="hljs-number">8</span> * v9);<br>        <span class="hljs-keyword">if</span> ( !v38 )<br>        &#123;<br>          v9 = v40 + <span class="hljs-number">4</span>;<br>          <span class="hljs-keyword">if</span> ( v40 + <span class="hljs-number">4</span> &gt;= v3 )<br>            <span class="hljs-keyword">goto</span> LABEL_42;<br>          v38 = *(_QWORD *)(v2 + <span class="hljs-number">8</span> * v9);<br>          <span class="hljs-keyword">if</span> ( !v38 )<br>          &#123;<br>            v9 = v40 + <span class="hljs-number">5</span>;<br>            <span class="hljs-keyword">if</span> ( v40 + <span class="hljs-number">5</span> &gt;= v3 )<br>              <span class="hljs-keyword">goto</span> LABEL_42;<br>            v38 = *(_QWORD *)(v2 + <span class="hljs-number">8</span> * v9);<br>            <span class="hljs-keyword">if</span> ( !v38 )<br>            &#123;<br>              v9 = v40 + <span class="hljs-number">6</span>;<br>              <span class="hljs-keyword">if</span> ( v40 + <span class="hljs-number">6</span> &gt;= v3 )<br>                <span class="hljs-keyword">goto</span> LABEL_42;<br>              v38 = *(_QWORD *)(v2 + <span class="hljs-number">8</span> * v9);<br>              <span class="hljs-keyword">if</span> ( !v38 )<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>LABEL_36:<br>    v46 = __clz(__rbit64(v38));<br>    v38 &amp;= v38 - <span class="hljs-number">1</span>;<br>    v47 = (v9 &lt;&lt; <span class="hljs-number">10</span>) | (<span class="hljs-number">16</span> * v46);<br>    v48 = (<span class="hljs-type">unsigned</span> __int64 **)(*(_QWORD *)(v35 + <span class="hljs-number">48</span>) + v47);<br>    v8 = *v48;<br>    v1 = v48[<span class="hljs-number">1</span>];<br>    v49 = (_QWORD *)(*(_QWORD *)(v35 + <span class="hljs-number">56</span>) + v47);<br>    <span class="hljs-keyword">if</span> ( *v49 != v7 || v49[<span class="hljs-number">1</span>] != (_QWORD)v6 )<br>    &#123;<br>      v51 = _stringCompareWithSmolCheck(_:_:expecting:)();<br>      v40 = v9;<br>      <span class="hljs-keyword">if</span> ( (v51 &amp; <span class="hljs-number">1</span>) == <span class="hljs-number">0</span> )<br>        <span class="hljs-keyword">continue</span>;<br>    &#125;<br>    swift_beginAccess(v39, v79, <span class="hljs-number">33</span>, <span class="hljs-number">0</span>);<br>    swift_bridgeObjectRetain(v1);<br>    v41._countAndFlagsBits = (__int64)v8;<br>    v41._object = v1;<br>    v8 = v39;<br>    String.append(_:)(v41);<br>    swift_endAccess(v79);<br>    swift_bridgeObjectRelease(v1);<br>    v40 = v9;<br>  &#125;<br>  v43 = v40 + <span class="hljs-number">7</span>;<br>  v44 = (<span class="hljs-type">unsigned</span> __int64 *)(v35 + <span class="hljs-number">120</span> + <span class="hljs-number">8</span> * v40);<br>  <span class="hljs-keyword">while</span> ( v43 &lt; v3 )<br>  &#123;<br>    v45 = *v44++;<br>    v38 = v45;<br>    ++v43;<br>    <span class="hljs-keyword">if</span> ( v45 )<br>    &#123;<br>      v9 = v43 - <span class="hljs-number">1</span>;<br>      <span class="hljs-keyword">goto</span> LABEL_36;<br>    &#125;<br>  &#125;<br>LABEL_42:<br>  swift_bridgeObjectRelease(v6);<br>  swift_release(v35);<br>  v7 = v73;<br>  v52 = swift_allocObject(v73, <span class="hljs-number">64</span>, <span class="hljs-number">7</span>);<br>  *(_OWORD *)(v52 + <span class="hljs-number">16</span>) = xmmword_100009A20;<br>  swift_beginAccess(v39, v79, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br>  v54 = *v39;<br>  v53 = v39[<span class="hljs-number">1</span>];<br>  v6 = (<span class="hljs-type">char</span> *)&amp;type metadata <span class="hljs-keyword">for</span> String;<br>  *(_QWORD *)(v52 + <span class="hljs-number">56</span>) = &amp;type metadata <span class="hljs-keyword">for</span> String;<br>  *(_QWORD *)(v52 + <span class="hljs-number">32</span>) = v54;<br>  *(_QWORD *)(v52 + <span class="hljs-number">40</span>) = v53;<br>  swift_bridgeObjectRetain(v53);<br>  print(_:separator:terminator:)(v52, <span class="hljs-number">32</span>, <span class="hljs-number">0xE100000000000000L</span>L, <span class="hljs-number">10</span>, <span class="hljs-number">0xE100000000000000L</span>L);<br>  v55 = swift_bridgeObjectRelease(v52);<br>  v1 = v74;<br>  v9 = *(_QWORD *)(v75 + OBJC_IVAR____TtC4Nine13LockViewModel_target_all);<br>  <span class="hljs-keyword">if</span> ( *(<span class="hljs-type">unsigned</span> __int64 *)((<span class="hljs-type">char</span> *)v74 + v75) != *(_QWORD *)(v9 + <span class="hljs-number">16</span>) )<br>    <span class="hljs-keyword">return</span> sub_1000074C4(v55);<br>  v8 = (<span class="hljs-type">unsigned</span> __int64 *)swift_allocObject(v73, <span class="hljs-number">64</span>, <span class="hljs-number">7</span>);<br>  *((_OWORD *)v8 + <span class="hljs-number">1</span>) = xmmword_100009A20;<br>  v8[<span class="hljs-number">7</span>] = (<span class="hljs-type">unsigned</span> __int64)&amp;type metadata <span class="hljs-keyword">for</span> String;<br>  v8[<span class="hljs-number">4</span>] = <span class="hljs-number">0x68635F7472617473L</span>L;<br>  v8[<span class="hljs-number">5</span>] = <span class="hljs-number">0xEB000000006B6365L</span>L;<br>  print(_:separator:terminator:)(v8, <span class="hljs-number">32</span>, <span class="hljs-number">0xE100000000000000L</span>L, <span class="hljs-number">10</span>, <span class="hljs-number">0xE100000000000000L</span>L);<br>  swift_bridgeObjectRelease(v8);<br>  v56 = *(_QWORD *)(v75 + v71);<br>  v57 = *(_QWORD *)(v56 + <span class="hljs-number">16</span>);<br>  <span class="hljs-keyword">if</span> ( v57 )<br>  &#123;<br>    v58 = <span class="hljs-number">0</span>;<br>    v59 = <span class="hljs-number">0</span>;<br>    v60 = v56 + <span class="hljs-number">32</span>;<br>    <span class="hljs-keyword">while</span> ( v59 &lt; v57 )<br>    &#123;<br>      v61 = v59 + <span class="hljs-number">1</span>;<br>      <span class="hljs-keyword">if</span> ( __OFADD__(v59, <span class="hljs-number">1</span>) )<br>        <span class="hljs-keyword">goto</span> LABEL_62;<br>      <span class="hljs-keyword">if</span> ( (<span class="hljs-type">signed</span> __int64)v59 &gt;= *(_QWORD *)(v9 + <span class="hljs-number">16</span>) )<br>        <span class="hljs-keyword">goto</span> LABEL_63;<br>      <span class="hljs-keyword">if</span> ( *(_QWORD *)(v9 + <span class="hljs-number">32</span> + <span class="hljs-number">8</span> * v59) == *(_QWORD *)(v60 + <span class="hljs-number">8</span> * v59) )<br>      &#123;<br>        ++v59;<br>        <span class="hljs-keyword">if</span> ( v61 == v57 )<br>        &#123;<br>          <span class="hljs-keyword">if</span> ( (v58 &amp; <span class="hljs-number">1</span>) == <span class="hljs-number">0</span> )<br>            <span class="hljs-keyword">goto</span> LABEL_55;<br>LABEL_54:<br>          v62 = swift_getKeyPath(&amp;unk_100009B30);<br>          v63 = swift_getKeyPath(&amp;unk_100009B58);<br>          v77 = <span class="hljs-number">0xD000000000000015L</span>L;<br>          v78 = <span class="hljs-number">0x800000010000AB20L</span>L;<br>          <span class="hljs-keyword">goto</span> LABEL_56;<br>        &#125;<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        v58 = <span class="hljs-number">1</span>;<br>        ++v59;<br>        <span class="hljs-keyword">if</span> ( v61 == v57 )<br>          <span class="hljs-keyword">goto</span> LABEL_54;<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">goto</span> LABEL_61;<br>  &#125;<br>LABEL_55:<br>  v64 = *(Swift::String *)v39;<br>  v77 = <span class="hljs-number">0xD000000000000010L</span>L;<br>  v78 = <span class="hljs-number">0x800000010000AB40L</span>L;<br>  String.append(_:)(v64);<br>  v65 = v77;<br>  v66 = v78;<br>  v62 = swift_getKeyPath(&amp;unk_100009B30);<br>  v63 = swift_getKeyPath(&amp;unk_100009B58);<br>  v77 = v65;<br>  v78 = v66;<br>LABEL_56:<br>  swift_retain(v75);<br>  result = <span class="hljs-type">static</span> Published.subscript.setter(&amp;v77, v75, v62, v63);<br>  v67 = *(<span class="hljs-type">unsigned</span> __int64 *)((<span class="hljs-type">char</span> *)v74 + v75);<br>  v12 = __OFADD__(v67, <span class="hljs-number">1</span>);<br>  v68 = v67 + <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">if</span> ( !v12 )<br>  &#123;<br>    *(<span class="hljs-type">unsigned</span> __int64 *)((<span class="hljs-type">char</span> *)v74 + v75) = v68;<br>    *(_QWORD *)&amp;v72[v75] = <span class="hljs-number">0</span>;<br>    *(_QWORD *)(v75 + v70) = <span class="hljs-number">0</span>;<br>    v69 = v39[<span class="hljs-number">1</span>];<br>    *v39 = <span class="hljs-number">0</span>;<br>    v39[<span class="hljs-number">1</span>] = <span class="hljs-number">0xE000000000000000L</span>L;<br>    v55 = swift_bridgeObjectRelease(v69);<br>    <span class="hljs-keyword">return</span> sub_1000074C4(v55);<br>  &#125;<br>LABEL_66:<br>  __break(<span class="hljs-number">1u</span>);<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>是处理输入的主要逻辑</p>
<p>获取用户在九宫格输入数字序列，然后遍历输入的数字，将其转换为字符串并连接起来</p>
<p>其中有一个
<code>map_list</code>,会根据拼接好的字符串去查找对应的映射值，找到后会将结果存储在
<code>current_flag</code> 中，最后和 <code>target_all</code>
进行比较</p>
<h4 id="sub_100006258"><code>sub_100006258</code></h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64 <span class="hljs-title function_">sub_100006258</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-comment">// [COLLAPSED LOCAL DECLARATIONS. PRESS NUMPAD &quot;+&quot; TO EXPAND]</span><br><br>  v1 = sub_1000050C0(&amp;unk_100010EB8);<br>  v39 = *(_QWORD *)(v1 - <span class="hljs-number">8</span>);<br>  v40 = v1;<br>  v38 = (<span class="hljs-type">char</span> *)&amp;v32 - ((*(_QWORD *)(v39 + <span class="hljs-number">64</span>) + <span class="hljs-number">15LL</span>) &amp; <span class="hljs-number">0xFFFFFFFFFFFFFFF0L</span>L);<br>  v2 = sub_1000050C0(&amp;unk_100010EB0);<br>  v36 = *(_QWORD *)(v2 - <span class="hljs-number">8</span>);<br>  v37 = v2;<br>  v35 = (<span class="hljs-type">char</span> *)&amp;v32 - ((*(_QWORD *)(v36 + <span class="hljs-number">64</span>) + <span class="hljs-number">15LL</span>) &amp; <span class="hljs-number">0xFFFFFFFFFFFFFFF0L</span>L);<br>  v3 = sub_1000050C0(&amp;unk_100010EA8);<br>  v33 = *(_QWORD *)(v3 - <span class="hljs-number">8</span>);<br>  v34 = v3;<br>  v4 = (<span class="hljs-type">char</span> *)&amp;v32 - ((*(_QWORD *)(v33 + <span class="hljs-number">64</span>) + <span class="hljs-number">15LL</span>) &amp; <span class="hljs-number">0xFFFFFFFFFFFFFFF0L</span>L);<br>  v5 = sub_1000050C0(&amp;unk_100010EA0);<br>  v6 = *(_QWORD *)(v5 - <span class="hljs-number">8</span>);<br>  v7 = (<span class="hljs-type">char</span> *)&amp;v32 - ((*(_QWORD *)(v6 + <span class="hljs-number">64</span>) + <span class="hljs-number">15LL</span>) &amp; <span class="hljs-number">0xFFFFFFFFFFFFFFF0L</span>L);<br>  v8 = sub_1000050C0(&amp;unk_100010E98);<br>  v9 = *(_QWORD *)(v8 - <span class="hljs-number">8</span>);<br>  v10 = (<span class="hljs-type">char</span> *)&amp;v32 - ((*(_QWORD *)(v9 + <span class="hljs-number">64</span>) + <span class="hljs-number">15LL</span>) &amp; <span class="hljs-number">0xFFFFFFFFFFFFFFF0L</span>L);<br>  v11 = OBJC_IVAR____TtC4Nine13LockViewModel__nodePositions;<br>  v41 = &amp;_swiftEmptyArrayStorage;<br>  v12 = sub_1000050C0(&amp;unk_100010B88);<br>  Published.init(initialValue:)(&amp;v41, v12);<br>  (*(<span class="hljs-type">void</span> (__fastcall **)(__int64, <span class="hljs-type">char</span> *, __int64))(v9 + <span class="hljs-number">32</span>))(v0 + v11, v10, v8);<br>  v13 = OBJC_IVAR____TtC4Nine13LockViewModel__selectedNodes;<br>  v41 = &amp;_swiftEmptyArrayStorage;<br>  v14 = sub_1000050C0(&amp;unk_100010B98);<br>  Published.init(initialValue:)(&amp;v41, v14);<br>  (*(<span class="hljs-type">void</span> (__fastcall **)(__int64, <span class="hljs-type">char</span> *, __int64))(v6 + <span class="hljs-number">32</span>))(v0 + v13, v7, v5);<br>  v15 = OBJC_IVAR____TtC4Nine13LockViewModel__currentPosition;<br>  v41 = <span class="hljs-number">0</span>;<br>  v42 = <span class="hljs-number">0</span>;<br>  v43 = <span class="hljs-number">1</span>;<br>  v16 = sub_1000050C0(&amp;unk_100010BA8);<br>  Published.init(initialValue:)(&amp;v41, v16);<br>  (*(<span class="hljs-type">void</span> (__fastcall **)(__int64, <span class="hljs-type">char</span> *, __int64))(v33 + <span class="hljs-number">32</span>))(v0 + v15, v4, v34);<br>  v17 = OBJC_IVAR____TtC4Nine13LockViewModel__message;<br>  v41 = (<span class="hljs-type">void</span> *)<span class="hljs-number">0xD00000000000001DL</span>L;<br>  v42 = <span class="hljs-number">0x800000010000AB60L</span>L;<br>  v18 = v35;<br>  Published.init(initialValue:)(&amp;v41, &amp;type metadata <span class="hljs-keyword">for</span> String);<br>  (*(<span class="hljs-type">void</span> (__fastcall **)(__int64, <span class="hljs-type">char</span> *, __int64))(v36 + <span class="hljs-number">32</span>))(v0 + v17, v18, v37);<br>  v19 = OBJC_IVAR____TtC4Nine13LockViewModel__isAuthenticated;<br>  LOBYTE(v41) = <span class="hljs-number">0</span>;<br>  v20 = v38;<br>  Published.init(initialValue:)(&amp;v41, &amp;type metadata <span class="hljs-keyword">for</span> Bool);<br>  (*(<span class="hljs-type">void</span> (__fastcall **)(__int64, <span class="hljs-type">char</span> *, __int64))(v39 + <span class="hljs-number">32</span>))(v0 + v19, v20, v40);<br>  *(_QWORD *)(v0 + OBJC_IVAR____TtC4Nine13LockViewModel_current_key) = <span class="hljs-number">0</span>;<br>  *(_QWORD *)(v0 + OBJC_IVAR____TtC4Nine13LockViewModel_current_idx) = <span class="hljs-number">0</span>;<br>  v21 = (_QWORD *)(v0 + OBJC_IVAR____TtC4Nine13LockViewModel_current_flag);<br>  *v21 = <span class="hljs-number">0</span>;<br>  v21[<span class="hljs-number">1</span>] = <span class="hljs-number">0xE000000000000000L</span>L;<br>  *(_QWORD *)(v0 + OBJC_IVAR____TtC4Nine13LockViewModel_weight_idx) = <span class="hljs-number">0</span>;<br>  *(_QWORD *)(v0 + OBJC_IVAR____TtC4Nine13LockViewModel_key_all) = &amp;_swiftEmptyArrayStorage;<br>  v22 = OBJC_IVAR____TtC4Nine13LockViewModel_weight;<br>  v23 = sub_1000050C0(&amp;unk_100010E78);<br>  *(_QWORD *)(v0 + v22) = swift_initStaticObject(v23, &amp;unk_100010320);<br>  v24 = OBJC_IVAR____TtC4Nine13LockViewModel_target_all;<br>  *(_QWORD *)(v0 + v24) = swift_initStaticObject(v23, &amp;unk_100010390);<br>  v25 = OBJC_IVAR____TtC4Nine13LockViewModel_map_list;<br>  v26 = sub_1000050C0(&amp;unk_100010EC0);<br>  inited = swift_initStaticObject(v26, &amp;unk_1000104C0);<br>  v28 = sub_100008678();<br>  v29 = sub_1000050C0(&amp;unk_100010EC8);<br>  v30 = swift_arrayDestroy(inited + <span class="hljs-number">32</span>, <span class="hljs-number">39</span>, v29);<br>  *(_QWORD *)(v0 + v25) = v28;<br>  *(_QWORD *)(v0 + OBJC_IVAR____TtC4Nine13LockViewModel_nodeSize) = <span class="hljs-number">0x404E000000000000L</span>L;<br>  *(_QWORD *)(v0 + OBJC_IVAR____TtC4Nine13LockViewModel_gridSize) = <span class="hljs-number">0x4072C00000000000L</span>L;<br>  sub_100006618(v30);<br>  <span class="hljs-keyword">return</span> v0;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>负责初始化，代码的前半部分通过调用
<code>Published.init(initialValue:)</code> 初始化了几个与 UI
绑定的属性：</p>
<p><code>_nodePositions</code>: 初始化为空数组</p>
<p><code>_swiftEmptyArrayStorage</code>,可能存储九宫格中每个点的位置</p>
<p><code>_selectedNodes</code>: 初始化为空数组,存储用户当前划过的点</p>
<p><code>_currentPosition</code>: 初始化为一个元组或结构体,值为 0, 0,
1，记录当前触摸位置</p>
<p><code>_message</code>: 初始化为字符串 <code>"Keep Going!"</code></p>
<p><code>_isAuthenticated</code>: 初始化为 <code>false</code></p>
<p>之后是核心校验数据初始化</p>
<p><code>current_key / current_idx / weight_idx</code>: 均初始化为 0</p>
<p><code>current_flag</code>: 初始化为空字符串</p>
<p><code>key_all</code>: 初始化为空数组</p>
<p><code>weight</code> : 使用 <code>unk_100010320</code>
处的静态数据初始化</p>
<p><code>target_all</code>:使用 <code>unk_100010390</code>
处的静态数据初始化,这个数组存储了解锁所需的正确手势序列</p>
<p><code>map_list</code>:调用 <code>sub_100008678</code>
构建,将手势字符串（Key）映射为单个字符（Value）,数据来源是
<code>unk_1000104C0</code></p>
<p>九宫格布局</p>
<figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">1 </span> <span class="hljs-number">2</span>  <span class="hljs-number">3</span><br><span class="hljs-symbol">4 </span> <span class="hljs-number">5</span>  <span class="hljs-number">6</span><br><span class="hljs-symbol">7 </span> <span class="hljs-number">8</span>  <span class="hljs-number">9</span><br></code></pre></td></tr></table></figure>
<h4 id="sub_100004d74"><code>sub_100004D74</code></h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64 __fastcall <span class="hljs-title function_">sub_100004D74</span><span class="hljs-params">(__int64 a1, __int64 a2, __int64 a3, <span class="hljs-type">char</span> a4)</span><br>&#123;<br>  __int64 v7; <span class="hljs-comment">// x23</span><br>  __int64 v8; <span class="hljs-comment">// x0</span><br>  __int64 v9; <span class="hljs-comment">// x19</span><br>  <span class="hljs-type">double</span> v10; <span class="hljs-comment">// d0</span><br>  <span class="hljs-type">double</span> v11; <span class="hljs-comment">// d1</span><br><br>  v7 = type metadata accessor <span class="hljs-keyword">for</span> LockViewModel(<span class="hljs-number">0</span>);<br>  v8 = sub_1000051BC(&amp;unk_1000109F8, type metadata accessor <span class="hljs-keyword">for</span> LockViewModel, &amp;unk_100009A68);<br>  v9 = StateObject.wrappedValue.getter(a2, a3, a4 &amp; <span class="hljs-number">1</span>, v7, v8);<br>  v10 = DragGesture.Value.location.getter();<br>  sub_1000069A4(v10, v11);<br>  <span class="hljs-keyword">return</span> swift_release(v9);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>这个函数是 SwiftUI <code>DragGesture</code> 的回调函数：通过
<code>StateObject</code> 获取 <code>LockViewModel</code> 实例</p>
<p>获取坐标：从 <code>DragGesture.Value</code>
中提取当前的触摸点坐标(x,y),将坐标传递给核心处理函数
<code>sub_1000069A4</code></p>
<h4 id="sub_1000069a4"><code>sub_1000069A4</code></h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64 __fastcall <span class="hljs-title function_">sub_1000069A4</span><span class="hljs-params">(<span class="hljs-type">double</span> a1, <span class="hljs-type">double</span> a2)</span><br>&#123;<br>  <span class="hljs-comment">// [COLLAPSED LOCAL DECLARATIONS. PRESS NUMPAD &quot;+&quot; TO EXPAND]</span><br><br>  KeyPath = swift_getKeyPath(&amp;unk_100009AE8);<br>  v9 = swift_getKeyPath(&amp;unk_100009B10);<br>  *(<span class="hljs-type">double</span> *)v33 = a1;<br>  *(<span class="hljs-type">double</span> *)&amp;v33[<span class="hljs-number">1</span>] = a2;<br>  v34 = <span class="hljs-number">0</span>;<br>  swift_retain(v2);<br>  <span class="hljs-type">static</span> Published.subscript.setter(v33, v2, KeyPath, v9);<br>  v10 = swift_getKeyPath(&amp;unk_100009B78);<br>  v11 = swift_getKeyPath(&amp;unk_100009BA0);<br>  <span class="hljs-type">static</span> Published.subscript.getter(v33, v2, v10, v11);<br>  swift_release(v10);<br>  swift_release(v11);<br>  v12 = v33[<span class="hljs-number">0</span>];<br>  v13 = *(_QWORD *)(v33[<span class="hljs-number">0</span>] + <span class="hljs-number">16LL</span>);<br>  <span class="hljs-keyword">if</span> ( !v13 )<br>    <span class="hljs-keyword">return</span> swift_bridgeObjectRelease(v12);<br>  v14 = <span class="hljs-number">0</span>;<br>  v15 = *(<span class="hljs-type">double</span> *)(v2 + OBJC_IVAR____TtC4Nine13LockViewModel_nodeSize);<br>  v16 = &amp;unk_100009AA0;<br>  v17 = &amp;unk_100009AC8;<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( v14 &gt;= *(_QWORD *)(v12 + <span class="hljs-number">16</span>) )<br>      <span class="hljs-keyword">goto</span> LABEL_26;<br>    v5 = v14 + <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span> ( hypot(a1 - *(<span class="hljs-type">double</span> *)(v12 + <span class="hljs-number">32</span> + <span class="hljs-number">16</span> * v14), a2 - *(<span class="hljs-type">double</span> *)(v12 + <span class="hljs-number">32</span> + <span class="hljs-number">16</span> * v14 + <span class="hljs-number">8</span>)) &lt; v15 )<br>      <span class="hljs-keyword">break</span>;<br>LABEL_4:<br>    ++v14;<br>    <span class="hljs-keyword">if</span> ( v5 == v13 )<br>      <span class="hljs-keyword">return</span> swift_bridgeObjectRelease(v12);<br>  &#125;<br>  v3 = (__int64 *)swift_getKeyPath(&amp;unk_100009AA0);<br>  v4 = swift_getKeyPath(&amp;unk_100009AC8);<br>  <span class="hljs-type">static</span> Published.subscript.getter(v33, v2, v3, v4);<br>  swift_release(v3);<br>  swift_release(v4);<br>  v18 = *(_QWORD *)(v33[<span class="hljs-number">0</span>] + <span class="hljs-number">16LL</span>);<br>  <span class="hljs-keyword">if</span> ( !v18 )<br>    <span class="hljs-keyword">goto</span> LABEL_16;<br>  <span class="hljs-keyword">if</span> ( *(_QWORD *)(v33[<span class="hljs-number">0</span>] + <span class="hljs-number">32LL</span>) == v14 )<br>    <span class="hljs-keyword">goto</span> LABEL_3;<br>  <span class="hljs-keyword">if</span> ( v18 == <span class="hljs-number">1</span> )<br>    <span class="hljs-keyword">goto</span> LABEL_16;<br>  <span class="hljs-keyword">if</span> ( *(_QWORD *)(v33[<span class="hljs-number">0</span>] + <span class="hljs-number">40LL</span>) == v14 )<br>  &#123;<br>LABEL_3:<br>    swift_bridgeObjectRelease(v33[<span class="hljs-number">0</span>]);<br>    <span class="hljs-keyword">goto</span> LABEL_4;<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( v18 != <span class="hljs-number">2</span> )<br>  &#123;<br>    v19 = (_QWORD *)(v33[<span class="hljs-number">0</span>] + <span class="hljs-number">48LL</span>);<br>    v20 = <span class="hljs-number">2</span>;<br>    <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>    &#123;<br>      v21 = v20 + <span class="hljs-number">1</span>;<br>      <span class="hljs-keyword">if</span> ( __OFADD__(v20, <span class="hljs-number">1</span>) )<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">if</span> ( *v19 == v14 )<br>        <span class="hljs-keyword">goto</span> LABEL_3;<br>      ++v20;<br>      ++v19;<br>      <span class="hljs-keyword">if</span> ( v21 == v18 )<br>        <span class="hljs-keyword">goto</span> LABEL_16;<br>    &#125;<br>    __break(<span class="hljs-number">1u</span>);<br>LABEL_26:<br>    __break(<span class="hljs-number">1u</span>);<br>    <span class="hljs-keyword">goto</span> LABEL_27;<br>  &#125;<br>LABEL_16:<br>  v22 = v33[<span class="hljs-number">0</span>];<br>  swift_bridgeObjectRelease(v12);<br>  swift_bridgeObjectRelease(v22);<br>  v12 = swift_getKeyPath(&amp;unk_100009AA0);<br>  v16 = (<span class="hljs-type">void</span> *)swift_getKeyPath(&amp;unk_100009AC8);<br>  v17 = (<span class="hljs-type">void</span> *)<span class="hljs-type">static</span> Published.subscript.modify(v33, v2, v12, v16);<br>  v3 = v23;<br>  v4 = *v23;<br>  isUniquelyReferenced_nonNull_native = swift_isUniquelyReferenced_nonNull_native(*v23);<br>  *v3 = v4;<br>  <span class="hljs-keyword">if</span> ( (isUniquelyReferenced_nonNull_native &amp; <span class="hljs-number">1</span>) != <span class="hljs-number">0</span> )<br>    <span class="hljs-keyword">goto</span> LABEL_17;<br>LABEL_27:<br>  v4 = sub_10000852C(<span class="hljs-number">0</span>, *(_QWORD *)(v4 + <span class="hljs-number">16</span>) + <span class="hljs-number">1LL</span>, <span class="hljs-number">1</span>, v4, &amp;unk_100010E88);<br>  *v3 = v4;<br>LABEL_17:<br>  v26 = *(_QWORD *)(v4 + <span class="hljs-number">16</span>);<br>  v25 = *(_QWORD *)(v4 + <span class="hljs-number">24</span>);<br>  <span class="hljs-keyword">if</span> ( v26 &gt;= v25 &gt;&gt; <span class="hljs-number">1</span> )<br>  &#123;<br>    v4 = sub_10000852C(v25 &gt; <span class="hljs-number">1</span>, v26 + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, v4, &amp;unk_100010E88);<br>    *v3 = v4;<br>  &#125;<br>  *(_QWORD *)(v4 + <span class="hljs-number">16</span>) = v26 + <span class="hljs-number">1</span>;<br>  *(_QWORD *)(v4 + <span class="hljs-number">8</span> * v26 + <span class="hljs-number">32</span>) = v14;<br>  ((<span class="hljs-type">void</span> (__fastcall *)(_QWORD *, _QWORD))v17)(v33, <span class="hljs-number">0</span>);<br>  swift_release(v12);<br>  result = swift_release(v16);<br>  v28 = OBJC_IVAR____TtC4Nine13LockViewModel_weight_idx;<br>  v29 = *(_QWORD *)(v2 + OBJC_IVAR____TtC4Nine13LockViewModel_weight_idx);<br>  <span class="hljs-keyword">if</span> ( (v29 &amp; <span class="hljs-number">0x8000000000000000L</span>L) != <span class="hljs-number">0</span> )<br>  &#123;<br>    __break(<span class="hljs-number">1u</span>);<br>    <span class="hljs-keyword">goto</span> LABEL_29;<br>  &#125;<br>  v30 = *(_QWORD *)(v2 + OBJC_IVAR____TtC4Nine13LockViewModel_weight);<br>  <span class="hljs-keyword">if</span> ( v29 &gt;= *(_QWORD *)(v30 + <span class="hljs-number">16</span>) )<br>  &#123;<br>LABEL_29:<br>    __break(<span class="hljs-number">1u</span>);<br>    <span class="hljs-keyword">goto</span> LABEL_30;<br>  &#125;<br>  v31 = *(_QWORD *)(v30 + <span class="hljs-number">8</span> * v29 + <span class="hljs-number">32</span>);<br>  <span class="hljs-keyword">if</span> ( !is_mul_ok(v31, v5) )<br>  &#123;<br>LABEL_30:<br>    __break(<span class="hljs-number">1u</span>);<br>    <span class="hljs-keyword">goto</span> LABEL_31;<br>  &#125;<br>  v32 = *(_QWORD *)(v2 + OBJC_IVAR____TtC4Nine13LockViewModel_current_key);<br>  <span class="hljs-keyword">if</span> ( !__CFADD__(v32, v31 * v5) )<br>  &#123;<br>    *(_QWORD *)(v2 + OBJC_IVAR____TtC4Nine13LockViewModel_current_key) = v32 + v31 * v5;<br>    *(_QWORD *)(v2 + v28) = v29 + <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">return</span> result;<br>  &#125;<br>LABEL_31:<br>  __break(<span class="hljs-number">1u</span>);<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>这个函数负责判断用户的手势划过了哪个圆点，并更新状态,一旦确定划过了一个新圆点，程序会执行以下操作：</p>
<ul>
<li>更新已选列表：将该点索引 <code>v14</code> 加入
<code>_selectedNodes</code> 数组</li>
<li>更新 <code>current_keys</code>： <span class="math display">$$
\text{CurrentKey} = \sum_{i=0}^{n} (\text{Weight}[i] \times
(\text{NodeIndex}_i + 1))
$$</span></li>
</ul>
<h3 id="关键数据">关键数据</h3>
<h4 id="map_list">map_list</h4>
<p><img src="/images/LilacCTF2026/map_list_1.png" srcset="/img/loading.gif" lazyload /></p>
<p><img src="/images/LilacCTF2026/map_list_2.png" srcset="/img/loading.gif" lazyload /></p>
<table>
<thead>
<tr>
<th>路径字符串（九宫格序列）</th>
<th>对应字符</th>
</tr>
</thead>
<tbody>
<tr>
<td>1478</td>
<td>i</td>
</tr>
<tr>
<td>582</td>
<td>l</td>
</tr>
<tr>
<td>147</td>
<td>a</td>
</tr>
<tr>
<td>2147859</td>
<td>c</td>
</tr>
<tr>
<td>6589</td>
<td>{</td>
</tr>
<tr>
<td>248</td>
<td>1</td>
</tr>
<tr>
<td>125879</td>
<td>0</td>
</tr>
<tr>
<td>2587413</td>
<td>S</td>
</tr>
<tr>
<td>321456987</td>
<td>_</td>
</tr>
<tr>
<td>789</td>
<td>/</td>
</tr>
<tr>
<td>27</td>
<td>\</td>
</tr>
<tr>
<td>18</td>
<td>N</td>
</tr>
<tr>
<td>7415963</td>
<td>d</td>
</tr>
<tr>
<td>825479</td>
<td>w</td>
</tr>
<tr>
<td>1475963</td>
<td>n</td>
</tr>
<tr>
<td>4758</td>
<td>3</td>
</tr>
<tr>
<td>23598</td>
<td>f</td>
</tr>
<tr>
<td>21745</td>
<td>r</td>
</tr>
<tr>
<td>475</td>
<td>y</td>
</tr>
<tr>
<td>14257</td>
<td>o</td>
</tr>
<tr>
<td>58746</td>
<td>u</td>
</tr>
<tr>
<td>47869</td>
<td>}</td>
</tr>
<tr>
<td>157</td>
<td>2</td>
</tr>
<tr>
<td>125478</td>
<td>4</td>
</tr>
<tr>
<td>14528</td>
<td>5</td>
</tr>
<tr>
<td>214587</td>
<td>6</td>
</tr>
<tr>
<td>458712</td>
<td>7</td>
</tr>
<tr>
<td>1238</td>
<td>9</td>
</tr>
</tbody>
</table>
<h4 id="target_all">target_all</h4>
<p>对应 33 个 flag 字符的校验值</p>
<p><img src="/images/LilacCTF2026/target_all.png" srcset="/img/loading.gif" lazyload /></p>
<h4 id="weight">weight</h4>
<p><img src="/images/LilacCTF2026/weight.png" srcset="/img/loading.gif" lazyload /></p>
<h3 id="exp-3">Exp</h3>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">def</span> <span class="hljs-title function_">solve</span>():<br>    <span class="hljs-comment"># W0 减去偏移量 163840 (0x28000)</span><br>    weights = [<br>        <span class="hljs-number">10564859903</span>, <span class="hljs-comment"># W0 (0x275B477FF)</span><br>        <span class="hljs-number">880404991</span>,   <span class="hljs-comment"># W1</span><br>        <span class="hljs-number">67723460</span>,    <span class="hljs-comment"># W2</span><br>        <span class="hljs-number">4837390</span>,     <span class="hljs-comment"># W3</span><br>        <span class="hljs-number">322492</span>,      <span class="hljs-comment"># W4</span><br>        <span class="hljs-number">20155</span>,       <span class="hljs-comment"># W5</span><br>        <span class="hljs-number">1185</span>,        <span class="hljs-comment"># W6</span><br>        <span class="hljs-number">65</span>,          <span class="hljs-comment"># W7</span><br>        <span class="hljs-number">3</span>            <span class="hljs-comment"># W8</span><br>    ]<br><br>    targets = [<br>        <span class="hljs-number">14599243207</span>, <span class="hljs-number">60002986363</span>, <span class="hljs-number">14560544087</span>, <span class="hljs-number">22317571743</span>, <span class="hljs-number">68376508563</span>,<br>        <span class="hljs-number">25193127450</span>, <span class="hljs-number">12705425144</span>, <span class="hljs-number">26108707849</span>, <span class="hljs-number">33544207307</span>, <span class="hljs-number">81606770389</span>,<br>        <span class="hljs-number">22317571743</span>, <span class="hljs-number">77570576608</span>, <span class="hljs-number">86640094905</span>, <span class="hljs-number">81606770389</span>, <span class="hljs-number">14560544087</span>,<br>        <span class="hljs-number">12705425144</span>, <span class="hljs-number">14560544087</span>, <span class="hljs-number">22317571743</span>, <span class="hljs-number">68376508563</span>, <span class="hljs-number">81606770389</span>,<br>        <span class="hljs-number">14587757950</span>, <span class="hljs-number">12705425144</span>, <span class="hljs-number">48799590969</span>, <span class="hljs-number">24155668525</span>, <span class="hljs-number">81606770389</span>,<br>        <span class="hljs-number">22505151037</span>, <span class="hljs-number">26108707849</span>, <span class="hljs-number">48760891849</span>, <span class="hljs-number">81606770389</span>, <span class="hljs-number">14248371181</span>,<br>        <span class="hljs-number">60362888175</span>, <span class="hljs-number">48995988997</span>, <span class="hljs-number">15440949078</span><br>    ]<br><br>    mapping = &#123;<br>    <span class="hljs-string">&#x27;1478&#x27;</span>: <span class="hljs-string">&#x27;L&#x27;</span>, <span class="hljs-string">&#x27;582&#x27;</span>: <span class="hljs-string">&#x27;i&#x27;</span>, <span class="hljs-string">&#x27;147&#x27;</span>: <span class="hljs-string">&#x27;l&#x27;</span>, <span class="hljs-string">&#x27;2147859&#x27;</span>: <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;6589&#x27;</span>: <span class="hljs-string">&#x27;c&#x27;</span>,<br>    <span class="hljs-string">&#x27;248&#x27;</span>: <span class="hljs-string">&#x27;&#123;&#x27;</span>, <span class="hljs-string">&#x27;125879&#x27;</span>: <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2587413&#x27;</span>: <span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;321456987&#x27;</span>: <span class="hljs-string">&#x27;S&#x27;</span>, <span class="hljs-string">&#x27;789&#x27;</span>: <span class="hljs-string">&#x27;_&#x27;</span>,<br>    <span class="hljs-string">&#x27;7415963&#x27;</span>: <span class="hljs-string">&#x27;N&#x27;</span>, <span class="hljs-string">&#x27;825479&#x27;</span>: <span class="hljs-string">&#x27;d&#x27;</span>, <span class="hljs-string">&#x27;1475963&#x27;</span>: <span class="hljs-string">&#x27;w&#x27;</span>, <span class="hljs-string">&#x27;4758&#x27;</span>: <span class="hljs-string">&#x27;n&#x27;</span>,<br>    <span class="hljs-string">&#x27;23598&#x27;</span>: <span class="hljs-string">&#x27;3&#x27;</span>, <span class="hljs-string">&#x27;21745&#x27;</span>: <span class="hljs-string">&#x27;f&#x27;</span>, <span class="hljs-string">&#x27;475&#x27;</span>: <span class="hljs-string">&#x27;r&#x27;</span>, <span class="hljs-string">&#x27;14257&#x27;</span>: <span class="hljs-string">&#x27;y&#x27;</span>,<br>    <span class="hljs-string">&#x27;58746&#x27;</span>: <span class="hljs-string">&#x27;o&#x27;</span>, <span class="hljs-string">&#x27;47869&#x27;</span>: <span class="hljs-string">&#x27;u&#x27;</span>, <span class="hljs-string">&#x27;157&#x27;</span>: <span class="hljs-string">&#x27;&#125;&#x27;</span>, <span class="hljs-string">&#x27;125478&#x27;</span>: <span class="hljs-string">&#x27;2&#x27;</span>,<br>    <span class="hljs-string">&#x27;14528&#x27;</span>: <span class="hljs-string">&#x27;4&#x27;</span>, <span class="hljs-string">&#x27;214587&#x27;</span>: <span class="hljs-string">&#x27;5&#x27;</span>, <span class="hljs-string">&#x27;458712&#x27;</span>: <span class="hljs-string">&#x27;6&#x27;</span>, <span class="hljs-string">&#x27;1238&#x27;</span>: <span class="hljs-string">&#x27;7&#x27;</span>,<br>    <span class="hljs-string">&#x27;893256&#x27;</span>: <span class="hljs-string">&#x27;9&#x27;</span>, <span class="hljs-string">&#x27;74269&#x27;</span>: <span class="hljs-string">&#x27;G&#x27;</span>, <span class="hljs-string">&#x27;32478965&#x27;</span>: <span class="hljs-string">&#x27;V&#x27;</span>, <span class="hljs-string">&#x27;183&#x27;</span>: <span class="hljs-string">&#x27;T&#x27;</span>,<br>    <span class="hljs-string">&#x27;13258&#x27;</span>: <span class="hljs-string">&#x27;P&#x27;</span>, <span class="hljs-string">&#x27;45217&#x27;</span>: <span class="hljs-string">&#x27;M&#x27;</span>, <span class="hljs-string">&#x27;7418369&#x27;</span>: <span class="hljs-string">&#x27;W&#x27;</span>, <span class="hljs-string">&#x27;1472963&#x27;</span>: <span class="hljs-string">&#x27;Q&#x27;</span>,<br>    <span class="hljs-string">&#x27;42689&#x27;</span>: <span class="hljs-string">&#x27;H&#x27;</span>, <span class="hljs-string">&#x27;1745639&#x27;</span>: <span class="hljs-string">&#x27;K&#x27;</span>, <span class="hljs-string">&#x27;24718&#x27;</span>: <span class="hljs-string">&#x27;A&#x27;</span><br>    &#125;<br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">find_path</span>(<span class="hljs-params">target, weight_idx</span>):<br>        <span class="hljs-keyword">if</span> target == <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-keyword">if</span> weight_idx &gt;= <span class="hljs-built_in">len</span>(weights):<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br>        <br>        w = weights[weight_idx]<br>        start_digit = <span class="hljs-built_in">min</span>(<span class="hljs-number">9</span>, target // w + <span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(start_digit, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>):<br>            res = find_path(target - d * w, weight_idx + <span class="hljs-number">1</span>)<br>            <span class="hljs-keyword">if</span> res <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-built_in">str</span>(d) + res<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br>    flag = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> i, t <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(targets):<br>        path = find_path(t, <span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">if</span> path:<br>            char = mapping.get(path, <span class="hljs-string">f&quot;[<span class="hljs-subst">&#123;path&#125;</span>]&quot;</span>)<br>            flag += char<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Step <span class="hljs-subst">&#123;i+<span class="hljs-number">1</span>:02d&#125;</span>: Target=<span class="hljs-subst">&#123;t:&lt;<span class="hljs-number">12</span>&#125;</span> -&gt; Path=<span class="hljs-subst">&#123;path:&lt;<span class="hljs-number">10</span>&#125;</span> -&gt; Char=<span class="hljs-subst">&#123;char&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            flag += <span class="hljs-string">&quot;?&quot;</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Step <span class="hljs-subst">&#123;i+<span class="hljs-number">1</span>:02d&#125;</span>: Target=<span class="hljs-subst">&#123;t:&lt;<span class="hljs-number">12</span>&#125;</span> -&gt; 解码失败&quot;</span>)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Flag: <span class="hljs-subst">&#123;flag&#125;</span>&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    solve()<br></code></pre></td></tr></table></figure>
<p>flag 为 <code>Lilac&#123;10S_aNd_l1lac_w1n3_f0r_you&#125;</code></p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/CTF/" class="category-chain-item">CTF</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Reverse/" class="print-no-link">#Reverse</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>LilacCTF2026 逆向 WP + 复现</div>
      <div>http://example.com/2026/01/26/LilacCTF2026/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Eleven</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2026年1月26日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2026/02/02/alictf2026/" title="阿里 CTF 2026 逆向部分 WP">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">阿里 CTF 2026 逆向部分 WP</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2026/01/19/TxGame2024_pre/" title="腾讯游戏安全大赛 2024 安卓初赛题解">
                        <span class="hidden-mobile">腾讯游戏安全大赛 2024 安卓初赛题解</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  









    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }

        Fluid.events.registerRefreshCallback(function() {
          if ('MathJax' in window && MathJax.startup.document && typeof MathJax.startup.document.state === 'function') {
            MathJax.startup.document.state(0);
            MathJax.texReset();
            MathJax.typeset();
            MathJax.typesetPromise();
          }
        });
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
