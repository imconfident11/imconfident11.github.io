

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/avatar.jpg">
  <link rel="icon" href="/img/avatar.jpg">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Eleven">
  <meta name="keywords" content="">
  
    <meta name="description" content="闻香识女人 修花指令 花指令结构1： 1234567891011.text:0000000000002CB9                 push    rbx.text:0000000000002CBA                 xor     rbx, rbx.text:0000000000002CBD                 test    rbx, rbx.text:">
<meta property="og:type" content="article">
<meta property="og:title" content="VCTF Reverse wp + 复现">
<meta property="og:url" content="http://example.com/2025/11/17/VCTF2025/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="闻香识女人 修花指令 花指令结构1： 1234567891011.text:0000000000002CB9                 push    rbx.text:0000000000002CBA                 xor     rbx, rbx.text:0000000000002CBD                 test    rbx, rbx.text:">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2025/11/17/images/VCTF2025/flower3.png">
<meta property="og:image" content="http://example.com/2025/11/17/images/VCTF2025/nop.png">
<meta property="og:image" content="http://example.com/2025/11/17/images/VCTF2025/xor_dec.png">
<meta property="og:image" content="http://example.com/2025/11/17/images/VCTF2025/checkpid0.png">
<meta property="og:image" content="http://example.com/2025/11/17/images/VCTF2025/checkpid1.png">
<meta property="og:image" content="http://example.com/2025/11/17/images/VCTF2025/patch1.png">
<meta property="og:image" content="http://example.com/2025/11/17/images/VCTF2025/patch2.png">
<meta property="og:image" content="http://example.com/2025/11/17/images/VCTF2025/patch3.png">
<meta property="og:image" content="http://example.com/2025/11/17/images/VCTF2025/exit.png">
<meta property="og:image" content="http://example.com/2025/11/17/images/VCTF2025/prctl.png">
<meta property="og:image" content="http://example.com/2025/11/17/images/VCTF2025/attachment1.png">
<meta property="og:image" content="http://example.com/2025/11/17/images/VCTF2025/bcmp.png">
<meta property="og:image" content="http://example.com/2025/11/17/images/VCTF2025/s2.png">
<meta property="article:published_time" content="2025-11-16T16:00:00.000Z">
<meta property="article:modified_time" content="2025-11-18T11:54:36.290Z">
<meta property="article:author" content="Eleven">
<meta property="article:tag" content="Reverse">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/2025/11/17/images/VCTF2025/flower3.png">
  
  
  
  <title>VCTF Reverse wp + 复现 - Hexo</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Eleven&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/wlop2.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="VCTF Reverse wp + 复现"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-11-17 00:00" pubdate>
          2025年11月17日 凌晨
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          5.2k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          44 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">VCTF Reverse wp + 复现</h1>
            
            
              <div class="markdown-body">
                
                <h2 id="闻香识女人">闻香识女人</h2>
<h3 id="修花指令">修花指令</h3>
<p>花指令结构1： <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs asm">.text:0000000000002CB9                 push    rbx<br>.text:0000000000002CBA                 xor     rbx, rbx<br>.text:0000000000002CBD                 test    rbx, rbx<br>.text:0000000000002CC0                 jnz     short near ptr unk_2CC4<br>.text:0000000000002CC2                 jz      short loc_2CC5<br>.text:0000000000002CC2 ; ---------------------------------------------------------------------------<br>.text:0000000000002CC4 unk_2CC4        db 0E9h                 ; CODE XREF: .text:0000000000002CC0↑j<br>.text:0000000000002CC5 ; ---------------------------------------------------------------------------<br>.text:0000000000002CC5<br>.text:0000000000002CC5 loc_2CC5:                               ; CODE XREF: .text:0000000000002CC2↑j<br>.text:0000000000002CC5                 pop     rbx<br></code></pre></td></tr></table></figure> 把从 xor 到 unk_2CC4 的内容给 nop 掉</p>
<p>花指令结构2： <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs asm">.text:0000000000002DC5                 call    loc_2DCB<br>.text:0000000000002DC5 ; ---------------------------------------------------------------------------<br>.text:0000000000002DCA                 db 83h<br>.text:0000000000002DCB ; ---------------------------------------------------------------------------<br>.text:0000000000002DCB<br>.text:0000000000002DCB loc_2DCB:                               ; CODE XREF: .text:0000000000002DC5↑j<br>.text:0000000000002DCB                 add     qword ptr [rsp], 8<br>.text:0000000000002DD0                 retn<br>.text:0000000000002DD1 ; ---------------------------------------------------------------------------<br>.text:0000000000002DD1                 rep cmp dword ptr [rbp-164h], 1<br>.text:0000000000002DD9                 jle     loc_2EDC<br></code></pre></td></tr></table></figure> call 先将下一条指令的地址即
<code>0x2DCA</code> 压栈,然后跳转到 <code>loc_2DCB</code>,
<code>add     qword ptr [rsp], 8</code> 会把栈顶的地址加 8,变成
<code>0x2DD2</code>,然后 <code>retn</code> 会跳转到这个地址。在
<code>text:0000000000002DD1</code> 处 <code>U</code> 后再在
<code>2DD2</code>处 <code>C</code> 将其变成代码，得到： <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs asm">.text:0000000000002DC5                 call    loc_2DCB<br>.text:0000000000002DC5 ; ---------------------------------------------------------------------------<br>.text:0000000000002DCA                 db 83h<br>.text:0000000000002DCB ; ---------------------------------------------------------------------------<br>.text:0000000000002DCB<br>.text:0000000000002DCB loc_2DCB:                               ; CODE XREF: .text:0000000000002DC5↑j<br>.text:0000000000002DCB                 add     qword ptr [rsp], 8<br>.text:0000000000002DD0                 retn<br>.text:0000000000002DD0 ; ---------------------------------------------------------------------------<br>.text:0000000000002DD1                 db 0F3h<br>.text:0000000000002DD2 ; ---------------------------------------------------------------------------<br>.text:0000000000002DD2                 cmp     dword ptr [rbp-164h], 1<br>.text:0000000000002DD9                 jle     loc_2EDC<br></code></pre></td></tr></table></figure> 把
call 到 2DD1 部分的内容 nop 掉</p>
<p>花指令结构3：</p>
<p><img src="/images/VCTF2025/flower3.png" srcset="/img/loading.gif" lazyload /></p>
<p>call 后面的函数点进去是这样的 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> __int64 __fastcall <span class="hljs-title function_">sub_55555555638B</span><span class="hljs-params">(__int64 a1)</span><br>&#123;<br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+1Ch] [rbp-24h]</span><br>  <span class="hljs-type">void</span> *addr; <span class="hljs-comment">// [rsp+20h] [rbp-20h]</span><br>  <span class="hljs-type">size_t</span> len; <span class="hljs-comment">// [rsp+28h] [rbp-18h]</span><br>  <span class="hljs-type">int</span> v5; <span class="hljs-comment">// [rsp+33h] [rbp-Dh]</span><br>  <span class="hljs-type">char</span> v6; <span class="hljs-comment">// [rsp+37h] [rbp-9h]</span><br>  <span class="hljs-type">unsigned</span> __int64 v7; <span class="hljs-comment">// [rsp+38h] [rbp-8h]</span><br><br>  v7 = __readfsqword(<span class="hljs-number">0x28u</span>);<br>  addr = (<span class="hljs-type">void</span> *)sub_555555556361(a1);<br>  len = getpagesize();<br>  <span class="hljs-keyword">if</span> ( mprotect(addr, len, <span class="hljs-number">7</span>) )<br>  &#123;<br>    perror(<span class="hljs-string">&quot;mprotect&quot;</span>);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    v5 = <span class="hljs-number">0x84D58179</span>;<br>    v6 = <span class="hljs-number">0x89</span>;<br>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">4</span>; ++i )<br>      *(_BYTE *)(i + a1) ^= *((_BYTE *)&amp;v5 + i);<br>    mprotect(addr, len, <span class="hljs-number">5</span>);<br>  &#125;<br>  <span class="hljs-keyword">return</span> v7 - __readfsqword(<span class="hljs-number">0x28u</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<code>jmp 0x19144511(rel32)</code> 处的机器码是
<code>E9 11 45 14 19</code>，与<code>79 81 D5 84 89</code> 逐字节做
XOR，得到 <code>90 90 90 90 90</code>，即把 <code>jmp</code>
指令的五个字节全部 nop 掉</p>
<p><img src="/images/VCTF2025/nop.png" srcset="/img/loading.gif" lazyload /></p>
<p>之后在函数头的位置 <code>U</code> <code>P</code>
之后即可成功反编译</p>
<h3 id="分析">分析</h3>
<p>接着打断点动调调试分析每个函数的功能 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64 __fastcall <span class="hljs-title function_">sub_55555555646B</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *input, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *a2)</span><br>&#123;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v3; <span class="hljs-comment">// [rsp+1Ch] [rbp-194h]</span><br>  <span class="hljs-type">size_t</span> i; <span class="hljs-comment">// [rsp+20h] [rbp-190h]</span><br>  <span class="hljs-type">size_t</span> size; <span class="hljs-comment">// [rsp+50h] [rbp-160h]</span><br>  <span class="hljs-type">void</span> *src; <span class="hljs-comment">// [rsp+58h] [rbp-158h]</span><br>  <span class="hljs-type">unsigned</span> __int64 v7; <span class="hljs-comment">// [rsp+60h] [rbp-150h]</span><br>  <span class="hljs-type">void</span> *dest; <span class="hljs-comment">// [rsp+68h] [rbp-148h]</span><br>  <span class="hljs-type">void</span> *ptr; <span class="hljs-comment">// [rsp+70h] [rbp-140h]</span><br>  <span class="hljs-type">unsigned</span> __int64 v10; <span class="hljs-comment">// [rsp+7Fh] [rbp-131h] BYREF</span><br>  _BYTE v11[<span class="hljs-number">9</span>]; <span class="hljs-comment">// [rsp+87h] [rbp-129h] BYREF</span><br>  _BYTE v12[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+90h] [rbp-120h] BYREF</span><br>  _QWORD v13[<span class="hljs-number">8</span>]; <span class="hljs-comment">// [rsp+B0h] [rbp-100h] BYREF</span><br>  <span class="hljs-type">char</span> v14[<span class="hljs-number">80</span>]; <span class="hljs-comment">// [rsp+F0h] [rbp-C0h] BYREF</span><br>  _BYTE v15[<span class="hljs-number">104</span>]; <span class="hljs-comment">// [rsp+140h] [rbp-70h] BYREF</span><br>  <span class="hljs-type">unsigned</span> __int64 v16; <span class="hljs-comment">// [rsp+1A8h] [rbp-8h]</span><br><br>  v16 = __readfsqword(<span class="hljs-number">0x28u</span>);<br>  sub_55555555638B((__int64)&amp;loc_5555555564B4);<br>  v10 = <span class="hljs-number">0xD9CBC6D9CBF5C3DCL</span>L;<br>  v13[<span class="hljs-number">0</span>] = <span class="hljs-number">0x999D939CCF9F9B9FL</span>L;<br>  v13[<span class="hljs-number">1</span>] = <span class="hljs-number">0x9A93C89CC898CF93L</span>L;<br>  v13[<span class="hljs-number">2</span>] = <span class="hljs-number">0x93CB9FCE9998989DL</span>L;<br>  v13[<span class="hljs-number">3</span>] = <span class="hljs-number">0x9ACCCC9D9BCFC999L</span>L;<br>  v13[<span class="hljs-number">4</span>] = <span class="hljs-number">0x999D939CCF9F9B9FL</span>L;<br>  v13[<span class="hljs-number">5</span>] = <span class="hljs-number">0x9A93C89CC898CF93L</span>L;<br>  v13[<span class="hljs-number">6</span>] = <span class="hljs-number">0x93CB9FCE9998989DL</span>L;<br>  v13[<span class="hljs-number">7</span>] = <span class="hljs-number">0x9ACCCC9D9BCFC999L</span>L;<br>  func1((__int64)v13, <span class="hljs-number">0x40u</span>LL, (__int64)v14);<br>  func1((__int64)&amp;v10, <span class="hljs-number">8uLL</span>, (__int64)v11);<br>  hex2byte(v14, (__int64)v12, <span class="hljs-number">0x20u</span>LL);<br>  hex2byte(a2, (__int64)v15, <span class="hljs-number">0x64u</span>LL);<br>  size = <span class="hljs-built_in">strlen</span>(input);<br>  src = <span class="hljs-built_in">malloc</span>(size);<br>  enc1((__int64)input, size, (__int64)v12, (__int64)v11, <span class="hljs-number">0LL</span>, (__int64)src);<br>  v7 = (size + <span class="hljs-number">15</span>) &amp; <span class="hljs-number">0xFFFFFFFFFFFFFFF0L</span>L;<br>  dest = <span class="hljs-built_in">malloc</span>(v7);<br>  <span class="hljs-built_in">memcpy</span>(dest, src, size);<br>  <span class="hljs-keyword">for</span> ( i = size; i &lt; v7; ++i )<br>    *((_BYTE *)dest + i) = v7 - size;<br>  ptr = <span class="hljs-built_in">malloc</span>(v7);<br>  aes((__int64)dest, v7, (__int64)<span class="hljs-string">&quot;venom2025venom25&quot;</span>, (__int64)ptr);<br>  v3 = compare((__int64)ptr, (__int64)v15, v7);<br>  <span class="hljs-built_in">free</span>(src);<br>  <span class="hljs-built_in">free</span>(dest);<br>  <span class="hljs-built_in">free</span>(ptr);<br>  <span class="hljs-keyword">return</span> v3;<br>&#125;<br></code></pre></td></tr></table></figure> ### exp
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><br><span class="hljs-comment"># 还原 v12（Salsa20 的 key</span><br><br>v13_qwords = [<br>    <span class="hljs-number">0x999D939CCF9F9B9F</span>,<br>    <span class="hljs-number">0x9A93C89CC898CF93</span>,<br>    <span class="hljs-number">0x93CB9FCE9998989D</span>,<br>    <span class="hljs-number">0x9ACCCC9D9BCFC999</span>,<br>    <span class="hljs-number">0x999D939CCF9F9B9F</span>,<br>    <span class="hljs-number">0x9A93C89CC898CF93</span>,<br>    <span class="hljs-number">0x93CB9FCE9998989D</span>,<br>    <span class="hljs-number">0x9ACCCC9D9BCFC999</span>,<br>]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">func1</span>(<span class="hljs-params">a1_bytes: <span class="hljs-built_in">bytes</span></span>) -&gt; <span class="hljs-built_in">bytes</span>:<br>    a2 = <span class="hljs-built_in">len</span>(a1_bytes)<br>    out = <span class="hljs-built_in">bytearray</span>(a2)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(a2):<br>        out[i] = a1_bytes[a2 - <span class="hljs-number">1</span> - i] ^ <span class="hljs-number">0xAA</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(out)  <br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hex2byte</span>(<span class="hljs-params">hex_bytes: <span class="hljs-built_in">bytes</span></span>) -&gt; <span class="hljs-built_in">bytes</span>:<br>    s = hex_bytes.decode()<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(s) % <span class="hljs-number">2</span> != <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;hex length must be even&quot;</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(<span class="hljs-built_in">int</span>(s[i:i+<span class="hljs-number">2</span>], <span class="hljs-number">16</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(s), <span class="hljs-number">2</span>))<br><br><span class="hljs-comment"># v13 在内存中是 8 个 64-bit，小端拼成 64 字节</span><br>v13_bytes = <span class="hljs-string">b&quot;&quot;</span>.join(q.to_bytes(<span class="hljs-number">8</span>, <span class="hljs-string">&quot;little&quot;</span>) <span class="hljs-keyword">for</span> q <span class="hljs-keyword">in</span> v13_qwords)<br>hex_str  = func1(v13_bytes)<br>v12      = hex2byte(hex_str)  <span class="hljs-comment"># 32-byte Salsa20 key</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] Salsa20 key (v12) =&quot;</span>, v12.<span class="hljs-built_in">hex</span>())<br><br><br><span class="hljs-comment"># AES-128-ECB 解密 </span><br>AES_KEY = <span class="hljs-string">b&quot;venom2025venom25&quot;</span><br><br>ciphertext_hex = (<br>    <span class="hljs-string">&quot;59cc9e17b97199cad788f5f9d919531e&quot;</span><br>    <span class="hljs-string">&quot;e9f09bb233b5565233aef1de39a1d663&quot;</span><br>    <span class="hljs-string">&quot;5237703c819d47cf9ca5c53ca8adcdec&quot;</span><br>)<br>ciphertext = <span class="hljs-built_in">bytes</span>.fromhex(ciphertext_hex)<br><br>aes = AES.new(AES_KEY, AES.MODE_ECB)<br>dest = aes.decrypt(ciphertext)  <span class="hljs-comment"># 对应 C 中的 dest（填充后）</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] dest len =&quot;</span>, <span class="hljs-built_in">len</span>(dest), <span class="hljs-string">&quot;dest =&quot;</span>, dest.<span class="hljs-built_in">hex</span>())<br><br><br><span class="hljs-comment">#去掉 PKCS#7 填充得到 src </span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">pkcs7_unpad</span>(<span class="hljs-params">data: <span class="hljs-built_in">bytes</span>, block_size: <span class="hljs-built_in">int</span> = <span class="hljs-number">16</span></span>) -&gt; <span class="hljs-built_in">bytes</span>:<br>    pad_len = data[-<span class="hljs-number">1</span>]<br>    <span class="hljs-keyword">if</span> pad_len &lt; <span class="hljs-number">1</span> <span class="hljs-keyword">or</span> pad_len &gt; block_size:<br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">f&quot;Invalid padding length: <span class="hljs-subst">&#123;pad_len&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">if</span> data[-pad_len:] != <span class="hljs-built_in">bytes</span>([pad_len]) * pad_len:<br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;Invalid padding content&quot;</span>)<br>    <span class="hljs-keyword">return</span> data[:-pad_len]<br><br>src = pkcs7_unpad(dest) <br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] src len =&quot;</span>, <span class="hljs-built_in">len</span>(src), <span class="hljs-string">&quot;src =&quot;</span>, src.<span class="hljs-built_in">hex</span>())<br><br><br><span class="hljs-comment">#Salsa2</span><br>SALSA_IV_HEX = <span class="hljs-string">&quot;73616c73615f6976&quot;</span>   <br>nonce = <span class="hljs-built_in">bytes</span>.fromhex(SALSA_IV_HEX)  <br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rotl32</span>(<span class="hljs-params">x, n</span>):<br>    <span class="hljs-keyword">return</span> ((x &lt;&lt; n) &amp; <span class="hljs-number">0xffffffff</span>) | (x &gt;&gt; (<span class="hljs-number">32</span> - n))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">salsa20_quarterround</span>(<span class="hljs-params">y0, y1, y2, y3</span>):<br>    y1 ^= rotl32((y0 + y3) &amp; <span class="hljs-number">0xffffffff</span>, <span class="hljs-number">7</span>)<br>    y2 ^= rotl32((y1 + y0) &amp; <span class="hljs-number">0xffffffff</span>, <span class="hljs-number">9</span>)<br>    y3 ^= rotl32((y2 + y1) &amp; <span class="hljs-number">0xffffffff</span>, <span class="hljs-number">13</span>)<br>    y0 ^= rotl32((y3 + y2) &amp; <span class="hljs-number">0xffffffff</span>, <span class="hljs-number">18</span>)<br>    <span class="hljs-keyword">return</span> y0 &amp; <span class="hljs-number">0xffffffff</span>, y1 &amp; <span class="hljs-number">0xffffffff</span>, y2 &amp; <span class="hljs-number">0xffffffff</span>, y3 &amp; <span class="hljs-number">0xffffffff</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">salsa20_block</span>(<span class="hljs-params">key: <span class="hljs-built_in">bytes</span>, nonce: <span class="hljs-built_in">bytes</span>, counter: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">bytes</span>:<br><br>    <span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(key) == <span class="hljs-number">32</span><br>    <span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(nonce) == <span class="hljs-number">8</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">u32</span>(<span class="hljs-params">b</span>): <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>.from_bytes(b, <span class="hljs-string">&quot;little&quot;</span>)<br><br>    k = [u32(key[i:i+<span class="hljs-number">4</span>]) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">32</span>, <span class="hljs-number">4</span>)]<br>    n = [u32(nonce[<span class="hljs-number">0</span>:<span class="hljs-number">4</span>]), u32(nonce[<span class="hljs-number">4</span>:<span class="hljs-number">8</span>])]<br>    c0 = <span class="hljs-number">0x61707865</span><br>    c1 = <span class="hljs-number">0x3320646e</span><br>    c2 = <span class="hljs-number">0x79622d32</span><br>    c3 = <span class="hljs-number">0x6b206574</span><br>    ctr0 = counter &amp; <span class="hljs-number">0xffffffff</span><br>    ctr1 = (counter &gt;&gt; <span class="hljs-number">32</span>) &amp; <span class="hljs-number">0xffffffff</span><br><br>    x = [<br>        c0,      k[<span class="hljs-number">0</span>],    k[<span class="hljs-number">1</span>],    k[<span class="hljs-number">2</span>],<br>        k[<span class="hljs-number">3</span>],    c1,      n[<span class="hljs-number">0</span>],    n[<span class="hljs-number">1</span>],<br>        ctr0,    ctr1,    c2,      k[<span class="hljs-number">4</span>],<br>        k[<span class="hljs-number">5</span>],    k[<span class="hljs-number">6</span>],    k[<span class="hljs-number">7</span>],    c3,<br>    ]<br><br>    <span class="hljs-comment"># 保存原始 state</span><br>    orig = x[:]<br><br>    <span class="hljs-comment"># 10 次 double-round = 20 轮</span><br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>        <span class="hljs-comment"># column rounds:</span><br>        <span class="hljs-comment"># (0,4,8,12), (5,9,13,1), (10,14,2,6), (15,3,7,11)</span><br>        x[<span class="hljs-number">0</span>], x[<span class="hljs-number">4</span>], x[<span class="hljs-number">8</span>],  x[<span class="hljs-number">12</span>] = salsa20_quarterround(x[<span class="hljs-number">0</span>], x[<span class="hljs-number">4</span>], x[<span class="hljs-number">8</span>],  x[<span class="hljs-number">12</span>])<br>        x[<span class="hljs-number">5</span>], x[<span class="hljs-number">9</span>], x[<span class="hljs-number">13</span>], x[<span class="hljs-number">1</span>]  = salsa20_quarterround(x[<span class="hljs-number">5</span>], x[<span class="hljs-number">9</span>], x[<span class="hljs-number">13</span>], x[<span class="hljs-number">1</span>])<br>        x[<span class="hljs-number">10</span>],x[<span class="hljs-number">14</span>],x[<span class="hljs-number">2</span>],  x[<span class="hljs-number">6</span>]  = salsa20_quarterround(x[<span class="hljs-number">10</span>],x[<span class="hljs-number">14</span>],x[<span class="hljs-number">2</span>],  x[<span class="hljs-number">6</span>])<br>        x[<span class="hljs-number">15</span>],x[<span class="hljs-number">3</span>], x[<span class="hljs-number">7</span>],  x[<span class="hljs-number">11</span>] = salsa20_quarterround(x[<span class="hljs-number">15</span>],x[<span class="hljs-number">3</span>], x[<span class="hljs-number">7</span>],  x[<span class="hljs-number">11</span>])<br>        <span class="hljs-comment"># row rounds:</span><br>        <span class="hljs-comment"># (0,1,2,3), (5,6,7,4), (10,11,8,9), (15,12,13,14)</span><br>        x[<span class="hljs-number">0</span>], x[<span class="hljs-number">1</span>], x[<span class="hljs-number">2</span>],  x[<span class="hljs-number">3</span>]  = salsa20_quarterround(x[<span class="hljs-number">0</span>], x[<span class="hljs-number">1</span>], x[<span class="hljs-number">2</span>],  x[<span class="hljs-number">3</span>])<br>        x[<span class="hljs-number">5</span>], x[<span class="hljs-number">6</span>], x[<span class="hljs-number">7</span>],  x[<span class="hljs-number">4</span>]  = salsa20_quarterround(x[<span class="hljs-number">5</span>], x[<span class="hljs-number">6</span>], x[<span class="hljs-number">7</span>],  x[<span class="hljs-number">4</span>])<br>        x[<span class="hljs-number">10</span>],x[<span class="hljs-number">11</span>],x[<span class="hljs-number">8</span>],  x[<span class="hljs-number">9</span>]  = salsa20_quarterround(x[<span class="hljs-number">10</span>],x[<span class="hljs-number">11</span>],x[<span class="hljs-number">8</span>],  x[<span class="hljs-number">9</span>])<br>        x[<span class="hljs-number">15</span>],x[<span class="hljs-number">12</span>],x[<span class="hljs-number">13</span>], x[<span class="hljs-number">14</span>] = salsa20_quarterround(x[<span class="hljs-number">15</span>],x[<span class="hljs-number">12</span>],x[<span class="hljs-number">13</span>], x[<span class="hljs-number">14</span>])<br><br>    <span class="hljs-comment"># 加回原 state</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">16</span>):<br>        x[i] = (x[i] + orig[i]) &amp; <span class="hljs-number">0xffffffff</span><br><br>    <span class="hljs-comment"># 16 * 4 = 64 字节 keystream</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">b&quot;&quot;</span>.join(w.to_bytes(<span class="hljs-number">4</span>, <span class="hljs-string">&quot;little&quot;</span>) <span class="hljs-keyword">for</span> w <span class="hljs-keyword">in</span> x)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">salsa20_stream_xor</span>(<span class="hljs-params">data: <span class="hljs-built_in">bytes</span>, key: <span class="hljs-built_in">bytes</span>, nonce: <span class="hljs-built_in">bytes</span>, counter0: <span class="hljs-built_in">int</span> = <span class="hljs-number">0</span></span>) -&gt; <span class="hljs-built_in">bytes</span>:<br><br>    out = <span class="hljs-built_in">bytearray</span>(<span class="hljs-built_in">len</span>(data))<br>    offset = <span class="hljs-number">0</span><br>    block_index = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> offset &lt; <span class="hljs-built_in">len</span>(data):<br>        ks = salsa20_block(key, nonce, counter0 + block_index)<br>        block_len = <span class="hljs-built_in">min</span>(<span class="hljs-number">64</span>, <span class="hljs-built_in">len</span>(data) - offset)<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(block_len):<br>            out[offset + i] = data[offset + i] ^ ks[i]<br>        offset += block_len<br>        block_index += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(out)<br><br><br><span class="hljs-comment"># 逆 Salsa20 层，得到原始输入 </span><br>a1 = salsa20_stream_xor(src, v12, nonce, counter0=<span class="hljs-number">0</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] Recovered input (hex)  =&quot;</span>, a1.<span class="hljs-built_in">hex</span>())<br><span class="hljs-keyword">try</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] Recovered input (ascii)=&quot;</span>, a1.decode())<br><span class="hljs-keyword">except</span> UnicodeDecodeError:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] Recovered input not all ascii&quot;</span>)<br></code></pre></td></tr></table></figure></p>
<p>输出 <figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-attr">[+]</span> Salsa20 key (v12) = <span class="hljs-number">0</span>ff71ec39a5d322709b6b2e93796e5150ff71ec39a5d322709b6b2e93796e515<br><span class="hljs-selector-attr">[+]</span> dest len = <span class="hljs-number">48</span> dest = <span class="hljs-number">5</span>b397a7aa04ecbc2d800d1d1dbf748df96bc36ead33e1aada6b74f946191089bc6e9cbc2c1425448f569060606060606<br><span class="hljs-selector-attr">[+]</span> <span class="hljs-attribute">src</span> len = <span class="hljs-number">42</span> src = <span class="hljs-number">5</span>b397a7aa04ecbc2d800d1d1dbf748df96bc36ead33e1aada6b74f946191089bc6e9cbc2c1425448f569<br><span class="hljs-selector-attr">[+]</span> Recovered <span class="hljs-selector-tag">input</span> (hex)  = <span class="hljs-number">766374667</span>b61623932313035625f303437655f616133385f306232355f6136393839623865356564357d<br><span class="hljs-selector-attr">[+]</span> Recovered <span class="hljs-selector-tag">input</span> (ascii)= vctf&#123;ab92105b_047e_aa38_0b25_a6989b8e5ed5&#125;<br></code></pre></td></tr></table></figure> flag
为<code>vctf&#123;ab92105b_047e_aa38_0b25_a6989b8e5ed5&#125;</code></p>
<h2 id="ezapp">ezapp</h2>
<p>太好了，是安卓题 ### 分析 jadx 打开 <code>MainActivity</code>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"> <span class="hljs-keyword">if</span> (obj.length() == <span class="hljs-number">0</span>) &#123;<br>        mainActivity.showMessage(<span class="hljs-string">&quot;请输入flag&quot;</span>, <span class="hljs-literal">false</span>);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (mainActivity.checkFlag(obj)) &#123;<br>        mainActivity.showMessage(<span class="hljs-string">&quot;ok&quot;</span>, <span class="hljs-literal">true</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        mainActivity.showMessage(<span class="hljs-string">&quot;no&quot;</span>, <span class="hljs-literal">false</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure> 输入 flag 后调用了一个 Native 方法
<code>checkFlag</code>，打开 <code>libmyapplication.so</code>，直接找
<code>checkFlag</code> 函数没找到，但是发现了另外一个关键函数
<code>sub_18BC</code> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64 __fastcall <span class="hljs-title function_">sub_18BC</span><span class="hljs-params">(JNIEnv *a1, <span class="hljs-type">void</span> *a2)</span><br>&#123;<br>  <span class="hljs-comment">// [COLLAPSED LOCAL DECLARATIONS. PRESS NUMPAD &quot;+&quot; TO EXPAND]</span><br><br>  v21 = *(_QWORD *)(_ReadStatusReg(ARM64_SYSREG(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">13</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>)) + <span class="hljs-number">40</span>);<br>  v2 = AAssetManager_fromJava(a1, a2);<br>  v3 = AAssetManager_open(v2, <span class="hljs-string">&quot;qwqer1&quot;</span>, <span class="hljs-number">3</span>);<br>  Length = AAsset_getLength(v3);<br>  <span class="hljs-keyword">if</span> ( Length &gt;= <span class="hljs-number">1</span><br>    &amp;&amp; (v5 = Length, (Length &amp; <span class="hljs-number">0xF</span>) == <span class="hljs-number">0</span>)<br>    &amp;&amp; (Buffer = AAsset_getBuffer(v3)) != <span class="hljs-number">0LL</span><br>    &amp;&amp; (v7 = Buffer, (v8 = (<span class="hljs-type">char</span> *)<span class="hljs-built_in">malloc</span>(v5)) != <span class="hljs-number">0LL</span>) )<br>  &#123;<br>    v9 = v8;<br>    v20 = *(_OWORD *)<span class="hljs-string">&quot;p0l1st&quot;</span>;<br>    v10 = sub_14DC(&amp;v20, <span class="hljs-number">16LL</span>, v7, v8, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v5);<br>    AAsset_close(v3);<br>    <span class="hljs-keyword">if</span> ( v10 )<br>      <span class="hljs-keyword">goto</span> LABEL_6;<br>    v12 = (<span class="hljs-type">unsigned</span> __int8)v9[v5 - <span class="hljs-number">1</span>];<br>    <span class="hljs-keyword">if</span> ( (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)(v12 - <span class="hljs-number">1</span>) &lt;= <span class="hljs-number">0xF</span> )<br>    &#123;<br>      <span class="hljs-keyword">if</span> ( v5 &lt; v12 )<br>      &#123;<br>LABEL_16:<br>        v5 -= v12;<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        v13 = -(__int64)v12;<br>        <span class="hljs-keyword">while</span> ( (<span class="hljs-type">unsigned</span> __int8)v9[v5 + v13] == (_DWORD)v12 )<br>        &#123;<br>          <span class="hljs-keyword">if</span> ( __CFADD__(v13++, <span class="hljs-number">1LL</span>) )<br>            <span class="hljs-keyword">goto</span> LABEL_16;<br>        &#125;<br>      &#125;<br>    &#125;<br>    getpid();<br>    sub_1AAC(v19);<br>    v15 = fopen(v19, <span class="hljs-string">&quot;wb&quot;</span>);<br>    <span class="hljs-keyword">if</span> ( !v15 )<br>    &#123;<br>LABEL_6:<br>      <span class="hljs-built_in">free</span>(v9);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      v16 = v15;<br>      v17 = fwrite(v9, <span class="hljs-number">1uLL</span>, v5, v15);<br>      <span class="hljs-built_in">free</span>(v9);<br>      fclose(v16);<br>      <span class="hljs-keyword">if</span> ( v17 == v5 )<br>      &#123;<br>        chmod(v19, <span class="hljs-number">0x1EDu</span>);<br>        v18 = dlopen(v19, <span class="hljs-number">1</span>);<br>        qword_40A0 = (__int64)v18;<br>        <span class="hljs-keyword">if</span> ( v18 )<br>        &#123;<br>          off_40A8 = (__int64 (*)(<span class="hljs-type">void</span>))dlsym(v18, <span class="hljs-string">&quot;Java_com_qwq_myapplication_MainActivity_checkFlag&quot;</span>);<br>          <span class="hljs-keyword">if</span> ( off_40A8 )<br>          &#123;<br>            unlink(v19);<br>            result = <span class="hljs-number">1LL</span>;<br>            byte_40B0 = <span class="hljs-number">1</span>;<br>            <span class="hljs-keyword">return</span> result;<br>          &#125;<br>          dlclose((<span class="hljs-type">void</span> *)qword_40A0);<br>          qword_40A0 = <span class="hljs-number">0LL</span>;<br>        &#125;<br>      &#125;<br>      unlink(v19);<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    AAsset_close(v3);<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>&#125;<br></code></pre></td></tr></table></figure></p>
<p>从 asset 里面读取一个加密文件 <code>qwqer1</code>,并使用密钥
<code>p0l1st</code> 对其进行解密，写入临时路径，<code>dlopen</code>
加载它，然后在其中找到真正的
<code>Java_com_qwq_myapplication_MainActivity_checkFlag</code>
函数，推测这个解密之后的文件应该就是真正要找的 so 文件 ### dump so 文件
用 frida dump 出解密后的 so <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-keyword">let</span> dumped = <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">let</span> fwritePtr = <span class="hljs-title class_">Module</span>.<span class="hljs-title function_">findExportByName</span>(<span class="hljs-literal">null</span>,<span class="hljs-string">&quot;fwrite&quot;</span>);<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[+] fwrite @ &quot;</span> + fwritePtr);<br><br>    <span class="hljs-title class_">Interceptor</span>.<span class="hljs-title function_">attach</span>(fwritePtr,&#123;<br>        <span class="hljs-attr">onEnter</span>:<span class="hljs-keyword">function</span>(<span class="hljs-params">args</span>)&#123;<br>            <span class="hljs-keyword">if</span>(dumped) <span class="hljs-keyword">return</span>;<br>            <span class="hljs-keyword">let</span> buf = args[<span class="hljs-number">0</span>];<br>            <span class="hljs-keyword">let</span> size = args[<span class="hljs-number">1</span>].<span class="hljs-title function_">toInt32</span>();<br>            <span class="hljs-keyword">let</span> nmemb = args[<span class="hljs-number">2</span>].<span class="hljs-title function_">toInt32</span>();<br>            <span class="hljs-keyword">let</span> total = size * nmemb;<br>            <span class="hljs-keyword">if</span>(total &lt; <span class="hljs-number">0x1000</span>) <span class="hljs-keyword">return</span>;<br>            <span class="hljs-keyword">try</span>&#123;<br>                <span class="hljs-keyword">let</span> magic = <span class="hljs-title class_">Memory</span>.<span class="hljs-title function_">readU32</span>(buf);<br>                <span class="hljs-keyword">if</span>(magic !== <span class="hljs-number">0x464c457f</span>) <span class="hljs-keyword">return</span>; <span class="hljs-comment">//0x7F &#x27;E&#x27; &#x27;L&#x27; &#x27;F&#x27;</span><br>            &#125;<span class="hljs-keyword">catch</span>(e)&#123;<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[+] Detected ELF in fwrite, size = &quot;</span> + total);<br>            <span class="hljs-keyword">try</span>&#123;<br>                <span class="hljs-keyword">let</span> soData = <span class="hljs-title class_">Memory</span>.<span class="hljs-title function_">readByteArray</span>(buf, total);<br>                <span class="hljs-keyword">let</span> path = <span class="hljs-string">&quot;/data/data/com.qwq.myapplication/files/dump_from_fwrite.so&quot;</span>;<br>                <span class="hljs-keyword">let</span> f = <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(path,<span class="hljs-string">&quot;wb&quot;</span>);<br>                f.<span class="hljs-title function_">write</span>(soData);<br>                f.<span class="hljs-title function_">close</span>();<br>                dumped = <span class="hljs-literal">true</span>;<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[+] dump ok: &quot;</span> + path);<br>            &#125;<span class="hljs-keyword">catch</span>(e)&#123;<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[-] dump failed: &quot;</span> + e);<br>            &#125;<br>        &#125;<br>    &#125;)<br>&#125;)<br></code></pre></td></tr></table></figure>
执行命令之后成功得到解密后的文件 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">frida -U -f com.qwq.myapplication -l dump_fwrite.js<br></code></pre></td></tr></table></figure></p>
<p>在 dump_from_fwrite.so 里面找到了
<code>Java_com_qwq_myapplication_MainActivity_checkFlag</code> 函数
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">bool</span> __fastcall <span class="hljs-title function_">Java_com_qwq_myapplication_MainActivity_checkFlag</span><span class="hljs-params">(__int64 a1, __int64 a2, __int64 a3)</span><br>&#123;<br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *v5; <span class="hljs-comment">// x0</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *v6; <span class="hljs-comment">// x21</span><br>  __int64 v7; <span class="hljs-comment">// x2</span><br>  _OWORD *v8; <span class="hljs-comment">// x22</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *v9; <span class="hljs-comment">// x25</span><br>  __int64 v10; <span class="hljs-comment">// x24</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v11; <span class="hljs-comment">// t1</span><br>  _BOOL4 v12; <span class="hljs-comment">// w22</span><br>  <span class="hljs-type">int</span> v14; <span class="hljs-comment">// [xsp+Ch] [xbp-154h] BYREF</span><br>  _OWORD s1[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [xsp+10h] [xbp-150h] BYREF</span><br>  _BYTE v16[<span class="hljs-number">64</span>]; <span class="hljs-comment">// [xsp+118h] [xbp-48h] BYREF</span><br>  __int64 v17; <span class="hljs-comment">// [xsp+158h] [xbp-8h]</span><br><br>  v17 = *(_QWORD *)(_ReadStatusReg(ARM64_SYSREG(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">13</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>)) + <span class="hljs-number">40</span>);<br>  v5 = (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)(*(__int64 (__fastcall **)(__int64, __int64, _QWORD))(*(_QWORD *)a1 + <span class="hljs-number">1352LL</span>))(a1, a3, <span class="hljs-number">0LL</span>);<br>  v6 = v5;<br>  <span class="hljs-keyword">if</span> ( *v5 )<br>  &#123;<br>    sub_92C(v5, dword_670, (__int64)v16, &amp;v14);<br>    <span class="hljs-built_in">memset</span>(s1, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(s1));<br>    <span class="hljs-keyword">if</span> ( v14 &gt;= <span class="hljs-number">1</span> )<br>    &#123;<br>      v8 = s1;<br>      v9 = (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *)v16;<br>      <span class="hljs-keyword">if</span> ( <span class="hljs-number">2</span> * v14 &lt;= <span class="hljs-number">1</span> )<br>        v10 = <span class="hljs-number">1LL</span>;<br>      <span class="hljs-keyword">else</span><br>        v10 = (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)(<span class="hljs-number">2</span> * v14);<br>      <span class="hljs-keyword">do</span><br>      &#123;<br>        v11 = *v9++;<br>        v8 = (_OWORD *)((<span class="hljs-type">char</span> *)v8 + (<span class="hljs-type">int</span>)sub_888((__int64)v8, <span class="hljs-number">-1LL</span>, v7, v11));<br>        --v10;<br>      &#125;<br>      <span class="hljs-keyword">while</span> ( v10 );<br>    &#125;<br>    v12 = <span class="hljs-built_in">strcmp</span>(<br>            (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)s1,<br>            <span class="hljs-string">&quot;c2f6aade913f38fa407aceea7679a9db017ea632769a2c530f9917cbf2388a8dc89f80174a0d961820ebf4b20328e9ae&quot;</span>) == <span class="hljs-number">0</span>;<br>    (*(<span class="hljs-type">void</span> (__fastcall **)(__int64, __int64, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *))(*(_QWORD *)a1 + <span class="hljs-number">1360LL</span>))(a1, a3, v6);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    (*(<span class="hljs-type">void</span> (__fastcall **)(__int64, __int64, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *))(*(_QWORD *)a1 + <span class="hljs-number">1360LL</span>))(a1, a3, v5);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> v12;<br>&#125;<br></code></pre></td></tr></table></figure> 其中加密是一个魔改 tea <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64 __fastcall <span class="hljs-title function_">sub_92C</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *a1, _DWORD *a2, __int64 a3, <span class="hljs-type">int</span> *a4)</span><br>&#123;<br>  <span class="hljs-type">int</span> v8; <span class="hljs-comment">// w23</span><br>  <span class="hljs-type">int</span> v9; <span class="hljs-comment">// w8</span><br>  <span class="hljs-type">int</span> v10; <span class="hljs-comment">// w25</span><br>  __int64 result; <span class="hljs-comment">// x0</span><br>  <span class="hljs-type">unsigned</span> __int64 v12; <span class="hljs-comment">// x9</span><br>  __int64 v13; <span class="hljs-comment">// x11</span><br>  <span class="hljs-type">char</span> v14; <span class="hljs-comment">// w13</span><br>  __int64 v15; <span class="hljs-comment">// x14</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *v16; <span class="hljs-comment">// x15</span><br>  __int64 v17; <span class="hljs-comment">// x16</span><br>  <span class="hljs-type">char</span> v18; <span class="hljs-comment">// w17</span><br>  _BYTE *v19; <span class="hljs-comment">// x16</span><br>  <span class="hljs-type">unsigned</span> __int64 v20; <span class="hljs-comment">// x11</span><br>  <span class="hljs-type">char</span> v21; <span class="hljs-comment">// w12</span><br>  <span class="hljs-type">unsigned</span> __int64 v22; <span class="hljs-comment">// x13</span><br>  __int64 v23; <span class="hljs-comment">// x8</span><br>  __int64 v24; <span class="hljs-comment">// x10</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *v25; <span class="hljs-comment">// x14</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v26; <span class="hljs-comment">// w12</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v27; <span class="hljs-comment">// w13</span><br>  <span class="hljs-type">int</span> v28; <span class="hljs-comment">// w2</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v29; <span class="hljs-comment">// w3</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v30; <span class="hljs-comment">// w5</span><br>  __int64 v31; <span class="hljs-comment">// x15</span><br>  _BYTE v32[<span class="hljs-number">64</span>]; <span class="hljs-comment">// [xsp+8h] [xbp-48h] BYREF</span><br>  __int64 v33; <span class="hljs-comment">// [xsp+48h] [xbp-8h]</span><br><br>  v33 = *(_QWORD *)(_ReadStatusReg(ARM64_SYSREG(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">13</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>)) + <span class="hljs-number">40</span>);<br>  v8 = <span class="hljs-built_in">strlen</span>(a1);<br>  v9 = v8 + <span class="hljs-number">7</span>;<br>  <span class="hljs-keyword">if</span> ( v8 &lt; <span class="hljs-number">-7</span> )<br>    v9 = v8 + <span class="hljs-number">14</span>;<br>  v10 = v9 &gt;&gt; <span class="hljs-number">3</span>;<br>  result = __memset_chk(v32, <span class="hljs-number">0LL</span>, (<span class="hljs-type">int</span>)(v9 &amp; <span class="hljs-number">0xFFFFFFF8</span>), <span class="hljs-number">64LL</span>);<br>  <span class="hljs-keyword">if</span> ( v8 &lt;= <span class="hljs-number">0</span> )<br>  &#123;<br>    *a4 = v10;<br>    <span class="hljs-keyword">return</span> result;<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v8 &lt; <span class="hljs-number">2uLL</span> )<br>  &#123;<br>    v12 = <span class="hljs-number">0LL</span>;<br>    <span class="hljs-keyword">do</span><br>    &#123;<br>LABEL_10:<br>      v20 = v12 &amp; <span class="hljs-number">7</span>;<br>      v21 = a1[v12];<br>      v22 = v12++ &amp; <span class="hljs-number">0x7FFFFFF8</span>;<br>      v32[v22 + v20] = v21;<br>    &#125;<br>    <span class="hljs-keyword">while</span> ( v8 != v12 );<br>    <span class="hljs-keyword">goto</span> LABEL_11;<br>  &#125;<br>  v13 = <span class="hljs-number">0LL</span>;<br>  v12 = (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v8 - (<span class="hljs-type">unsigned</span> __int64)(v8 &amp; <span class="hljs-number">1</span>);<br>  <span class="hljs-keyword">do</span><br>  &#123;<br>    v14 = v13 + <span class="hljs-number">1</span>;<br>    v15 = v13 &amp; <span class="hljs-number">6</span>;<br>    v16 = &amp;a1[v13];<br>    v17 = v13 &amp; <span class="hljs-number">0x7FFFFFF8</span>;<br>    v13 += <span class="hljs-number">2LL</span>;<br>    v18 = *v16;<br>    v19 = &amp;v32[v17];<br>    LOBYTE(v16) = v16[<span class="hljs-number">1</span>];<br>    v19[v15] = v18;<br>    v19[v14 &amp; <span class="hljs-number">7</span>] = (_BYTE)v16;<br>  &#125;<br>  <span class="hljs-keyword">while</span> ( v12 != v13 );<br>  <span class="hljs-keyword">if</span> ( (v8 &amp; <span class="hljs-number">1</span>) != <span class="hljs-number">0</span> )<br>    <span class="hljs-keyword">goto</span> LABEL_10;<br>LABEL_11:<br>  *a4 = v10;<br>  v23 = <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">if</span> ( v10 &lt;= <span class="hljs-number">1</span> )<br>    v24 = <span class="hljs-number">1LL</span>;<br>  <span class="hljs-keyword">else</span><br>    v24 = (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v10;<br>  <span class="hljs-keyword">do</span><br>  &#123;<br>    v25 = (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *)&amp;v32[<span class="hljs-number">8</span> * v23];<br>    v27 = *v25;<br>    v26 = v25[<span class="hljs-number">1</span>];<br>    result = (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)a2[<span class="hljs-number">2</span>];<br>    v28 = <span class="hljs-number">32</span>;<br>    v29 = <span class="hljs-number">0x9E3779B9</span>;<br>    <span class="hljs-keyword">do</span><br>    &#123;<br>      --v28;<br>      v27 += (*a2 + <span class="hljs-number">16</span> * v26) ^ (v26 + v29) ^ (a2[<span class="hljs-number">1</span>] + (v26 &gt;&gt; <span class="hljs-number">5</span>));<br>      v30 = v29 + v27;<br>      v29 -= <span class="hljs-number">1640531527</span>;<br>      v26 += (result + <span class="hljs-number">16</span> * v27) ^ v30 ^ (a2[<span class="hljs-number">3</span>] + (v27 &gt;&gt; <span class="hljs-number">5</span>));<br>    &#125;<br>    <span class="hljs-keyword">while</span> ( v28 );<br>    v31 = <span class="hljs-number">8</span> * v23++;<br>    v25[<span class="hljs-number">1</span>] = v26;<br>    *(_DWORD *)&amp;v32[v31] = v27;<br>    *(_DWORD *)(a3 + v31) = v27;<br>    *(_DWORD *)(a3 + (v31 | <span class="hljs-number">4</span>)) = v26;<br>  &#125;<br>  <span class="hljs-keyword">while</span> ( v23 != v24 );<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure> 密钥
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">.rodata:<span class="hljs-number">0000000000000670</span> dword_670       DCD <span class="hljs-number">0xA56BABCD</span>, <span class="hljs-number">0x1F1234F1</span>, <span class="hljs-number">0x12345678</span>, <span class="hljs-number">0xFEDCBA98</span><br></code></pre></td></tr></table></figure></p>
<h3 id="exp">exp</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs python">K0 = <span class="hljs-number">0xA56BABCD</span><br>K1 = <span class="hljs-number">0x1F1234F1</span><br>K2 = <span class="hljs-number">0x12345678</span><br>K3 = <span class="hljs-number">0xFEDCBA98</span><br><br>DELTA    = <span class="hljs-number">0x61C88647</span><br>SUM_INIT = <span class="hljs-number">0x9E3779B9</span><br><br>TARGET_HEX = (<br>    <span class="hljs-string">&quot;c2f6aade913f38fa407aceea7679a9db&quot;</span><br>    <span class="hljs-string">&quot;017ea632769a2c530f9917cbf2388a8d&quot;</span><br>    <span class="hljs-string">&quot;c89f80174a0d961820ebf4b20328e9ae&quot;</span><br>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt_block</span>(<span class="hljs-params">v0, v1</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    还原自 sub_92C 里的那段 TEA-like 32 轮加密的逆过程：</span><br><span class="hljs-string">        y += f(z, sum)</span><br><span class="hljs-string">        tmp = sum + y</span><br><span class="hljs-string">        sum -= DELTA</span><br><span class="hljs-string">        z += g(y, tmp)</span><br><span class="hljs-string">    这里我们已知 (y,z,sum_after)，反推 (y,z,sum_before)。</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    sum_ = (SUM_INIT - <span class="hljs-number">32</span> * DELTA) &amp; <span class="hljs-number">0xFFFFFFFF</span>  <span class="hljs-comment"># 32 轮之后的 sum 值</span><br>    y1, z1 = v0, v1<br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>):<br>        <span class="hljs-comment"># 恢复到本轮开始时的 sum</span><br>        sum_prev = (sum_ + DELTA) &amp; <span class="hljs-number">0xFFFFFFFF</span><br><br>        <span class="hljs-comment"># 正向: tmp = sum_prev + y1</span><br>        tmp = (sum_prev + y1) &amp; <span class="hljs-number">0xFFFFFFFF</span><br><br>        <span class="hljs-comment"># 正向: z1 = z + g(y1, tmp)</span><br>        <span class="hljs-comment"># 反向: z = z1 - g(y1, tmp)</span><br>        z = (z1 - ((K2 + <span class="hljs-number">16</span> * y1) ^ tmp ^ (K3 + (y1 &gt;&gt; <span class="hljs-number">5</span>)))) &amp; <span class="hljs-number">0xFFFFFFFF</span><br><br>        <span class="hljs-comment"># 正向: y1 = y + f(z, sum_prev)</span><br>        <span class="hljs-comment"># 反向: y = y1 - f(z, sum_prev)</span><br>        y = (y1 - ((K0 + <span class="hljs-number">16</span> * z) ^<br>                   ((z + sum_prev) &amp; <span class="hljs-number">0xFFFFFFFF</span>) ^<br>                   (K1 + (z &gt;&gt; <span class="hljs-number">5</span>)))) &amp; <span class="hljs-number">0xFFFFFFFF</span><br><br>        <span class="hljs-comment"># 更新到上一轮的状态</span><br>        y1, z1, sum_ = y, z, sum_prev<br><br>    <span class="hljs-keyword">return</span> y1, z1<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-comment"># 把 96 位 hex 切成 12 个 32-bit 整数</span><br>    words = [<span class="hljs-built_in">int</span>(TARGET_HEX[i:i+<span class="hljs-number">8</span>], <span class="hljs-number">16</span>)<br>             <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(TARGET_HEX), <span class="hljs-number">8</span>)]<br><br>    <span class="hljs-comment"># 两个 32-bit 一组，作为一个 64-bit block 进行解密</span><br>    plaintext = <span class="hljs-built_in">bytearray</span>()<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(words), <span class="hljs-number">2</span>):<br>        v0, v1 = words[i], words[i + <span class="hljs-number">1</span>]<br>        y, z = decrypt_block(v0, v1)<br>        plaintext += y.to_bytes(<span class="hljs-number">4</span>, <span class="hljs-string">&quot;little&quot;</span>)<br>        plaintext += z.to_bytes(<span class="hljs-number">4</span>, <span class="hljs-string">&quot;little&quot;</span>)<br><br>    flag_bytes = plaintext.rstrip(<span class="hljs-string">b&quot;\x00&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Plain bytes:&quot;</span>, plaintext)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Flag:&quot;</span>, flag_bytes.decode(errors=<span class="hljs-string">&quot;ignore&quot;</span>))<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure>
<p>得到 flag <code>vctf&#123;ab92105b_047e_aa38_0b25_a6989b8e5ed5&#125;</code></p>
<h2 id="ez_ollvm_m4yb3">ez_ollvm_m4yb3</h2>
<p>拿到这道题题的时候看到是 linux
反调试有点头大，之前没怎么遇到过，感觉自己好像不会反反调
linux，后面学了一下发现其实也还好 ### 解密字符串 <code>main</code> 函数
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __fastcall <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  <span class="hljs-comment">// [COLLAPSED LOCAL DECLARATIONS. PRESS NUMPAD &quot;+&quot; TO EXPAND]</span><br><br>  v118 = xmmword_427E;<br>  v117 = xmmword_426E;<br>  *(_OWORD *)v116 = xmmword_425E;<br>  v119 = <span class="hljs-number">99</span>;<br>  v99 = <span class="hljs-number">233665123</span>;<br>  sub_3B00(v116, &amp;v99, <span class="hljs-number">49LL</span>, <span class="hljs-number">4LL</span>);<br>  qmemcpy(v108, <span class="hljs-string">&quot;9J&lt;T(D&amp;F6D&amp;V&#123;%&quot;</span>, <span class="hljs-number">14</span>);<br>  v98 = <span class="hljs-number">861021530</span>;<br>  sub_3B00(v108, &amp;v98, <span class="hljs-number">14LL</span>, <span class="hljs-number">4LL</span>);<br>  v84 = <span class="hljs-number">17386</span>;<br>  v83 = <span class="hljs-number">142619130</span>;<br>  v97 = <span class="hljs-number">1726956429</span>;<br>  sub_3B00(&amp;v83, &amp;v97, <span class="hljs-number">6LL</span>, <span class="hljs-number">4LL</span>);<br>  v109 = xmmword_4236;<br>  v110 = <span class="hljs-number">527534212</span>;<br>  v96 = <span class="hljs-number">521595368</span>;<br>  sub_3B00(&amp;v109, &amp;v96, <span class="hljs-number">20LL</span>, <span class="hljs-number">4LL</span>);<br>  *(_OWORD *)&amp;v115[<span class="hljs-number">13</span>] = *(__int128 *)((<span class="hljs-type">char</span> *)&amp;xmmword_4219 + <span class="hljs-number">13</span>);<br>  *(_OWORD *)v115 = xmmword_4219;<br>  v114 = xmmword_4209;<br>  v113 = xmmword_41F9;<br>  v112 = xmmword_41E9;<br>  v95 = <span class="hljs-number">1303455736</span>;<br>  sub_3B00(&amp;v112, &amp;v95, <span class="hljs-number">77LL</span>, <span class="hljs-number">4LL</span>);<br>  v86 = <span class="hljs-number">25263</span>;<br>  v85 = <span class="hljs-number">918487533</span>;<br>  v94 = <span class="hljs-number">1540383426</span>;<br>  sub_3B00(&amp;v85, &amp;v94, <span class="hljs-number">6LL</span>, <span class="hljs-number">4LL</span>);<br>  <span class="hljs-built_in">memcpy</span>(dest, &amp;unk_4100, <span class="hljs-number">0xC9u</span>LL);<br>  v93 = <span class="hljs-number">1350490027</span>;<br>  sub_3B00(dest, &amp;v93, <span class="hljs-number">201LL</span>, <span class="hljs-number">4LL</span>);<br>  *(_QWORD *)&amp;v111[<span class="hljs-number">13</span>] = <span class="hljs-number">0xEC063B3D9C123462L</span>L;<br>  *(__m128i *)v111 = _mm_loadu_si128(&amp;xmmword_40B2);<br>  v92 = <span class="hljs-number">1649760492</span>;<br>  sub_3B00(v111, &amp;v92, <span class="hljs-number">21LL</span>, <span class="hljs-number">4LL</span>);<br>  *(_DWORD *)&amp;v87[<span class="hljs-number">3</span>] = <span class="hljs-number">2064426333</span>;<br>  *(_DWORD *)v87 = <span class="hljs-number">1560892393</span>;<br>  v91 = <span class="hljs-number">846930886</span>;<br>  sub_3B00(v87, &amp;v91, <span class="hljs-number">7LL</span>, <span class="hljs-number">4LL</span>);<br>  v3 = getpid();<br>  v4 = <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">if</span> ( (<span class="hljs-type">unsigned</span> __int8)check_tracer_pid(v3) )<br>    <span class="hljs-keyword">return</span> v4;<br>  v5 = getppid();<br>  v6 = -v5;<br>  <span class="hljs-keyword">if</span> ( v5 &gt; <span class="hljs-number">0</span> )<br>    v6 = v5;<br>  v7 = <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">if</span> ( v6 &gt;= <span class="hljs-number">0xA</span> )<br>  &#123;<br>    v7 = <span class="hljs-number">4</span>;<br>    v8 = v6;<br>    <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>    &#123;<br>      <span class="hljs-keyword">if</span> ( v8 &lt;= <span class="hljs-number">0x63</span> )<br>      &#123;<br>        v7 -= <span class="hljs-number">2</span>;<br>        <span class="hljs-keyword">goto</span> LABEL_13;<br>      &#125;<br>      <span class="hljs-keyword">if</span> ( v8 &lt;= <span class="hljs-number">0x3E7</span> )<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">if</span> ( v8 &lt; <span class="hljs-number">0x2710</span> )<br>        <span class="hljs-keyword">goto</span> LABEL_13;<br>      v7 += <span class="hljs-number">4</span>;<br>      v9 = v8 &lt;= <span class="hljs-number">0x1869F</span>;<br>      v8 /= <span class="hljs-number">0x2710u</span>;<br>      <span class="hljs-keyword">if</span> ( v9 )<br>      &#123;<br>        v7 -= <span class="hljs-number">3</span>;<br>        <span class="hljs-keyword">goto</span> LABEL_13;<br>      &#125;<br>    &#125;<br>    --v7;<br>  &#125;<br>LABEL_13:<br>  v10 = (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v5 &gt;&gt; <span class="hljs-number">31</span>;<br>  s2 = v90;<br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::_M_construct(&amp;s2, v7 + ((<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v5 &gt;&gt; <span class="hljs-number">31</span>), <span class="hljs-number">45LL</span>);<br>  v11 = (<span class="hljs-type">char</span> *)s2 + v10;<br>  <span class="hljs-keyword">if</span> ( v6 &lt; <span class="hljs-number">0x64</span> )<br>  &#123;<br>    v13 = v6;<br>    <span class="hljs-keyword">if</span> ( v6 &gt;= <span class="hljs-number">0xA</span> )<br>    &#123;<br>LABEL_17:<br>      v11[<span class="hljs-number">1</span>] = dest[<span class="hljs-number">2</span> * (v13 &amp; <span class="hljs-number">0x7FFFFFFF</span>) + <span class="hljs-number">1</span>];<br>      v15 = dest[<span class="hljs-number">2</span> * v13];<br>      <span class="hljs-keyword">goto</span> LABEL_20;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    v12 = v7 - <span class="hljs-number">2</span>;<br>    <span class="hljs-keyword">do</span><br>    &#123;<br>      v13 = v6 / <span class="hljs-number">0x64</span>;<br>      v14 = v6 % <span class="hljs-number">0x64</span>;<br>      v11[v12 + <span class="hljs-number">1</span>] = dest[<span class="hljs-number">2</span> * v14 + <span class="hljs-number">1</span>];<br>      v11[v12] = dest[<span class="hljs-number">2</span> * v14];<br>      v12 -= <span class="hljs-number">2</span>;<br>      v9 = v6 &lt;= <span class="hljs-number">0x270F</span>;<br>      v6 /= <span class="hljs-number">0x64u</span>;<br>    &#125;<br>    <span class="hljs-keyword">while</span> ( !v9 );<br>    <span class="hljs-keyword">if</span> ( v13 &gt;= <span class="hljs-number">0xA</span> )<br>      <span class="hljs-keyword">goto</span> LABEL_17;<br>  &#125;<br>  v15 = v13 + <span class="hljs-number">48</span>;<br>LABEL_20:<br>  *v11 = v15;<br>  v16 = <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::_M_replace(&amp;s2, <span class="hljs-number">0LL</span>, <span class="hljs-number">0LL</span>, v87, <span class="hljs-number">6LL</span>);<br>  v17 = v16;<br>  *(_QWORD *)stat_loc = v132;<br>  v18 = (_QWORD *)(v16 + <span class="hljs-number">16</span>);<br>  <span class="hljs-keyword">if</span> ( *(_QWORD *)v16 == v16 + <span class="hljs-number">16</span> )<br>  &#123;<br>    <span class="hljs-built_in">memcpy</span>(v132, *(<span class="hljs-type">const</span> <span class="hljs-type">void</span> **)v16, *(_QWORD *)(v16 + <span class="hljs-number">8</span>) + <span class="hljs-number">1LL</span>);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    *(_QWORD *)stat_loc = *(_QWORD *)v16;<br>    v132[<span class="hljs-number">0</span>] = *v18;<br>  &#125;<br>  *(_QWORD *)&amp;stat_loc[<span class="hljs-number">2</span>] = *(_QWORD *)(v17 + <span class="hljs-number">8</span>);<br>  *(_QWORD *)v17 = v18;<br>  *(_QWORD *)(v17 + <span class="hljs-number">8</span>) = <span class="hljs-number">0LL</span>;<br>  *(_BYTE *)(v17 + <span class="hljs-number">16</span>) = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">if</span> ( (<span class="hljs-type">unsigned</span> __int64)(*(_QWORD *)&amp;stat_loc[<span class="hljs-number">2</span>] - <span class="hljs-number">0x3FFFFFFFFFFFFFFBL</span>L) &lt;= <span class="hljs-number">4</span> )<br>    <span class="hljs-built_in">std</span>::__throw_length_error(v111);<br>  v19 = <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::_M_append(stat_loc, &amp;v85, <span class="hljs-number">5LL</span>);<br>  v20 = v19;<br>  v120 = v122;<br>  v21 = (_QWORD *)(v19 + <span class="hljs-number">16</span>);<br>  <span class="hljs-keyword">if</span> ( *(_QWORD *)v19 == v19 + <span class="hljs-number">16</span> )<br>  &#123;<br>    <span class="hljs-built_in">memcpy</span>(v122, *(<span class="hljs-type">const</span> <span class="hljs-type">void</span> **)v19, *(_QWORD *)(v19 + <span class="hljs-number">8</span>) + <span class="hljs-number">1LL</span>);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    v120 = *(<span class="hljs-type">void</span> **)v19;<br>    v122[<span class="hljs-number">0</span>] = *v21;<br>  &#125;<br>  v121 = *(<span class="hljs-type">char</span> **)(v20 + <span class="hljs-number">8</span>);<br>  *(_QWORD *)v20 = v21;<br>  *(_QWORD *)(v20 + <span class="hljs-number">8</span>) = <span class="hljs-number">0LL</span>;<br>  *(_BYTE *)(v20 + <span class="hljs-number">16</span>) = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">if</span> ( *(_QWORD **)stat_loc != v132 )<br>    operator <span class="hljs-title function_">delete</span><span class="hljs-params">(*(<span class="hljs-type">void</span> **)stat_loc)</span>;<br>  <span class="hljs-keyword">if</span> ( s2 != v90 )<br>    operator <span class="hljs-title function_">delete</span><span class="hljs-params">(s2)</span>;<br>  <span class="hljs-built_in">std</span>::ifstream::basic_ifstream(stat_loc, &amp;v120, <span class="hljs-number">8LL</span>);<br>  v100[<span class="hljs-number">0</span>] = v101;<br>  v100[<span class="hljs-number">1</span>] = <span class="hljs-number">0LL</span>;<br>  v101[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>;<br>  v22 = *(_QWORD *)(*(_QWORD *)stat_loc - <span class="hljs-number">24LL</span>);<br>  <span class="hljs-keyword">if</span> ( (*((_BYTE *)&amp;v132[<span class="hljs-number">2</span>] + v22) &amp; <span class="hljs-number">5</span>) == <span class="hljs-number">0</span> )<br>  &#123;<br>    v23 = *(_BYTE **)((<span class="hljs-type">char</span> *)&amp;v132[<span class="hljs-number">28</span>] + v22);<br>    <span class="hljs-keyword">if</span> ( !v23 )<br>      <span class="hljs-built_in">std</span>::__throw_bad_cast();<br>    <span class="hljs-keyword">if</span> ( v23[<span class="hljs-number">56</span>] )<br>    &#123;<br>      v24 = v23[<span class="hljs-number">67</span>];<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      <span class="hljs-built_in">std</span>::ctype&lt;<span class="hljs-type">char</span>&gt;::_M_widen_init(*(_QWORD *)((<span class="hljs-type">char</span> *)&amp;v132[<span class="hljs-number">28</span>] + v22));<br>      v24 = (*(__int64 (__fastcall **)(_BYTE *, __int64))(*(_QWORD *)v23 + <span class="hljs-number">48LL</span>))(v23, <span class="hljs-number">10LL</span>);<br>    &#125;<br>    <span class="hljs-built_in">std</span>::getline&lt;<span class="hljs-type">char</span>,<span class="hljs-built_in">std</span>::char_traits&lt;<span class="hljs-type">char</span>&gt;,<span class="hljs-built_in">std</span>::allocator&lt;<span class="hljs-type">char</span>&gt;&gt;(stat_loc, v100, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v24);<br>  &#125;<br>  <span class="hljs-built_in">std</span>::ifstream::~ifstream(stat_loc, &amp;`VTT <span class="hljs-keyword">for</span><span class="hljs-string">&#x27;std::ifstream);</span><br><span class="hljs-string">  std::ios_base::~ios_base((std::ios_base *)v133);</span><br><span class="hljs-string">  if ( v120 != v122 )</span><br><span class="hljs-string">    operator delete(v120);</span><br><span class="hljs-string">  prctl(4, 0LL);</span><br><span class="hljs-string">  v25 = fork();</span><br><span class="hljs-string">  if ( v25 &lt; 0 )</span><br><span class="hljs-string">  &#123;</span><br><span class="hljs-string">    v4 = 1;</span><br><span class="hljs-string">    goto LABEL_114;</span><br><span class="hljs-string">  &#125;</span><br><span class="hljs-string">  if ( v25 )</span><br><span class="hljs-string">  &#123;</span><br><span class="hljs-string">    v26 = v25;</span><br><span class="hljs-string">    stat_loc[0] = 0;</span><br><span class="hljs-string">    while ( waitpid(v26, stat_loc, 1) != v26 )</span><br><span class="hljs-string">    &#123;</span><br><span class="hljs-string">      if ( (unsigned __int8)check_tracer_pid(v26) || (v27 = getpid(), (unsigned __int8)check_tracer_pid(v27)) )</span><br><span class="hljs-string">      &#123;</span><br><span class="hljs-string">        kill(v26, 9);</span><br><span class="hljs-string">        goto LABEL_113;</span><br><span class="hljs-string">      &#125;</span><br><span class="hljs-string">      usleep(0x7A120u);</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">    goto LABEL_113;</span><br><span class="hljs-string">  &#125;</span><br><span class="hljs-string">  v28 = getpid();</span><br><span class="hljs-string">  if ( (unsigned __int8)check_tracer_pid(v28) )</span><br><span class="hljs-string">    _exit(1);</span><br><span class="hljs-string">  v29 = (_DWORD *)operator new(4uLL);</span><br><span class="hljs-string">  *v29 = 1179927382;</span><br><span class="hljs-string">  s2 = v90;</span><br><span class="hljs-string">  *(_QWORD *)stat_loc = 76LL;</span><br><span class="hljs-string">  v30 = (__m128i *)std::string::_M_create(&amp;s2, stat_loc, 0LL);</span><br><span class="hljs-string">  s2 = v30;</span><br><span class="hljs-string">  v31 = *(_QWORD *)stat_loc;</span><br><span class="hljs-string">  v90[0] = *(_QWORD *)stat_loc;</span><br><span class="hljs-string">  *(__m128i *)((char *)v30 + 60) = *(__m128i *)&amp;v115[12];</span><br><span class="hljs-string">  si128 = _mm_load_si128((const __m128i *)&amp;v112);</span><br><span class="hljs-string">  v33 = _mm_load_si128((const __m128i *)&amp;v113);</span><br><span class="hljs-string">  v34 = _mm_load_si128((const __m128i *)&amp;v114);</span><br><span class="hljs-string">  v30[3] = _mm_load_si128((const __m128i *)v115);</span><br><span class="hljs-string">  v30[2] = v34;</span><br><span class="hljs-string">  v30[1] = v33;</span><br><span class="hljs-string">  *v30 = si128;</span><br><span class="hljs-string">  v89 = v31;</span><br><span class="hljs-string">  v30-&gt;m128i_i8[v31] = 0;</span><br><span class="hljs-string">  src = v107;</span><br><span class="hljs-string">  n = 0LL;</span><br><span class="hljs-string">  v107[0] = 0;</span><br><span class="hljs-string">  std::__ostream_insert&lt;char,std::char_traits&lt;char&gt;&gt;(&amp;std::cout, &amp;v109, 19LL);</span><br><span class="hljs-string">  v35 = *(_BYTE **)((char *)&amp;std::cout + *(_QWORD *)(std::cout - 24LL) + 240);</span><br><span class="hljs-string">  if ( !v35</span><br><span class="hljs-string">    || (!v35[56]</span><br><span class="hljs-string">      ? (std::ctype&lt;char&gt;::_M_widen_init(v35),</span><br><span class="hljs-string">         v36 = (*(__int64 (__fastcall **)(_BYTE *, __int64))(*(_QWORD *)v35 + 48LL))(v35, 10LL))</span><br><span class="hljs-string">      : (v36 = v35[67]),</span><br><span class="hljs-string">        v37 = (std::ostream *)std::ostream::put((std::ostream *)&amp;std::cout, v36),</span><br><span class="hljs-string">        std::ostream::flush(v37),</span><br><span class="hljs-string">        v38 = *(_QWORD *)(std::cin - 24LL),</span><br><span class="hljs-string">        (v39 = *(_BYTE **)((char *)&amp;std::cin + v38 + 240)) == 0LL) )</span><br><span class="hljs-string">  &#123;</span><br><span class="hljs-string">LABEL_118:</span><br><span class="hljs-string">    std::__throw_bad_cast();</span><br><span class="hljs-string">  &#125;</span><br><span class="hljs-string">  if ( v39[56] )</span><br><span class="hljs-string">  &#123;</span><br><span class="hljs-string">    v40 = v39[67];</span><br><span class="hljs-string">  &#125;</span><br><span class="hljs-string">  else</span><br><span class="hljs-string">  &#123;</span><br><span class="hljs-string">    std::ctype&lt;char&gt;::_M_widen_init(*(_QWORD *)((char *)&amp;std::cin + v38 + 240));</span><br><span class="hljs-string">    v40 = (*(__int64 (__fastcall **)(_BYTE *, __int64))(*(_QWORD *)v39 + 48LL))(v39, 10LL);</span><br><span class="hljs-string">  &#125;</span><br><span class="hljs-string">  v41 = (_QWORD *)std::getline&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt;&gt;(&amp;std::cin, &amp;src, (unsigned int)v40);</span><br><span class="hljs-string">  if ( (*((_BYTE *)v41 + *(_QWORD *)(*v41 - 24LL) + 32) &amp; 5) == 0 )</span><br><span class="hljs-string">  &#123;</span><br><span class="hljs-string">    v44 = n;</span><br><span class="hljs-string">    if ( (n &amp; 0x8000000000000000LL) != 0LL )</span><br><span class="hljs-string">      std::__throw_length_error(v116);</span><br><span class="hljs-string">    if ( n )</span><br><span class="hljs-string">    &#123;</span><br><span class="hljs-string">      v45 = src;</span><br><span class="hljs-string">      v46 = (char *)operator new(n);</span><br><span class="hljs-string">      v47 = &amp;v46[v44];</span><br><span class="hljs-string">      memcpy(v46, v45, v44);</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">    else</span><br><span class="hljs-string">    &#123;</span><br><span class="hljs-string">      v46 = 0LL;</span><br><span class="hljs-string">      v47 = 0LL;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">    v49 = _mm_load_si128((const __m128i *)&amp;xmmword_4010);</span><br><span class="hljs-string">    v50 = 56LL;</span><br><span class="hljs-string">    v51 = _mm_load_si128((const __m128i *)&amp;xmmword_4020);</span><br><span class="hljs-string">    v52 = _mm_load_si128((const __m128i *)&amp;xmmword_4030);</span><br><span class="hljs-string">    v53 = _mm_load_si128((const __m128i *)&amp;xmmword_4040);</span><br><span class="hljs-string">    v54 = _mm_load_si128((const __m128i *)&amp;xmmword_4050);</span><br><span class="hljs-string">    v55 = _mm_load_si128((const __m128i *)&amp;xmmword_4060);</span><br><span class="hljs-string">    v56 = _mm_load_si128((const __m128i *)&amp;xmmword_4070);</span><br><span class="hljs-string">    v57 = _mm_load_si128((const __m128i *)&amp;xmmword_4080);</span><br><span class="hljs-string">    v58 = _mm_load_si128(xmmword_4090);</span><br><span class="hljs-string">    do</span><br><span class="hljs-string">    &#123;</span><br><span class="hljs-string">      *(__m128i *)&amp;dest[2 * v50 + 104] = v49;</span><br><span class="hljs-string">      *(__m128i *)&amp;dest[2 * v50 + 120] = _mm_add_epi16(v49, v51);</span><br><span class="hljs-string">      *(__m128i *)&amp;dest[2 * v50 + 136] = _mm_add_epi16(v49, v52);</span><br><span class="hljs-string">      *(__m128i *)&amp;dest[2 * v50 + 152] = _mm_add_epi16(v49, v53);</span><br><span class="hljs-string">      *(__m128i *)&amp;dest[2 * v50 + 168] = _mm_add_epi16(v49, v54);</span><br><span class="hljs-string">      *(__m128i *)&amp;dest[2 * v50 + 184] = _mm_add_epi16(v49, v55);</span><br><span class="hljs-string">      *(__m128i *)&amp;dest[2 * v50 + 200] = _mm_add_epi16(v49, v56);</span><br><span class="hljs-string">      *(__m128i *)&amp;stat_loc[v50 / 2] = _mm_add_epi16(v49, v57);</span><br><span class="hljs-string">      v49 = _mm_add_epi16(v49, v58);</span><br><span class="hljs-string">      v50 += 64LL;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">    while ( v50 != 1080 );</span><br><span class="hljs-string">    v59 = 1LL;</span><br><span class="hljs-string">    LOWORD(v60) = 0;</span><br><span class="hljs-string">    do</span><br><span class="hljs-string">    &#123;</span><br><span class="hljs-string">      v61 = *(_WORD *)&amp;dest[2 * v59 + 214];</span><br><span class="hljs-string">      v62 = v61 + v60 + *((unsigned __int8 *)v29 + (((_BYTE)v59 - 1) &amp; 2));</span><br><span class="hljs-string">      v63 = v62 &amp; 0x3FF;</span><br><span class="hljs-string">      *(_WORD *)&amp;dest[2 * v59 + 214] = *((_WORD *)stat_loc + v63);</span><br><span class="hljs-string">      *((_WORD *)stat_loc + v63) = v61;</span><br><span class="hljs-string">      v64 = *((unsigned __int16 *)stat_loc + v59);</span><br><span class="hljs-string">      v60 = (v62 + (_WORD)v64 + *((unsigned __int8 *)v29 + (v59 &amp; 3))) &amp; 0x3FF;</span><br><span class="hljs-string">      v65 = *((unsigned __int16 *)stat_loc + v60);</span><br><span class="hljs-string">      *((_WORD *)stat_loc + v59) = v65;</span><br><span class="hljs-string">      *((_WORD *)stat_loc + v60) = v64;</span><br><span class="hljs-string">      v59 += 2LL;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">    while ( v59 != 1025 );</span><br><span class="hljs-string">    v66 = v47 - v46;</span><br><span class="hljs-string">    if ( v47 != v46 )</span><br><span class="hljs-string">    &#123;</span><br><span class="hljs-string">      v67 = 1LL;</span><br><span class="hljs-string">      if ( v66 &gt;= 2 )</span><br><span class="hljs-string">        v67 = v47 - v46;</span><br><span class="hljs-string">      LOWORD(v66) = 0;</span><br><span class="hljs-string">      LOWORD(v65) = 0;</span><br><span class="hljs-string">      v64 = 0LL;</span><br><span class="hljs-string">      do</span><br><span class="hljs-string">      &#123;</span><br><span class="hljs-string">        v66 = ((_WORD)v66 + 1) &amp; 0x3FF;</span><br><span class="hljs-string">        v68 = *((_WORD *)stat_loc + v66);</span><br><span class="hljs-string">        v65 = (v68 + (_WORD)v65) &amp; 0x3FF;</span><br><span class="hljs-string">        *((_WORD *)stat_loc + v66) = *((_WORD *)stat_loc + v65);</span><br><span class="hljs-string">        *((_WORD *)stat_loc + v65) = v68;</span><br><span class="hljs-string">        v46[v64++] ^= *((_BYTE *)stat_loc + 2 * ((v68 + *((_WORD *)stat_loc + v66)) &amp; 0x3FF)) ^ 0x91;</span><br><span class="hljs-string">      &#125;</span><br><span class="hljs-string">      while ( v67 != v64 );</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">    std::ostringstream::basic_ostringstream(&amp;v120, v64, v65, v66, *(double *)v49.m128i_i64);</span><br><span class="hljs-string">    v69 = v120;</span><br><span class="hljs-string">    v70 = *((_QWORD *)v120 - 3);</span><br><span class="hljs-string">    v71 = *(_DWORD *)((_BYTE *)&amp;v122[1] + v70) &amp; 0xFFFFFFB5 | 8;</span><br><span class="hljs-string">    *(_DWORD *)((char *)&amp;v122[1] + v70) = v71;</span><br><span class="hljs-string">    v72 = *(v69 - 3);</span><br><span class="hljs-string">    if ( !v129[v72 + 113] )</span><br><span class="hljs-string">    &#123;</span><br><span class="hljs-string">      v73 = *(_BYTE **)&amp;v129[v72 + 128];</span><br><span class="hljs-string">      if ( !v73 )</span><br><span class="hljs-string">        std::__throw_bad_cast();</span><br><span class="hljs-string">      if ( !v73[56] )</span><br><span class="hljs-string">      &#123;</span><br><span class="hljs-string">        std::ctype&lt;char&gt;::_M_widen_init(*(_QWORD *)&amp;v129[v72 + 128]);</span><br><span class="hljs-string">        (*(void (__fastcall **)(_BYTE *, __int64))(*(_QWORD *)v73 + 48LL))(v73, 32LL);</span><br><span class="hljs-string">        v69 = v120;</span><br><span class="hljs-string">      &#125;</span><br><span class="hljs-string">      v129[v72 + 113] = 1;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">    v129[v72 + 112] = 48;</span><br><span class="hljs-string">    *(_DWORD *)((char *)&amp;v122[1] + *(v69 - 3)) &amp;= ~0x4000u;</span><br><span class="hljs-string">    v74 = v47 - v46;</span><br><span class="hljs-string">    if ( v74 )</span><br><span class="hljs-string">    &#123;</span><br><span class="hljs-string">      v75 = 1LL;</span><br><span class="hljs-string">      if ( v74 &gt;= 2 )</span><br><span class="hljs-string">        v75 = v74;</span><br><span class="hljs-string">      for ( i = 0LL; i != v75; ++i )</span><br><span class="hljs-string">      &#123;</span><br><span class="hljs-string">        *(_QWORD *)((char *)v122 + *((_QWORD *)v120 - 3)) = 2LL;</span><br><span class="hljs-string">        std::ostream::operator&lt;&lt;(&amp;v120, (unsigned __int8)v46[i]);</span><br><span class="hljs-string">      &#125;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">    s1 = v104;</span><br><span class="hljs-string">    v103 = 0LL;</span><br><span class="hljs-string">    v104[0] = 0;</span><br><span class="hljs-string">    v77 = v123;</span><br><span class="hljs-string">    if ( v125 &gt; v123 )</span><br><span class="hljs-string">      v77 = v125;</span><br><span class="hljs-string">    if ( v125 &amp;&amp; v77 )</span><br><span class="hljs-string">      std::string::_M_replace(&amp;s1, 0LL, 0LL, v124, v77 - v124);</span><br><span class="hljs-string">    else</span><br><span class="hljs-string">      std::string::_M_assign(&amp;s1, &amp;v127, v71, v70, v77);</span><br><span class="hljs-string">    if ( v103 != v89 || v103 &amp;&amp; bcmp(s1, s2, v103) )</span><br><span class="hljs-string">    &#123;</span><br><span class="hljs-string">      std::__ostream_insert&lt;char,std::char_traits&lt;char&gt;&gt;(&amp;std::cout, &amp;v83, 5LL);</span><br><span class="hljs-string">      v78 = *(_BYTE **)((char *)&amp;std::cout + *(_QWORD *)(std::cout - 24LL) + 240);</span><br><span class="hljs-string">      if ( v78 )</span><br><span class="hljs-string">      &#123;</span><br><span class="hljs-string">        if ( !v78[56] )</span><br><span class="hljs-string">          goto LABEL_101;</span><br><span class="hljs-string">        goto LABEL_100;</span><br><span class="hljs-string">      &#125;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">    else</span><br><span class="hljs-string">    &#123;</span><br><span class="hljs-string">      std::__ostream_insert&lt;char,std::char_traits&lt;char&gt;&gt;(&amp;std::cout, v108, 13LL);</span><br><span class="hljs-string">      v78 = *(_BYTE **)((char *)&amp;std::cout + *(_QWORD *)(std::cout - 24LL) + 240);</span><br><span class="hljs-string">      if ( v78 )</span><br><span class="hljs-string">      &#123;</span><br><span class="hljs-string">        if ( !v78[56] )</span><br><span class="hljs-string">        &#123;</span><br><span class="hljs-string">LABEL_101:</span><br><span class="hljs-string">          std::ctype&lt;char&gt;::_M_widen_init(v78);</span><br><span class="hljs-string">          v79 = (*(__int64 (__fastcall **)(_BYTE *, __int64))(*(_QWORD *)v78 + 48LL))(v78, 10LL);</span><br><span class="hljs-string">          goto LABEL_102;</span><br><span class="hljs-string">        &#125;</span><br><span class="hljs-string">LABEL_100:</span><br><span class="hljs-string">        v79 = v78[67];</span><br><span class="hljs-string">LABEL_102:</span><br><span class="hljs-string">        v80 = (std::ostream *)std::ostream::put((std::ostream *)&amp;std::cout, v79);</span><br><span class="hljs-string">        std::ostream::flush(v80);</span><br><span class="hljs-string">        if ( s1 != v104 )</span><br><span class="hljs-string">          operator delete(s1);</span><br><span class="hljs-string">        v81 = (void *)`VTT for&#x27;</span><span class="hljs-built_in">std</span>::<span class="hljs-built_in">ostringstream</span>[<span class="hljs-number">3</span>];<br>        v120 = (<span class="hljs-type">void</span> *)`VTT <span class="hljs-keyword">for</span><span class="hljs-string">&#x27;std::ostringstream[0];</span><br><span class="hljs-string">        *(void **)((char *)&amp;v120 + *(_QWORD *)(`VTT for&#x27;</span><span class="hljs-built_in">std</span>::<span class="hljs-built_in">ostringstream</span>[<span class="hljs-number">0</span>] - <span class="hljs-number">24LL</span>)) = v81;<br>        v121 = (<span class="hljs-type">char</span> *)&amp;`vtable <span class="hljs-keyword">for</span><span class="hljs-string">&#x27;std::stringbuf + 16;</span><br><span class="hljs-string">        if ( v127 != &amp;v128 )</span><br><span class="hljs-string">          operator delete(v127);</span><br><span class="hljs-string">        v121 = (char *)&amp;`vtable for&#x27;</span><span class="hljs-built_in">std</span>::streambuf + <span class="hljs-number">16</span>;<br>        <span class="hljs-built_in">std</span>::locale::~locale((<span class="hljs-built_in">std</span>::locale *)v126);<br>        <span class="hljs-built_in">std</span>::ios_base::~ios_base((<span class="hljs-built_in">std</span>::ios_base *)v129);<br>        <span class="hljs-keyword">if</span> ( v46 )<br>          operator <span class="hljs-title function_">delete</span><span class="hljs-params">(v46)</span>;<br>        <span class="hljs-keyword">goto</span> LABEL_108;<br>      &#125;<br>    &#125;<br>    <span class="hljs-built_in">std</span>::__throw_bad_cast();<br>  &#125;<br>  <span class="hljs-built_in">std</span>::__ostream_insert&lt;<span class="hljs-type">char</span>,<span class="hljs-built_in">std</span>::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;(&amp;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span>, &amp;v83, <span class="hljs-number">5LL</span>);<br>  v42 = *(_BYTE **)((<span class="hljs-type">char</span> *)&amp;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> + *(_QWORD *)(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> - <span class="hljs-number">24LL</span>) + <span class="hljs-number">240</span>);<br>  <span class="hljs-keyword">if</span> ( !v42 )<br>    <span class="hljs-keyword">goto</span> LABEL_118;<br>  <span class="hljs-keyword">if</span> ( v42[<span class="hljs-number">56</span>] )<br>  &#123;<br>    v43 = v42[<span class="hljs-number">67</span>];<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-built_in">std</span>::ctype&lt;<span class="hljs-type">char</span>&gt;::_M_widen_init(v42);<br>    v43 = (*(__int64 (__fastcall **)(_BYTE *, __int64))(*(_QWORD *)v42 + <span class="hljs-number">48LL</span>))(v42, <span class="hljs-number">10LL</span>);<br>  &#125;<br>  v48 = (<span class="hljs-built_in">std</span>::ostream *)<span class="hljs-built_in">std</span>::ostream::put((<span class="hljs-built_in">std</span>::ostream *)&amp;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span>, v43);<br>  <span class="hljs-built_in">std</span>::ostream::flush(v48);<br>LABEL_108:<br>  <span class="hljs-keyword">if</span> ( src != v107 )<br>    operator <span class="hljs-title function_">delete</span><span class="hljs-params">(src)</span>;<br>  <span class="hljs-keyword">if</span> ( s2 != v90 )<br>    operator <span class="hljs-title function_">delete</span><span class="hljs-params">(s2)</span>;<br>  operator <span class="hljs-title function_">delete</span><span class="hljs-params">(v29)</span>;<br>LABEL_113:<br>  v4 = <span class="hljs-number">0</span>;<br>LABEL_114:<br>  <span class="hljs-keyword">if</span> ( v100[<span class="hljs-number">0</span>] != v101 )<br>    operator <span class="hljs-title function_">delete</span><span class="hljs-params">(v100[<span class="hljs-number">0</span>])</span>;<br>  <span class="hljs-keyword">return</span> v4;<br>&#125;<br></code></pre></td></tr></table></figure> 它的字符串都是通过一个函数 <code>sub_3B00</code>
进行动态解密的 用 frida hook 这个函数，dump
出解密后的字符串（因为最开始不想 patch 文件绕过反调试动调于是就用的
frida） <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># interact.py</span><br><span class="hljs-keyword">import</span> frida<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">on_message</span>(<span class="hljs-params">message, data</span>):<br>    <span class="hljs-keyword">if</span> message[<span class="hljs-string">&#x27;type&#x27;</span>] == <span class="hljs-string">&#x27;send&#x27;</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[*] &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(message[<span class="hljs-string">&#x27;payload&#x27;</span>]))<br>    <span class="hljs-keyword">elif</span> message[<span class="hljs-string">&#x27;type&#x27;</span>] == <span class="hljs-string">&#x27;error&#x27;</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[!] Script error:&quot;</span>, message.get(<span class="hljs-string">&#x27;description&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>))<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;stack&#x27;</span> <span class="hljs-keyword">in</span> message:<br>            <span class="hljs-built_in">print</span>(message[<span class="hljs-string">&#x27;stack&#x27;</span>])<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(message)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;test.js&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        jscode = f.read()<br><br>    target = <span class="hljs-string">&quot;./attachment&quot;</span><br>    device = frida.get_local_device()<br><br>    <span class="hljs-keyword">try</span>:<br>        pid = device.spawn([target],stdio=<span class="hljs-string">&quot;pipe&quot;</span>)<br>        session=device.attach(pid)<br>        <span class="hljs-built_in">print</span>(pid)<br>    <span class="hljs-keyword">except</span> frida.ProcessNotFoundError:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;No such process&quot;</span>)<br>        sys.exit(<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;spawn/attach error&quot;</span>,e)<br>        sys.exit(<span class="hljs-number">1</span>)<br><br>    <span class="hljs-keyword">try</span>:<br>        script = session.create_script(jscode)<br>        script.on(<span class="hljs-string">&#x27;message&#x27;</span>, on_message)<br>        script.load()<br>        <span class="hljs-comment"># time.sleep(2)</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;script loaded&quot;</span>)<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;script load error&quot;</span>,e)<br><br>        <span class="hljs-keyword">try</span>:<br>            session.detach()<br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-keyword">pass</span><br>        sys.exit(<span class="hljs-number">1</span>)<br><br>    <span class="hljs-keyword">try</span>:<br>        device.resume(pid) <span class="hljs-comment"># 恢复目标进程</span><br>        device.<span class="hljs-built_in">input</span>(pid,<span class="hljs-string">b&quot;flag&#123;0123456789abcdef&#125;\n&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;process resumed&quot;</span>)<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;resume error&quot;</span>,e)<br>        sys.exit(<span class="hljs-number">1</span>)<br><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;waiting for hooks to trigger...&quot;</span>)<br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            time.sleep(<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">except</span> KeyboardInterrupt:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;detaching...&quot;</span>)<br>        session.detach()<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br></code></pre></td></tr></table></figure></p>
<p>hook 代码 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">hook_xor_decrypt</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] Hooking xor_decrypt function...&quot;</span>);<br>    <span class="hljs-keyword">let</span> target_module = <span class="hljs-string">&quot;attachment&quot;</span>;<br>    <span class="hljs-keyword">let</span> mod = <span class="hljs-title class_">Process</span>.<span class="hljs-title function_">getModuleByName</span>(target_module);<br>    <span class="hljs-keyword">let</span> base = mod.<span class="hljs-property">base</span>;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Module &quot;</span> + target_module + <span class="hljs-string">&quot; base address: &quot;</span> + base);<br>    <span class="hljs-keyword">let</span> offset = <span class="hljs-number">0x3b00</span><br>    <span class="hljs-keyword">let</span> target_addr = base.<span class="hljs-title function_">add</span>(offset);<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Target address: &quot;</span> + target_addr);<br><br>    <span class="hljs-keyword">let</span> globalId = <span class="hljs-number">0</span>;<br>    <span class="hljs-title class_">Interceptor</span>.<span class="hljs-title function_">attach</span>(target_addr,&#123;<br>        <span class="hljs-attr">onEnter</span>:<span class="hljs-keyword">function</span>(<span class="hljs-params">args</span>)&#123;<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">buf</span> = args[<span class="hljs-number">0</span>];<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">key</span> = args[<span class="hljs-number">1</span>];<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">len</span> = args[<span class="hljs-number">2</span>].<span class="hljs-title function_">toInt32</span>();<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">keylen</span> = args[<span class="hljs-number">3</span>].<span class="hljs-title function_">toInt32</span>();<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = ++globalId;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] xor_decrypt id=&quot;</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>);<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;buf: &quot;</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">buf</span>,<span class="hljs-string">&quot;key: &quot;</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">key</span>,<span class="hljs-string">&quot;len: &quot;</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">len</span>,<span class="hljs-string">&quot;keylen: &quot;</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">keylen</span>);<br>            <br>        &#125;,<br>        <span class="hljs-attr">onLeave</span>:<span class="hljs-keyword">function</span>(<span class="hljs-params">retval</span>)&#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] Decrypted Data:&quot;</span>);<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">hexdump</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">buf</span>, &#123;<br>                    <span class="hljs-attr">length</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">len</span>,<br>                    <span class="hljs-attr">header</span>: <span class="hljs-literal">true</span>,<br>                    <span class="hljs-attr">ansi</span>: <span class="hljs-literal">false</span><br>                &#125;));<br>            &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[-] Error reading decrypted data: &quot;</span> + e);<br>            &#125;<br>        &#125;<br>    &#125;)<br>&#125;<br><br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-title function_">hook_xor_decrypt</span>();<br>&#125;<br><br><span class="hljs-title function_">setImmediate</span>(main);<br></code></pre></td></tr></table></figure> 解密后的字符串，密文也 dump 出来了</p>
<p><img src="/images/VCTF2025/xor_dec.png" srcset="/img/loading.gif" lazyload /></p>
<h3 id="绕过反调试">绕过反调试</h3>
<p>注意到 main 函数里面的这部分内容 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c">v25 = fork();<br><span class="hljs-keyword">if</span> ( v25 &lt; <span class="hljs-number">0</span> )<br>&#123;<br>    v4 = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">goto</span> LABEL_114;   <span class="hljs-comment">// 出错，返回 1</span><br>&#125;<br><span class="hljs-keyword">if</span> ( v25 )<br>&#123;<br>    <span class="hljs-comment">// 父进程分支：v25 &gt; 0，v25 是子进程 PID</span><br>    ...<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br>    <span class="hljs-comment">// 子进程分支：v25 == 0</span><br>    ...<br>&#125;<br></code></pre></td></tr></table></figure></p>
<p>当调用 <code>pid_t pid = fork();</code>
时，操作系统会把当前的进程复制一份，产生两个近乎一样的进程，原来的进程是父进程
，新建的进程是子进程，然后这两个进程都会从 <code>fork</code>
调用处继续往下执行，但是它们拿到的 <code>fork()</code>
的返回值不同，在父进程里，<code>fork()</code> 返回新创建的子进程的
PID（一个正整数），而在子进程里，<code>fork()</code> 返回 0。</p>
<p>从这里就可以看出来后面的魔改 rc4 加密逻辑都是在子进程里实现的，由于用
frida hook 子进程也很麻烦，相关的资料也不多，最后还是选择了 patch
二进制文件绕过反调试。</p>
<p><code>main</code> 函数里面有好几处先 <code>getpid</code> 然后
<code>check_tracer_pid</code> 的地方： <code>check_tracer_pid(a1)</code>
构造出 <code>/proc/&lt;a1&gt;/status</code>，读取其中
<code>TracerPid:</code> 行，把后面的数字解析为整数，如果这个值非
0，就返回 1（表示当前进程被 ptrace/调试器跟踪），否则返回 0。</p>
<p><img src="/images/VCTF2025/checkpid0.png" srcset="/img/loading.gif" lazyload /></p>
<p><img src="/images/VCTF2025/checkpid1.png" srcset="/img/loading.gif" lazyload /></p>
<p>查看汇编，把要跳到 <code>exit</code> 或者 <code>kill</code>
部分逻辑的地方给 <code>nop</code> 掉</p>
<p><img src="/images/VCTF2025/patch1.png" srcset="/img/loading.gif" lazyload /></p>
<p><img src="/images/VCTF2025/patch2.png" srcset="/img/loading.gif" lazyload /></p>
<p><img src="/images/VCTF2025/patch3.png" srcset="/img/loading.gif" lazyload /></p>
<p><img src="/images/VCTF2025/exit.png" srcset="/img/loading.gif" lazyload /></p>
<p>由于程序里还有个 <code>prctl(4, 0LL);</code> 是防止被 ptrace
的，所以要把它也给 nop 掉</p>
<p><img src="/images/VCTF2025/prctl.png" srcset="/img/loading.gif" lazyload /></p>
<h3 id="attach-子进程调试">attach 子进程调试</h3>
<p>apply patches 一下，然后启用一个 Linux 终端运行 patch
之后的文件，运行到等待输入的时候</p>
<p><img src="/images/VCTF2025/attachment1.png" srcset="/img/loading.gif" lazyload /></p>
<p>然后用 ida attach 上去，选择进程的时候选择 pid 大一点的那个(fork
的子进程要比父进程晚一点) 同时我 ida 的 linux_server 还要 sudo
启动才行(不然它会 attach 失败) 然后就可以调试了</p>
<p>断点断在比较处可以拿到密文 s2
<code>be8c49a8115f91236044f230289b556a5ef30c550f7e75263a6fb3cd1e4d02a63acab60489a5</code></p>
<p><img src="/images/VCTF2025/bcmp.png" srcset="/img/loading.gif" lazyload /></p>
<p><img src="/images/VCTF2025/s2.png" srcset="/img/loading.gif" lazyload /></p>
<p>可以打断点 dump 出魔改 RC4 的 S 盒或者密钥流解密，或者直接把密文
patch 到输入的位置，调试一遍直接出 flag</p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/CTF/" class="category-chain-item">CTF</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Reverse/" class="print-no-link">#Reverse</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>VCTF Reverse wp + 复现</div>
      <div>http://example.com/2025/11/17/VCTF2025/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Eleven</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年11月17日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/11/19/RCTF2025/" title="RCTF 2025 Reverse Chaos2">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">RCTF 2025 Reverse Chaos2</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/11/03/just/" title="强网拟态2025 mobile just WP">
                        <span class="hidden-mobile">强网拟态2025 mobile just WP</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
